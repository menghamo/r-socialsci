















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-10-09 11:36:08 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/dc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/dc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/dc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/dc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/dc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/dc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/dc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/dc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Data Carpentry - R for Social Scientists"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/dc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/dc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/dc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/dc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/dc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Data Wrangling with dplyr and tidyr &ndash; R for Social Scientists
  </title>

  </head>
  <body>

    







    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="http://datacarpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/dc-icon-black.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../00-intro/index.html">Before we Start</a></li>
            
            
            <li><a href="../01-intro-to-r/index.html">Introduction to R</a></li>
            
            
            <li><a href="../02-starting-with-data/index.html">Starting with Data</a></li>
            
            
            <li><a href="../03-dplyr-tidyr/index.html">Data Wrangling with dplyr and tidyr</a></li>
            
            
            <li><a href="../04-ggplot2/index.html">Data Visualisation with ggplot2</a></li>
            
            
            <li><a href="../0x-json/index.html">Processing JSON data</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
        
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            <li><a href="../about/index.html">About</a></li>
            
            
            <li><a href="../data-visualisation-handout/index.html">Code Handout - Data Visualisation with ggplot2</a></li>
            
            
            <li><a href="../data-wrangling-handout/index.html">Code Handout</a></li>
            
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
            
            <li><a href="../intro-R-handout/index.html">Code Handout - Introduction to R</a></li>
            
            
            <li><a href="../starting-with-data-handout/index.html">Code Handout - Starting with Data</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	
	<li><a href="/edit//_episodes_rmd/03-dplyr-tidyr.Rmd" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>




























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../02-starting-with-data/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">R for Social Scientists</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../04-ggplot2/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Data Wrangling with dplyr and tidyr</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 50 min
      <br/>
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I select specific rows and/or columns from a dataframe?</p>
</li>
	
	<li><p>How can I combine multiple commands into a single command?</p>
</li>
	
	<li><p>How can create new columns or remove existing columns from a dataframe?</p>
</li>
	
	<li><p>How can I reformat a dataframe to meet my needs?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe the purpose of an R package and the <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> and <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> packages.</p>
</li>
	
	<li><p>Select certain columns in a dataframe with the <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> function <code class="language-plaintext highlighter-rouge">select</code>.</p>
</li>
	
	<li><p>Select certain rows in a dataframe according to filtering conditions with the <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> function <code class="language-plaintext highlighter-rouge">filter</code>.</p>
</li>
	
	<li><p>Link the output of one <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> function to the input of another function with the ‘pipe’ operator <code class="language-plaintext highlighter-rouge">%&gt;%</code>.</p>
</li>
	
	<li><p>Add new columns to a dataframe that are functions of existing columns with <code class="language-plaintext highlighter-rouge">mutate</code>.</p>
</li>
	
	<li><p>Use the split-apply-combine concept for data analysis.</p>
</li>
	
	<li><p>Use <code class="language-plaintext highlighter-rouge">summarize</code>, <code class="language-plaintext highlighter-rouge">group_by</code>, and <code class="language-plaintext highlighter-rouge">count</code> to split a dataframe into groups of observations, apply a summary statistics for each group, and then combine the results.</p>
</li>
	
	<li><p>Describe the concept of a wide and a long table format and for which purpose those formats are useful.</p>
</li>
	
	<li><p>Describe the roles of variable names and their associated values when a table is reshaped.</p>
</li>
	
	<li><p>Reshape a dataframe from long to wide format and back with the <code class="language-plaintext highlighter-rouge">pivot_wider</code> and <code class="language-plaintext highlighter-rouge">pivot_longer</code> commands from the <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> package.</p>
</li>
	
	<li><p>Export a dataframe to a csv file.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p><strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> is a package for making tabular data wrangling easier by using a
limited set of functions that can be combined to extract and summarize insights
from your data. It pairs nicely with <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> which enables you to swiftly
convert between different data formats (long vs. wide) for plotting and analysis.</p>

<p>Similarly to <strong><code class="language-plaintext highlighter-rouge">readr</code></strong>, <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> and <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> are also part of the
tidyverse. These packages were loaded in R’s memory when we called 
<code class="language-plaintext highlighter-rouge">library(tidyverse)</code> earlier.</p>

<blockquote class="callout">
  <h2 id="note">Note</h2>

  <p>The packages in the tidyverse, namely <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong>, <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> and <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> 
accept both the British (e.g. <em>summarise</em>) and American (e.g. <em>summarize</em>) spelling 
variants of different function and option names. For this lesson, we utilize
the American spellings of different functions; however, feel free to use
the regional variant for where you are teaching.</p>
</blockquote>

<h2 id="what-is-an-r-package">What is an R package?</h2>

<p>The package <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> provides easy tools for the most common data
wrangling tasks. It is built to work directly with dataframes, with many
common tasks optimized by being written in a compiled language (C++) (not all R
packages are written in R!).</p>

<p>The package <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> addresses the common problem of wanting to reshape your
data for plotting and use by different R functions. Sometimes we want data sets
where we have one row per measurement. Sometimes we want a dataframe where each
measurement type has its own column, and rows are instead more aggregated
groups. Moving back and forth between these formats is nontrivial, and
<strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> gives you tools for this and more sophisticated data wrangling.</p>

<p>But there are also packages available for a wide range of tasks including
building plots (<strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong>, which we’ll see later), downloading data from the
NCBI database, or performing statistical analysis on your data set. Many
packages such as these are housed on, and downloadable from, the 
<strong>C</strong>omprehensive <strong>R</strong> <strong>A</strong>rchive <strong>N</strong>etwork (CRAN) using <code class="language-plaintext highlighter-rouge">install.packages</code>.
This function makes the package accessible by your R installation with the
command <code class="language-plaintext highlighter-rouge">library()</code>, as you did with <code class="language-plaintext highlighter-rouge">tidyverse</code> earlier.</p>

<p>To easily access the documentation for a package within R or RStudio, use
<code class="language-plaintext highlighter-rouge">help(package = "package_name")</code>.</p>

<p>To learn more about <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> and <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> after the workshop, you may want
to check out this <a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">handy data transformation with <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> cheatsheet</a>
and this <a href="https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf">one about <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong></a>.</p>

<h2 id="learning-dplyr-and-tidyr">Learning <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> and <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong></h2>

<p>To make sure, everyone will use the same dataset for this lesson, we’ll read
again the SAFI dataset that we downloaded earlier.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## load the tidyverse</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">

</span><span class="n">interviews</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"data/SAFI_clean.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">na</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"NULL"</span><span class="p">)</span><span class="w">

</span><span class="c1">## inspect the data</span><span class="w">
</span><span class="n">interviews</span><span class="w">

</span><span class="c1">## preview the data</span><span class="w">
</span><span class="c1"># View(interviews)</span><span class="w">
</span></code></pre></div></div>

<p>We’re going to learn some of the most common <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> functions:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">select()</code>: subset columns</li>
  <li><code class="language-plaintext highlighter-rouge">filter()</code>: subset rows on conditions</li>
  <li><code class="language-plaintext highlighter-rouge">mutate()</code>: create new columns by using information from other columns</li>
  <li><code class="language-plaintext highlighter-rouge">group_by()</code> and <code class="language-plaintext highlighter-rouge">summarize()</code>: create summary statistics on grouped data</li>
  <li><code class="language-plaintext highlighter-rouge">arrange()</code>: sort results</li>
  <li><code class="language-plaintext highlighter-rouge">count()</code>: count discrete values</li>
</ul>

<h2 id="selecting-columns-and-filtering-rows">Selecting columns and filtering rows</h2>

<p>To select columns of a dataframe, use <code class="language-plaintext highlighter-rouge">select()</code>. The first argument to this
function is the dataframe (<code class="language-plaintext highlighter-rouge">interviews</code>), and the subsequent arguments are the
columns to keep, separated by commas. Alternatively, if you are selecting 
columns adjacent to each other, you can use a <code class="language-plaintext highlighter-rouge">:</code> to select a range of columns, 
read as “select columns from <em>__ to __</em>.”</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># to select columns throughout the dataframe</span><span class="w">
</span><span class="n">select</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">months_lack_food</span><span class="p">)</span><span class="w">
</span><span class="c1"># to select a series of connected columns</span><span class="w">
</span><span class="n">select</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="o">:</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>To choose rows based on a specific criteria, we can use the <code class="language-plaintext highlighter-rouge">filter()</code> function. 
The arguments after the dataframe are the condition(s) we want for our final 
dataframe to adhere to (e.g. village name is Chirodzo). We can chain a series of 
conditions together using commas between each condition.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># one condition</span><span class="w">
</span><span class="n">filter</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 39 x 14
   key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
    &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1      8 Chirod… 2016-11-16 00:00:00        12        70 burntbricks          3
 2      9 Chirod… 2016-11-16 00:00:00         8         6 burntbricks          1
 3     10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
 4     34 Chirod… 2016-11-17 00:00:00         8        18 burntbricks          3
 5     35 Chirod… 2016-11-17 00:00:00         5        45 muddaub              1
 6     36 Chirod… 2016-11-17 00:00:00         6        23 sunbricks            1
 7     37 Chirod… 2016-11-17 00:00:00         3         8 burntbricks          1
 8     43 Chirod… 2016-11-17 00:00:00         7        29 muddaub              1
 9     44 Chirod… 2016-11-17 00:00:00         2         6 muddaub              1
10     45 Chirod… 2016-11-17 00:00:00         9         7 muddaub              1
# … with 29 more rows, and 7 more variables: memb_assoc &lt;chr&gt;,
#   affect_conflicts &lt;chr&gt;, liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;,
#   months_lack_food &lt;chr&gt;, instanceID &lt;chr&gt;
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># multiple conditions</span><span class="w">
</span><span class="n">filter</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">,</span><span class="w"> </span><span class="n">rooms</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">no_meals</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 10 x 14
   key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
    &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1     10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
 2     49 Chirod… 2016-11-16 00:00:00         6        26 burntbricks          2
 3     52 Chirod… 2016-11-16 00:00:00        11        15 burntbricks          3
 4     56 Chirod… 2016-11-16 00:00:00        12        23 burntbricks          2
 5     65 Chirod… 2016-11-16 00:00:00         8        20 burntbricks          3
 6     66 Chirod… 2016-11-16 00:00:00        10        37 burntbricks          3
 7     67 Chirod… 2016-11-16 00:00:00         5        31 burntbricks          2
 8     68 Chirod… 2016-11-16 00:00:00         8        52 burntbricks          3
 9    199 Chirod… 2017-06-04 00:00:00         7        17 burntbricks          2
10    200 Chirod… 2017-06-04 00:00:00         8        20 burntbricks          2
# … with 7 more variables: memb_assoc &lt;chr&gt;, affect_conflicts &lt;chr&gt;,
#   liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;, months_lack_food &lt;chr&gt;,
#   instanceID &lt;chr&gt;
</code></pre></div></div>

<h2 id="pipes">Pipes</h2>

<p>What if you want to select and filter at the same time? There are three
ways to do this: use intermediate steps, nested functions, or pipes.</p>

<p>With intermediate steps, you create a temporary dataframe and use
that as input to the next function, like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">)</span><span class="w">
</span><span class="n">interviews_god</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">interviews2</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="o">:</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>This is readable, but can clutter up your workspace with lots of objects that
you have to name individually. With multiple steps, that can be hard to keep
track of.</p>

<p>You can also nest functions (i.e. one function inside of another), like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_god</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">),</span><span class="w"> 
                         </span><span class="n">village</span><span class="o">:</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>This is handy, but can be difficult to read if too many functions are nested, as
R evaluates the expression from the inside out (in this case, filtering, then
selecting).</p>

<p>The last option, <em>pipes</em>, are a recent addition to R. Pipes let you take the
output of one function and send it directly to the next, which is useful when
you need to do many things to the same dataset. Pipes in R look like <code class="language-plaintext highlighter-rouge">%&gt;%</code> and
are made available via the <strong><code class="language-plaintext highlighter-rouge">magrittr</code></strong> package, installed automatically with
<strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong>. If you use RStudio, you can type the pipe with <kbd>Ctrl</kbd></p>
<ul>
  <li><kbd>Shift</kbd> + <kbd>M</kbd> if you have a PC or <kbd>Cmd</kbd> +
<kbd>Shift</kbd> + <kbd>M</kbd> if you have a Mac.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">village</span><span class="o">:</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 39 x 5
   village  interview_date      no_membrs years_liv respondent_wall_type
   &lt;chr&gt;    &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               
 1 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
 2 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
 3 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
 4 Chirodzo 2016-11-17 00:00:00         8        18 burntbricks         
 5 Chirodzo 2016-11-17 00:00:00         5        45 muddaub             
 6 Chirodzo 2016-11-17 00:00:00         6        23 sunbricks           
 7 Chirodzo 2016-11-17 00:00:00         3         8 burntbricks         
 8 Chirodzo 2016-11-17 00:00:00         7        29 muddaub             
 9 Chirodzo 2016-11-17 00:00:00         2         6 muddaub             
10 Chirodzo 2016-11-17 00:00:00         9         7 muddaub             
# … with 29 more rows
</code></pre></div></div>

<p>In the above code, we use the pipe to send the <code class="language-plaintext highlighter-rouge">interviews</code> dataset first
through <code class="language-plaintext highlighter-rouge">filter()</code> to keep rows where <code class="language-plaintext highlighter-rouge">village</code> is “Chirodzo”, then through
<code class="language-plaintext highlighter-rouge">select()</code> to keep only the <code class="language-plaintext highlighter-rouge">no_membrs</code> and <code class="language-plaintext highlighter-rouge">years_liv</code> columns. Since <code class="language-plaintext highlighter-rouge">%&gt;%</code>
takes the object on its left and passes it as the first argument to the function
on its right, we don’t need to explicitly include the dataframe as an argument
to the <code class="language-plaintext highlighter-rouge">filter()</code> and <code class="language-plaintext highlighter-rouge">select()</code> functions any more.</p>

<p>Some may find it helpful to read the pipe like the word “then”. For instance,
in the above example, we take the dataframe <code class="language-plaintext highlighter-rouge">interviews</code>, <em>then</em> we <code class="language-plaintext highlighter-rouge">filter</code>
for rows with <code class="language-plaintext highlighter-rouge">village == "Chirodzo"</code>, <em>then</em> we <code class="language-plaintext highlighter-rouge">select</code> columns <code class="language-plaintext highlighter-rouge">no_membrs</code> and
<code class="language-plaintext highlighter-rouge">years_liv</code>. The <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> functions by themselves are somewhat simple,
but by combining them into linear workflows with the pipe, we can accomplish
more complex data wrangling operations.</p>

<p>If we want to create a new object with this smaller version of the data, we
can assign it a new name:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_god</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">village</span><span class="o">:</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">

</span><span class="n">interviews_god</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 39 x 5
   village  interview_date      no_membrs years_liv respondent_wall_type
   &lt;chr&gt;    &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               
 1 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
 2 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
 3 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
 4 Chirodzo 2016-11-17 00:00:00         8        18 burntbricks         
 5 Chirodzo 2016-11-17 00:00:00         5        45 muddaub             
 6 Chirodzo 2016-11-17 00:00:00         6        23 sunbricks           
 7 Chirodzo 2016-11-17 00:00:00         3         8 burntbricks         
 8 Chirodzo 2016-11-17 00:00:00         7        29 muddaub             
 9 Chirodzo 2016-11-17 00:00:00         2         6 muddaub             
10 Chirodzo 2016-11-17 00:00:00         9         7 muddaub             
# … with 29 more rows
</code></pre></div></div>

<p>Note that the final dataframe (<code class="language-plaintext highlighter-rouge">interviews_god</code>) is the leftmost part of this
expression.</p>

<blockquote class="challenge">
  <h2 id="exercise">Exercise</h2>

  <p>Using pipes, subset the <code class="language-plaintext highlighter-rouge">interviews</code> data to include interviews
where respondents were members of an irrigation association
(<code class="language-plaintext highlighter-rouge">memb_assoc</code>) and retain only the columns <code class="language-plaintext highlighter-rouge">affect_conflicts</code>,
<code class="language-plaintext highlighter-rouge">liv_count</code>, and <code class="language-plaintext highlighter-rouge">no_meals</code>.</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">memb_assoc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"yes"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">affect_conflicts</span><span class="p">,</span><span class="w"> </span><span class="n">liv_count</span><span class="p">,</span><span class="w"> </span><span class="n">no_meals</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 33 x 3
   affect_conflicts liv_count no_meals
   &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;
 1 once                     3        2
 2 never                    2        2
 3 never                    2        3
 4 once                     3        2
 5 frequently               1        3
 6 more_once                5        2
 7 more_once                3        2
 8 more_once                2        3
 9 once                     3        3
10 never                    3        3
# … with 23 more rows
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h3 id="mutate">Mutate</h3>

<p>Frequently you’ll want to create new columns based on the values in existing
columns, for example to do unit conversions, or to find the ratio of values in
two columns. For this we’ll use <code class="language-plaintext highlighter-rouge">mutate()</code>.</p>

<p>We might be interested in the ratio of number of household members
to rooms used for sleeping (i.e. avg number of people per room):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">people_per_room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">rooms</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 131 x 15
   key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
    &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1      1 God     2016-11-17 00:00:00         3         4 muddaub              1
 2      1 God     2016-11-17 00:00:00         7         9 muddaub              1
 3      3 God     2016-11-17 00:00:00        10        15 burntbricks          1
 4      4 God     2016-11-17 00:00:00         7         6 burntbricks          1
 5      5 God     2016-11-17 00:00:00         7        40 burntbricks          1
 6      6 God     2016-11-17 00:00:00         3         3 muddaub              1
 7      7 God     2016-11-17 00:00:00         6        38 muddaub              1
 8      8 Chirod… 2016-11-16 00:00:00        12        70 burntbricks          3
 9      9 Chirod… 2016-11-16 00:00:00         8         6 burntbricks          1
10     10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
# … with 121 more rows, and 8 more variables: memb_assoc &lt;chr&gt;,
#   affect_conflicts &lt;chr&gt;, liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;,
#   months_lack_food &lt;chr&gt;, instanceID &lt;chr&gt;, people_per_room &lt;dbl&gt;
</code></pre></div></div>

<p>We may be interested in investigating whether being a member of an
irrigation association had any effect on the ratio of household members
to rooms. To look at this relationship, we will first remove
data from our dataset where the respondent didn’t answer the
question of whether they were a member of an irrigation association.
These cases are recorded as “NULL” in the dataset.</p>

<p>To remove these cases, we could insert a <code class="language-plaintext highlighter-rouge">filter()</code> in the chain:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">people_per_room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">rooms</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 92 x 15
   key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
    &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1      1 God     2016-11-17 00:00:00         7         9 muddaub              1
 2      7 God     2016-11-17 00:00:00         6        38 muddaub              1
 3      8 Chirod… 2016-11-16 00:00:00        12        70 burntbricks          3
 4      9 Chirod… 2016-11-16 00:00:00         8         6 burntbricks          1
 5     10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
 6     12 God     2016-11-21 00:00:00         7        20 burntbricks          3
 7     13 God     2016-11-21 00:00:00         6         8 burntbricks          1
 8     15 God     2016-11-21 00:00:00         5        30 sunbricks            2
 9     21 God     2016-11-21 00:00:00         8        20 burntbricks          1
10     24 Ruaca   2016-11-21 00:00:00         6         4 burntbricks          2
# … with 82 more rows, and 8 more variables: memb_assoc &lt;chr&gt;,
#   affect_conflicts &lt;chr&gt;, liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;,
#   months_lack_food &lt;chr&gt;, instanceID &lt;chr&gt;, people_per_room &lt;dbl&gt;
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">!</code> symbol negates the result of the <code class="language-plaintext highlighter-rouge">is.na()</code> function. Thus, if <code class="language-plaintext highlighter-rouge">is.na()</code>
returns a value of <code class="language-plaintext highlighter-rouge">TRUE</code> (because the <code class="language-plaintext highlighter-rouge">memb_assoc</code> is missing), the <code class="language-plaintext highlighter-rouge">!</code> symbol 
negates this and says we only want values of <code class="language-plaintext highlighter-rouge">FALSE</code>, where <code class="language-plaintext highlighter-rouge">memb_assoc</code> <strong>is 
not</strong> missing.</p>

<blockquote class="challenge">
  <h2 id="exercise-1">Exercise</h2>

  <p>Create a new dataframe from the <code class="language-plaintext highlighter-rouge">interviews</code> data that meets the following
 criteria: contains only the <code class="language-plaintext highlighter-rouge">village</code> column and a new column called
 <code class="language-plaintext highlighter-rouge">total_meals</code> containing a value that is equal to the total number of meals
 served in the household per day on average (<code class="language-plaintext highlighter-rouge">no_membrs</code> times <code class="language-plaintext highlighter-rouge">no_meals</code>).
 Only the rows where <code class="language-plaintext highlighter-rouge">total_meals</code> is greater than 20 should be shown in the
 final dataframe.</p>

  <p><strong>Hint</strong>: think about how the commands should be ordered to produce this data
 frame!</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_total_meals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">total_meals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">no_meals</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">total_meals</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">total_meals</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h3 id="split-apply-combine-data-analysis-and-the-summarize-function">Split-apply-combine data analysis and the summarize() function</h3>

<p>Many data analysis tasks can be approached using the <em>split-apply-combine</em>
paradigm: split the data into groups, apply some analysis to each group, and
then combine the results. <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> makes this very easy through the use of
the <code class="language-plaintext highlighter-rouge">group_by()</code> function.</p>

<h4 id="the-summarize-function">The <code class="language-plaintext highlighter-rouge">summarize()</code> function</h4>

<p><code class="language-plaintext highlighter-rouge">group_by()</code> is often used together with <code class="language-plaintext highlighter-rouge">summarize()</code>, which collapses each
group into a single-row summary of that group.  <code class="language-plaintext highlighter-rouge">group_by()</code> takes as arguments
the column names that contain the <strong>categorical</strong> variables for which you want
to calculate the summary statistics. So to compute the average household size by
village:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` ungrouping output (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  village  mean_no_membrs
  &lt;chr&gt;             &lt;dbl&gt;
1 Chirodzo           7.08
2 God                6.86
3 Ruaca              7.57
</code></pre></div></div>

<p>You may also have noticed that the output from these calls doesn’t run off the
screen anymore. It’s one of the advantages of <code class="language-plaintext highlighter-rouge">tbl_df</code> over dataframe.</p>

<p>You can also group by multiple columns:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 9 x 3
# Groups:   village [3]
  village  memb_assoc mean_no_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
1 Chirodzo no                   8.06
2 Chirodzo yes                  7.82
3 Chirodzo &lt;NA&gt;                 5.08
4 God      no                   7.13
5 God      yes                  8   
6 God      &lt;NA&gt;                 6   
7 Ruaca    no                   7.18
8 Ruaca    yes                  9.5 
9 Ruaca    &lt;NA&gt;                 6.22
</code></pre></div></div>

<p>Note that the output is a grouped tibble. To obtain an ungrouped tibble, use the
<code class="language-plaintext highlighter-rouge">ungroup</code> function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 9 x 3
  village  memb_assoc mean_no_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
1 Chirodzo no                   8.06
2 Chirodzo yes                  7.82
3 Chirodzo &lt;NA&gt;                 5.08
4 God      no                   7.13
5 God      yes                  8   
6 God      &lt;NA&gt;                 6   
7 Ruaca    no                   7.18
8 Ruaca    yes                  9.5 
9 Ruaca    &lt;NA&gt;                 6.22
</code></pre></div></div>

<p>When grouping both by <code class="language-plaintext highlighter-rouge">village</code> and <code class="language-plaintext highlighter-rouge">membr_assoc</code>, we see rows in our table for
respondents who did not specify whether they were a member of an irrigation
association. We can exclude those data from our table using a filter step.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 3
# Groups:   village [3]
  village  memb_assoc mean_no_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
1 Chirodzo no                   8.06
2 Chirodzo yes                  7.82
3 God      no                   7.13
4 God      yes                  8   
5 Ruaca    no                   7.18
6 Ruaca    yes                  9.5 
</code></pre></div></div>

<p>Once the data are grouped, you can also summarize multiple variables at the same
time (and not necessarily on the same variable). For instance, we could add a
column indicating the minimum household size for each village for each group
(members of an irrigation association vs not):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
              </span><span class="n">min_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 4
# Groups:   village [3]
  village  memb_assoc mean_no_membrs min_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;
1 Chirodzo no                   8.06          4
2 Chirodzo yes                  7.82          2
3 God      no                   7.13          3
4 God      yes                  8             5
5 Ruaca    no                   7.18          2
6 Ruaca    yes                  9.5           5
</code></pre></div></div>

<p>It is sometimes useful to rearrange the result of a query to inspect the values.
For instance, we can sort on <code class="language-plaintext highlighter-rouge">min_membrs</code> to put the group with the smallest
household first:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
              </span><span class="n">min_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">arrange</span><span class="p">(</span><span class="n">min_membrs</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 4
# Groups:   village [3]
  village  memb_assoc mean_no_membrs min_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;
1 Chirodzo yes                  7.82          2
2 Ruaca    no                   7.18          2
3 God      no                   7.13          3
4 Chirodzo no                   8.06          4
5 God      yes                  8             5
6 Ruaca    yes                  9.5           5
</code></pre></div></div>

<p>To sort in descending order, we need to add the <code class="language-plaintext highlighter-rouge">desc()</code> function. If we want to
sort the results by decreasing order of minimum household size:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
              </span><span class="n">min_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">min_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 4
# Groups:   village [3]
  village  memb_assoc mean_no_membrs min_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;
1 God      yes                  8             5
2 Ruaca    yes                  9.5           5
3 Chirodzo no                   8.06          4
4 God      no                   7.13          3
5 Chirodzo yes                  7.82          2
6 Ruaca    no                   7.18          2
</code></pre></div></div>

<h4 id="counting">Counting</h4>

<p>When working with data, we often want to know the number of observations found
for each factor or combination of factors. For this task, <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> provides
<code class="language-plaintext highlighter-rouge">count()</code>. For example, if we wanted to count the number of rows of data for
each village, we would do:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  village      n
  &lt;chr&gt;    &lt;int&gt;
1 Chirodzo    39
2 God         43
3 Ruaca       49
</code></pre></div></div>

<p>For convenience, <code class="language-plaintext highlighter-rouge">count()</code> provides the <code class="language-plaintext highlighter-rouge">sort</code> argument to get results in
decreasing order:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  village      n
  &lt;chr&gt;    &lt;int&gt;
1 Ruaca       49
2 God         43
3 Chirodzo    39
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="exercise-2">Exercise</h2>

  <p>How many households in the survey have an average of
two meals per day? Three meals per day? Are there any other numbers
of meals represented?</p>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">count</span><span class="p">(</span><span class="n">no_meals</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 2 x 2
  no_meals     n
     &lt;dbl&gt; &lt;int&gt;
1        2    52
2        3    79
</code></pre></div>    </div>
  </blockquote>

  <p>Use <code class="language-plaintext highlighter-rouge">group_by()</code> and <code class="language-plaintext highlighter-rouge">summarize()</code> to find the mean, min, and max
number of household members for each village. Also add the number of
observations (hint: see <code class="language-plaintext highlighter-rouge">?n</code>).</p>

  <blockquote class="solution">
    <h2 id="solution-3">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="w">
      </span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
      </span><span class="n">min_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
      </span><span class="n">max_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
      </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">()</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` ungrouping output (override with `.groups` argument)
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 5
  village  mean_no_membrs min_no_membrs max_no_membrs     n
  &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt; &lt;int&gt;
1 Chirodzo           7.08             2            12    39
2 God                6.86             3            15    43
3 Ruaca              7.57             2            19    49
</code></pre></div>    </div>
  </blockquote>

  <p>What was the largest household interviewed in each month?</p>

  <blockquote class="solution">
    <h2 id="solution-4">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># if not already included, add month, year, and day columns</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w"> </span><span class="c1"># load lubridate if not already loaded</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'lubridate'
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">month</span><span class="p">(</span><span class="n">interview_date</span><span class="p">),</span><span class="w">
           </span><span class="n">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">day</span><span class="p">(</span><span class="n">interview_date</span><span class="p">),</span><span class="w">
           </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">interview_date</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">max_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'year' (override with `.groups` argument)
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 5 x 3
# Groups:   year [2]
   year month max_no_membrs
  &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
1  2016    11            19
2  2016    12            12
3  2017     4            17
4  2017     5            15
5  2017     6            15
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="reshaping-with-pivot_wider-and-pivot_longer">Reshaping with pivot_wider() and pivot_longer()</h2>

<p>There are essentially three rules that define a “tidy” dataset:</p>

<ol>
  <li>Each variable has its own column</li>
  <li>Each observation has its own row</li>
  <li>Each value must have its own cell</li>
</ol>

<p>In this section we will explore how these rules are linked to the different 
data formats researchers are often interested in: “wide” and “long”. This
tutorial will help you efficiently transform your data shape regardless of
original format. First we will explore qualities of the <code class="language-plaintext highlighter-rouge">interviews</code> data and
how they relate to these different types of data formats.</p>

<h3 id="long-and-wide-data-formats">Long and wide data formats</h3>

<p>In the <code class="language-plaintext highlighter-rouge">interviews</code> data, each row contains the values of variables associated
with each record collected (each interview in the villages), where it is stated 
that the the <code class="language-plaintext highlighter-rouge">key_ID</code> was “added to provide a unique Id for each observation” 
and the <code class="language-plaintext highlighter-rouge">instance_ID</code> “does this as well but it is not as convenient to use.”</p>

<p>However, with some inspection, we notice that there are more than one row in the
dataset with the same <code class="language-plaintext highlighter-rouge">key_ID</code> (as seen below). However, the <code class="language-plaintext highlighter-rouge">instanceID</code>s
associated with these duplicate <code class="language-plaintext highlighter-rouge">key_ID</code>s are not the same. Thus, we should
think of <code class="language-plaintext highlighter-rouge">instanceID</code> as the unique identifier for observations!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">key_ID</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">interview_date</span><span class="p">,</span><span class="w"> </span><span class="n">instanceID</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 131 x 4
   key_ID village  interview_date      instanceID                               
    &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;                                    
 1      1 God      2016-11-17 00:00:00 uuid:ec241f2c-0609-46ed-b5e8-fe575f6cefef
 2      1 God      2016-11-17 00:00:00 uuid:099de9c9-3e5e-427b-8452-26250e840d6e
 3      3 God      2016-11-17 00:00:00 uuid:193d7daf-9582-409b-bf09-027dd36f9007
 4      4 God      2016-11-17 00:00:00 uuid:148d1105-778a-4755-aa71-281eadd4a973
 5      5 God      2016-11-17 00:00:00 uuid:2c867811-9696-4966-9866-f35c3e97d02d
 6      6 God      2016-11-17 00:00:00 uuid:daa56c91-c8e3-44c3-a663-af6a49a2ca70
 7      7 God      2016-11-17 00:00:00 uuid:ae20a58d-56f4-43d7-bafa-e7963d850844
 8      8 Chirodzo 2016-11-16 00:00:00 uuid:d6cee930-7be1-4fd9-88c0-82a08f90fb5a
 9      9 Chirodzo 2016-11-16 00:00:00 uuid:846103d2-b1db-4055-b502-9cd510bb7b37
10     10 Chirodzo 2016-12-16 00:00:00 uuid:8f4e49bc-da81-4356-ae34-e0d794a23721
# … with 121 more rows
</code></pre></div></div>

<p>As seen in the code below, for each interview date in each village no 
<code class="language-plaintext highlighter-rouge">instanceID</code>s are the same. Thus, this format is what is called a “long” data
format, where each observation occupies only one row in the dataframe.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">key_ID</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">interview_date</span><span class="p">,</span><span class="w"> </span><span class="n">instanceID</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">sample_n</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 10 x 4
   key_ID village  interview_date      instanceID                               
    &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;                                    
 1     58 Chirodzo 2016-11-16 00:00:00 uuid:a7a3451f-cd0d-4027-82d9-8dcd1234fcca
 2     35 Chirodzo 2016-11-17 00:00:00 uuid:ff7496e7-984a-47d3-a8a1-13618b5683ce
 3     70 Chirodzo 2016-11-16 00:00:00 uuid:1feb0108-4599-4bf9-8a07-1f5e66a50a0a
 4     44 Chirodzo 2016-11-17 00:00:00 uuid:f9fadf44-d040-4fca-86c1-2835f79c4952
 5     50 Chirodzo 2016-11-16 00:00:00 uuid:4267c33c-53a7-46d9-8bd6-b96f58a4f92c
 6     51 Chirodzo 2016-11-16 00:00:00 uuid:18ac8e77-bdaf-47ab-85a2-e4c947c9d3ce
 7     55 Chirodzo 2016-11-16 00:00:00 uuid:883c0433-9891-4121-bc63-744f082c1fa0
 8     37 Chirodzo 2016-11-17 00:00:00 uuid:408c6c93-d723-45ef-8dee-1b1bd3fe20cd
 9     64 Chirodzo 2016-11-16 00:00:00 uuid:28cfd718-bf62-4d90-8100-55fafbe45d06
10     52 Chirodzo 2016-11-16 00:00:00 uuid:6db55cb4-a853-4000-9555-757b7fae2bcf
</code></pre></div></div>

<p>We notice that the layout or format of the <code class="language-plaintext highlighter-rouge">interviews</code> data is in a format that
adheres to rules 1-3, where</p>

<ul>
  <li>each column is a variable</li>
  <li>each row is an observation</li>
  <li>each value has its own cell</li>
</ul>

<p>This is called a “long” data format. But, we notice that each column represents 
a different variable. In the “longest” data format there would only be three 
columns, one for the id variable, one for the observed variable, and one for the 
observed value (of that variable). This data format is quite unsightly
and difficult to work with, so you will rarely see it in use.</p>

<p>Alternatively, in a “wide” data format we see modifications to rule 1, where 
each column no longer represents a single variable. Instead, columns can
represent different levels/values of a variable. For instance, in some data you
encounter the researchers may have chosen for every survey date to be a
different column.</p>

<p>These may sound like dramatically different data layouts, but there are some 
tools that make transitions between these layouts much simpler than you might 
think! The gif below shows how these two formats relate to each other, and 
gives you an idea of how we can use R to shift from one format to the other.</p>

<p><img src="../fig/tidyr-pivot_wider_longer.gif" alt="" />
Long and wide dataframe layouts mainly affect readability. You may find that
visually you may prefer the “wide” format, since you can see more of the data on
the screen. However, all of the R functions we have used thus far expect for
your data to be in a “long” data format. This is because the long format is more
machine readable and is closer to the formatting of databases.</p>

<h3 id="questions-which-warrant-different-data-formats">Questions which warrant different data formats</h3>

<p>In interviews, each row contains the values of variables associated with each
record (the unit), values such as the village of the respondent, the number
of household members, or the type of wall their house had. This format allows 
for us to make comparisons across individual surveys, but what if we wanted to
look at differences in households grouped by different types of housing
construction materials?</p>

<p>To facilitate this comparison we would need to create a new table where each row
(the unit) was comprised of values of variables associated with housing material
(e.g. the <code class="language-plaintext highlighter-rouge">respondent_wall_type</code>). In practical terms this means the values of
the wall construction materials in <code class="language-plaintext highlighter-rouge">respondent_wall_type</code> (e.g. muddaub, 
burntbricks, cement, sunbricks) would become the names of column variables and
the cells would contain values of <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code>, for whether that house had
a wall made of that material.</p>

<p>Once we we’ve created this new table, we can explore the relationship within and
between villages. The key point here is that we are still following a tidy data
structure, but we have <strong>reshaped</strong> the data according to the observations of
interest.</p>

<p>Alternatively, if the interview dates were spread across multiple columns, and 
we were interested in visualizing, within each village, how irrigation
conflicts have changed over time. This would require for the interview date to 
be included in a single column rather than spread across multiple columns. Thus, 
we would need to transform the column names into values of a variable.</p>

<p>We can do both these of transformations with two <code class="language-plaintext highlighter-rouge">tidyr</code> functions,
<code class="language-plaintext highlighter-rouge">pivot_wider()</code> and <code class="language-plaintext highlighter-rouge">pivot_longer()</code>.</p>

<h3 id="pivoting-wider">Pivoting wider</h3>

<p><code class="language-plaintext highlighter-rouge">pivot_wider()</code> takes three principal arguments:</p>

<ol>
  <li>the data</li>
  <li>the <em>names_from</em> column variable whose values will become new column names.</li>
  <li>the <em>values_from</em> column variable whose values will fill the new column
variables.</li>
</ol>

<p>Further arguments include <code class="language-plaintext highlighter-rouge">values_fill</code> which, if set, fills in missing values
with the value provided.</p>

<p>Let’s use <code class="language-plaintext highlighter-rouge">pivot_wider()</code> to transform interviews to create new columns for each
type of wall construction material. We will make use of the pipe operator as
have done before. Because both the <code class="language-plaintext highlighter-rouge">names_from</code> and <code class="language-plaintext highlighter-rouge">values_from</code> parameters
must come from column values, we will create a dummy column (we’ll name it
<code class="language-plaintext highlighter-rouge">wall_type_logical</code>) to hold the value <code class="language-plaintext highlighter-rouge">TRUE</code>, which we will then place into the
appropriate column that corresponds to the wall construction material for that
respondent. When using <code class="language-plaintext highlighter-rouge">mutate()</code> if you give a single value, it will be used
for all observations in the dataset.</p>

<p>For each row in our newly pivoted table, only one of the newly created wall type
columns will have a value of <code class="language-plaintext highlighter-rouge">TRUE</code>, since each house can only be made of one 
wall type. The default value that <code class="language-plaintext highlighter-rouge">pivot_wider</code> uses to fill the other wall
types is <code class="language-plaintext highlighter-rouge">NA</code>.</p>

<p><img src="../fig/pivot_long_to_wide.png" alt="" /></p>

<p>If instead of the default value being <code class="language-plaintext highlighter-rouge">NA</code>, we wanted these values to be <code class="language-plaintext highlighter-rouge">FALSE</code>, 
we can insert a default value into the <code class="language-plaintext highlighter-rouge">values_fill</code> argument. By including 
<code class="language-plaintext highlighter-rouge">values_fill = list(wall_type_logical = FALSE)</code> inside <code class="language-plaintext highlighter-rouge">pivot_wider()</code>, we can 
fill the remainder of the wall type columns for that row with the value <code class="language-plaintext highlighter-rouge">FALSE</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">wall_type_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">,</span><span class="w"> 
                </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wall_type_logical</span><span class="p">,</span><span class="w"> 
                </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">wall_type_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>View the <code class="language-plaintext highlighter-rouge">interviews_wide</code> dataframe and notice that there is no longer a
column titled <code class="language-plaintext highlighter-rouge">respondent_wall_type</code>. This is because there is a default
parameter in <code class="language-plaintext highlighter-rouge">pivot_wider()</code> that drops the original column. The values that
were in that column have now become columns named <code class="language-plaintext highlighter-rouge">muddaub</code>, <code class="language-plaintext highlighter-rouge">burntbricks</code>,
<code class="language-plaintext highlighter-rouge">sunbricks</code>, and <code class="language-plaintext highlighter-rouge">cement</code>. You can use <code class="language-plaintext highlighter-rouge">dim(interviews)</code> and 
<code class="language-plaintext highlighter-rouge">dim(interviews_wide)</code> to see how the number of columns has changed between 
the two datasets.</p>

<h3 id="pivoting-longer">Pivoting longer</h3>

<p>The opposing situation could occur if we had been provided with data in the form
of <code class="language-plaintext highlighter-rouge">interviews_wide</code>, where the building materials are column names, but we
wish to treat them as values of a <code class="language-plaintext highlighter-rouge">respondent_wall_type</code> variable instead.</p>

<p>In this situation we are gathering these columns turning them into a pair
of new variables. One variable includes the column names as values, and the
other variable contains the values in each cell previously associated with the
column names. We will do this in two steps to make this process a bit clearer.</p>

<p><code class="language-plaintext highlighter-rouge">pivot_longer()</code> takes four principal arguments:</p>

<ol>
  <li>the data</li>
  <li><em>cols</em> are the names of the columns we use to fill the a new values variable
(or to drop).</li>
  <li>the <em>names_to</em> column variable we wish to create from the <em>cols</em> provided.</li>
  <li>the <em>values_to</em> column variable we wish to create and fill with values
associated with the <em>cols</em> provided.</li>
</ol>

<p>To recreate our original dataframe, we will use the following:</p>

<ol>
  <li>the data - <code class="language-plaintext highlighter-rouge">interviews_wide</code></li>
  <li>a list of <em>cols</em> (columns) that are to be reshaped; these can be specified 
using a  <code class="language-plaintext highlighter-rouge">:</code> if the columns to be reshaped are in one area of the dataframe, 
or with a vector (<code class="language-plaintext highlighter-rouge">c()</code>) command if the columns are spread throughout the
dataframe.</li>
  <li>the <em>names_to</em> column will be a character string of the name the column 
these columns will be collapsed into (“respondent_wall_type”).</li>
  <li>the <em>values_to</em> column will be a character string of the name of the 
column the values of the collapsed columns will be inserted into 
(“wall_type_logical”). This column will be populated with values of 
<code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code>.</li>
</ol>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews_wide</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">pivot_longer</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">burntbricks</span><span class="o">:</span><span class="n">sunbricks</span><span class="p">,</span><span class="w">
                 </span><span class="n">names_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"respondent_wall_type"</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">values_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"wall_type_logical"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/pivot_wide_to_long.png" alt="" /></p>

<p>This creates a dataframe with 262 rows (4 rows per
interview respondent). The four rows for each respondent differ only in the
value of the “respondent_wall_type” and “wall_type_logical” columns. View the
data to see what this looks like.</p>

<p>Only one row for each interview respondent is informative–we know that if the
house walls are made of “sunbrick” they aren’t made of any other the other
materials. Therefore, it would make sense to filter our dataset to only keep
values where <code class="language-plaintext highlighter-rouge">wall_type_logical</code> is <code class="language-plaintext highlighter-rouge">TRUE</code>. Because <code class="language-plaintext highlighter-rouge">wall_type_logical</code> is
already either <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code>, when passing the column name to <code class="language-plaintext highlighter-rouge">filter()</code>,
it will automatically already only keep rows where this column has the value
<code class="language-plaintext highlighter-rouge">TRUE</code>. We can then remove the <code class="language-plaintext highlighter-rouge">wall_type_logical</code> column.</p>

<p>We do all of these steps together in the next chunk of code:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews_wide</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">pivot_longer</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">burntbricks</span><span class="p">,</span><span class="w"> </span><span class="n">cement</span><span class="p">,</span><span class="w"> </span><span class="n">muddaub</span><span class="p">,</span><span class="w"> </span><span class="n">sunbricks</span><span class="p">),</span><span class="w">
                 </span><span class="n">names_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"respondent_wall_type"</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">values_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"wall_type_logical"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">wall_type_logical</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">wall_type_logical</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>View both <code class="language-plaintext highlighter-rouge">interviews_long</code> and <code class="language-plaintext highlighter-rouge">interviews_wide</code> and compare their structure.</p>

<h2 id="applying-pivot_wider-to-clean-our-data">Applying <code class="language-plaintext highlighter-rouge">pivot_wider()</code> to clean our data</h2>

<p>Now that we’ve learned about <code class="language-plaintext highlighter-rouge">pivot_longer()</code> and <code class="language-plaintext highlighter-rouge">pivot_wider()</code> we’re going to
put these functions to use to fix a problem with the way that our data is
structured. In the spreadsheets lesson, we learned that it’s best practice to
have only a single piece of information in each cell of your spreadsheet. In
this dataset, we have several columns which contain multiple pieces of
information. For example, the <code class="language-plaintext highlighter-rouge">items_owned</code> column contains information about
whether our respondents owned a fridge, a television, etc. To make this data
easier to analyze, we will split this column and create a new column for each
item. Each cell in that column will either be <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code> and will
indicate whether that interview respondent owned that item (similar to what 
we did previously with <code class="language-plaintext highlighter-rouge">wall_type</code>).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_items_owned</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">separate_rows</span><span class="p">(</span><span class="n">items_owned</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">replace_na</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"no_listed_items"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned</span><span class="p">,</span><span class="w"> 
                </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned_logical</span><span class="p">,</span><span class="w"> 
                </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">

</span><span class="n">nrow</span><span class="p">(</span><span class="n">interviews_items_owned</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 131
</code></pre></div></div>

<p>There are a couple of new concepts in this code chunk, so let’s walk through it
line by line. First we create a new object (<code class="language-plaintext highlighter-rouge">interviews_items_owned</code>) based on
the <code class="language-plaintext highlighter-rouge">interviews</code> dataframe.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_items_owned</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span></code></pre></div></div>

<p>Then we use the new function <code class="language-plaintext highlighter-rouge">separate_rows()</code> from the <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> package to
separate the values of <code class="language-plaintext highlighter-rouge">items_owned</code> based on the presence of semi-colons (<code class="language-plaintext highlighter-rouge">;</code>).
The values of this variable were multiple items separated by semi-colons, so 
this action creates a row for each item listed in a household’s possession. 
Thus, we end up with a long format version of the dataset, with multiple rows
for each respondent. For example, if a respondent has a television and a solar
panel, that respondent will now have two rows, one with “television” and the
other with “solar panel” in the <code class="language-plaintext highlighter-rouge">items_owned</code> column.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">separate_rows</span><span class="p">(</span><span class="n">items_owned</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span></code></pre></div></div>

<p>You may notice that one of the columns is called <code class="language-plaintext highlighter-rouge">´NA´</code>. This is because some 
of the respondents did not own any of the items that was in the interviewer’s
list. We can use the <code class="language-plaintext highlighter-rouge">replace_na()</code> function to change these <code class="language-plaintext highlighter-rouge">NA</code> values to 
something more meaningful. The <code class="language-plaintext highlighter-rouge">replace_na()</code> function expects for you to give 
it a <code class="language-plaintext highlighter-rouge">list()</code> of columns that you would like to replace the <code class="language-plaintext highlighter-rouge">NA</code> values in, 
and the value that you would like to replace the <code class="language-plaintext highlighter-rouge">NA</code>s. This ends up looking 
like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">replace_na</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"no_listed_items"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span></code></pre></div></div>

<p>Next, we create a new variable named <code class="language-plaintext highlighter-rouge">items_owned_logical</code>, which has one value
(<code class="language-plaintext highlighter-rouge">TRUE</code>) for every row. This makes since, since each item in every row was owned
by that household. We are constructing this variable so that when spread the 
<code class="language-plaintext highlighter-rouge">items_owned</code> across multiple columns, we can fill the values of those columns 
with logical values describing whether the household did (<code class="language-plaintext highlighter-rouge">TRUE</code>) or didn’t 
(<code class="language-plaintext highlighter-rouge">FALSE</code>) own that particular item.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mutate</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span></code></pre></div></div>

<p>Lastly, we use <code class="language-plaintext highlighter-rouge">pivot_wider()</code> to switch from long format to wide format. This
creates a new column for each of the unique values in the <code class="language-plaintext highlighter-rouge">items_owned</code> column,
and fills those columns with the values of <code class="language-plaintext highlighter-rouge">items_owned_logical</code>. We also
declare that for items that are missing, we want to fill those cells with the 
value of <code class="language-plaintext highlighter-rouge">FALSE</code> instead of <code class="language-plaintext highlighter-rouge">NA</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned</span><span class="p">,</span><span class="w">
            </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned_logical</span><span class="p">,</span><span class="w">
            </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>View the <code class="language-plaintext highlighter-rouge">interviews_items_owned</code> dataframe. It should have 
131 rows (the same number of rows you had originally), but
extra columns for each item. How many columns were added?</p>

<p>This format of the data allows us to do interesting things, like make a table
showing the number of respondents in each village who owned a particular item:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_items_owned</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">bicycle</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">bicycle</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 3
# Groups:   village [3]
  village  bicycle     n
  &lt;chr&gt;    &lt;lgl&gt;   &lt;int&gt;
1 Chirodzo TRUE       17
2 God      TRUE       23
3 Ruaca    TRUE       20
</code></pre></div></div>

<p>Or below we calculate the average number of items from the list owned by
respondents in each village. This code uses the <code class="language-plaintext highlighter-rouge">rowSums()</code> function to count
the number of <code class="language-plaintext highlighter-rouge">TRUE</code> values in the <code class="language-plaintext highlighter-rouge">bicycle</code> to <code class="language-plaintext highlighter-rouge">car</code> columns for each row,
hence its name. We then group the data by villages and caluculate the mean
number of items, so each average is grouped by village.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_items_owned</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">number_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">bicycle</span><span class="o">:</span><span class="n">car</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">number_items</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` ungrouping output (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  village  mean_items
  &lt;chr&gt;         &lt;dbl&gt;
1 Chirodzo       4.62
2 God            4.07
3 Ruaca          5.63
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="exercise-3">Exercise</h2>

  <ol>
    <li>Create a new dataframe (named <code class="language-plaintext highlighter-rouge">interviews_months_lack_food</code>) that has one
column for each month and records <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code> for whether each interview
respondent was lacking food in that month.</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-5">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_months_lack_food</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">separate_rows</span><span class="p">(</span><span class="n">months_lack_food</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">months_lack_food_logical</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">months_lack_food</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">months_lack_food_logical</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">months_lack_food_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>

  <ol>
    <li>How many months (on average) were respondents without food if
they did belong to an irrigation association? What about if they didn’t?</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-6">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_months_lack_food</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">number_months</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">Jan</span><span class="o">:</span><span class="n">May</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_months</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">number_months</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` ungrouping output (override with `.groups` argument)
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  memb_assoc mean_months
  &lt;chr&gt;            &lt;dbl&gt;
1 no                2   
2 yes               2.30
3 &lt;NA&gt;              2.82
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="exporting-data">Exporting data</h2>

<p>Now that you have learned how to use <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> to extract information from
or summarize your raw data, you may want to export these new data sets to share
them with your collaborators or for archival.</p>

<p>Similar to the <code class="language-plaintext highlighter-rouge">read_csv()</code> function used for reading CSV files into R, there is
a <code class="language-plaintext highlighter-rouge">write_csv()</code> function that generates CSV files from dataframes.</p>

<p>Before using <code class="language-plaintext highlighter-rouge">write_csv()</code>, we are going to create a new folder, <code class="language-plaintext highlighter-rouge">data_output</code>,
in our working directory that will store this generated dataset. We don’t want
to write generated datasets in the same directory as our raw data. It’s good
practice to keep them separate. The <code class="language-plaintext highlighter-rouge">data</code> folder should only contain the raw,
unaltered data, and should be left alone to make sure we don’t delete or modify
it. In contrast, our script will generate the contents of the <code class="language-plaintext highlighter-rouge">data_output</code>
directory, so even if the files it contains are deleted, we can always
re-generate them.</p>

<p>In preparation for our next lesson on plotting, we are going to create a version
of the dataset where each of the columns includes only one data value. To do
this, we will use <code class="language-plaintext highlighter-rouge">pivot_wider</code> to expand the <code class="language-plaintext highlighter-rouge">months_lack_food</code> and
<code class="language-plaintext highlighter-rouge">items_owned</code> columns. We will also create a couple of summary columns.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## pivot wider by items_owned</span><span class="w">
  </span><span class="n">separate_rows</span><span class="p">(</span><span class="n">items_owned</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## if there were no items listed, changing NA to no_listed_items</span><span class="w">
  </span><span class="n">replace_na</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"no_listed_items"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned_logical</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## pivot wider by months_lack_food</span><span class="w">
  </span><span class="n">separate_rows</span><span class="p">(</span><span class="n">months_lack_food</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">months_lack_food_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">months_lack_food</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">months_lack_food_logical</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">months_lack_food_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## add some summary columns</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">number_months_lack_food</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">Jan</span><span class="o">:</span><span class="n">May</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">number_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">bicycle</span><span class="o">:</span><span class="n">car</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Now we can save this dataframe to our <code class="language-plaintext highlighter-rouge">data_output</code> directory.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write_csv</span><span class="p">(</span><span class="n">interviews_plotting</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data_output/interviews_plotting.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext warning highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning: The `path` argument of `write_csv()` is deprecated as of readr 1.4.0.
Please use the `file` argument instead.
This warning is displayed once every 8 hours.
Call `lifecycle::last_warnings()` to see where this warning was generated.
</code></pre></div></div>






<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use the <code class="language-plaintext highlighter-rouge">dplyr</code> package to manipulate dataframes.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">select()</code> to choose variables from a dataframe.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">filter()</code> to choose data based on values.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">group_by()</code> and <code class="language-plaintext highlighter-rouge">summarize()</code> to work with subsets of data.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">mutate()</code> to create new variables.</p>
</li>
    
    <li><p>Use the <code class="language-plaintext highlighter-rouge">tidyr</code> package to change the layout of dataframes.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">pivot_wider()</code> to go from long to wide format.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">pivot_longer()</code> to go from wide to long format.</p>
</li>
    
  </ul>
</blockquote>

</article>



























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../02-starting-with-data/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../04-ggplot2/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 license" id="license-info" align="left">
	
	Licensed under <a href="">CC-BY 4.0</a> 2018–2020
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="">CC-BY 4.0</a> 2016–2018
	by <a href="http://datacarpentry.org">Data Carpentry</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	
	<a href="/edit//_episodes_rmd/03-dplyr-tidyr.Rmd" data-checker-ignore>Edit on GitHub</a>
	
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:team@carpentries.org">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
