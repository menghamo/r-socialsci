















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-10-09 11:36:08 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/dc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/dc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/dc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/dc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/dc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/dc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/dc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/dc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Data Carpentry - R for Social Scientists"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/dc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/dc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/dc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/dc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/dc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  R for Social Scientists
  </title>

  </head>
  <body>

    







    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="http://datacarpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/dc-icon-black.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../00-intro/index.html">Before we Start</a></li>
            
            
            <li><a href="../01-intro-to-r/index.html">Introduction to R</a></li>
            
            
            <li><a href="../02-starting-with-data/index.html">Starting with Data</a></li>
            
            
            <li><a href="../03-dplyr-tidyr/index.html">Data Wrangling with dplyr and tidyr</a></li>
            
            
            <li><a href="../04-ggplot2/index.html">Data Visualisation with ggplot2</a></li>
            
            
            <li><a href="../0x-json/index.html">Processing JSON data</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
        
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            <li><a href="../about/index.html">About</a></li>
            
            
            <li><a href="../data-visualisation-handout/index.html">Code Handout - Data Visualisation with ggplot2</a></li>
            
            
            <li><a href="../data-wrangling-handout/index.html">Code Handout</a></li>
            
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
            
            <li><a href="../intro-R-handout/index.html">Code Handout - Introduction to R</a></li>
            
            
            <li><a href="../starting-with-data-handout/index.html">Code Handout - Starting with Data</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit//aio.md" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>
















<h1 class="maintitle"><a href="../">R for Social Scientists</a></h1>



<article>

<h1 id="before-we-start" class="maintitle">Before we Start</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 25 min
      <br />
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How to find your way around RStudio?</p>
</li>
	
	<li><p>How to interact with R?</p>
</li>
	
	<li><p>How to manage your environment?</p>
</li>
	
	<li><p>How to install packages?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Install latest version of R.</p>
</li>
	
	<li><p>Install latest version of RStudio.</p>
</li>
	
	<li><p>Navigate the RStudio GUI.</p>
</li>
	
	<li><p>Install additional packages using the packages tab.</p>
</li>
	
	<li><p>Install additional packages using R code.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="what-is-r-what-is-rstudio">What is R? What is RStudio?</h2>

<p>The term “<code class="language-plaintext highlighter-rouge">R</code>” is used to refer to both the programming language and the
software that interprets the scripts written using it.</p>

<p><a href="https://rstudio.com">RStudio</a> is currently a very popular way to not only write
your R scripts but also to interact with the R software. To function correctly,
RStudio needs R and therefore both need to be installed on your computer.</p>

<p>To make it easier to interact with R, we will use RStudio. RStudio is the most popular 
IDE (Integrated Development Environmemt) for R. An IDE is a piece of software that provides 
tools to make programming easier.</p>

<h2 id="why-learn-r">Why learn R?</h2>

<h3 id="r-does-not-involve-lots-of-pointing-and-clicking-and-thats-a-good-thing">R does not involve lots of pointing and clicking, and that’s a good thing</h3>

<p>The learning curve might be steeper than with other software, but with R, the
results of your analysis do not rely on remembering a succession of pointing
and clicking, but instead on a series of written commands, and that’s a good
thing! So, if you want to redo your analysis because you collected more data,
you don’t have to remember which button you clicked in which order to obtain
your results; you just have to run your script again.</p>

<p>Working with scripts makes the steps you used in your analysis clear, and the
code you write can be inspected by someone else who can give you feedback and
spot mistakes.</p>

<p>Working with scripts forces you to have a deeper understanding of what you are
doing, and facilitates your learning and comprehension of the methods you use.</p>

<h3 id="r-code-is-great-for-reproducibility">R code is great for reproducibility</h3>

<p>Reproducibility is when someone else (including your future self) can obtain the
same results from the same dataset when using the same analysis.</p>

<p>R integrates with other tools to generate manuscripts from your code. If you
collect more data, or fix a mistake in your dataset, the figures and the
statistical tests in your manuscript are updated automatically.</p>

<p>An increasing number of journals and funding agencies expect analyses to be
reproducible, so knowing R will give you an edge with these requirements.</p>

<h3 id="r-is-interdisciplinary-and-extensible">R is interdisciplinary and extensible</h3>

<p>With 10,000+ packages that can be installed to extend its capabilities, R
provides a framework that allows you to combine statistical approaches from many
scientific disciplines to best suit the analytical framework you need to analyze your
data. For instance, R has packages for image analysis, GIS, time series, population
genetics, and a lot more.</p>

<h3 id="r-works-on-data-of-all-shapes-and-sizes">R works on data of all shapes and sizes</h3>

<p>The skills you learn with R scale easily with the size of your dataset. Whether
your dataset has hundreds or millions of lines, it won’t make much difference to
you.</p>

<p>R is designed for data analysis. It comes with special data structures and data
types that make handling of missing data and statistical factors convenient.</p>

<p>R can connect to spreadsheets, databases, and many other data formats, on your
computer or on the web.</p>

<h3 id="r-produces-high-quality-graphics">R produces high-quality graphics</h3>

<p>The plotting functionalities in R are endless, and allow you to adjust any
aspect of your graph to convey most effectively the message from your data.</p>

<h3 id="r-has-a-large-and-welcoming-community">R has a large and welcoming community</h3>

<p>Thousands of people use R daily. Many of them are willing to help you through
mailing lists and websites such as <a href="https://stackoverflow.com/">Stack Overflow</a>, 
or on the <a href="https://community.rstudio.com/">RStudio community</a>. Questions which 
are backed up with <a href="https://www.tidyverse.org/help/">short, reproducible code
snippets</a> are more likely to attract 
knowledgeable responses.</p>

<h3 id="not-only-is-r-free-but-it-is-also-open-source-and-cross-platform">Not only is R free, but it is also open-source and cross-platform</h3>

<p>Anyone can inspect the source code to see how R works. Because of this
transparency, there is less chance for mistakes, and if you (or someone else)
find some, you can report and fix bugs.</p>

<p>Because R is open source and is supported by a large community of developers and
users, there is a very large selection of third-party add-on packages which are
freely available to extend R’s native capabilities.</p>

<figure>
<div class="row">
<div class="col-md-6">
<img src="../fig/r-manual.jpeg" title="RStudio extends what R can do, and makes it easier to write R code and interact with R." alt="RStudio extends what R can do, and makes it easier to write R code and interact with R." width="100%" style="display: block; margin: auto;" />
</div>
<div class="col-md-6">
<img src="../fig/r-automatic.jpeg" title="plot of chunk rstudio-analogy-2" alt="plot of chunk rstudio-analogy-2" width="100%" style="display: block; margin: auto;" />
</div>
</div>
<figcaption>
RStudio extends what R can do, and makes it easier to write R code and interact
with R. <a href="https://unsplash.com/photos/D19rXKDUPYM">Left photo credit</a>; <a href="https://unsplash.com/photos/Wec3M4dY_LE">Right photo credit</a>.
</figcaption>
</figure>

<h2 id="a-tour-of-rstudio">A tour of RStudio</h2>

<h2 id="knowing-your-way-around-rstudio">Knowing your way around RStudio</h2>

<p>Let’s start by learning about <a href="https://www.rstudio.com/">RStudio</a>, which is an
Integrated Development Environment (IDE) for working with R.</p>

<p>The RStudio IDE open-source product is free under the
<a href="https://www.gnu.org/licenses/agpl-3.0.en.html">Affero General Public License (AGPL) v3</a>.
The RStudio IDE is also available with a commercial license and priority email
support from RStudio, Inc.</p>

<p>We will use the RStudio IDE to write code, navigate the files on our computer,
inspect the variables we create, and visualize the plots we generate. RStudio 
can also be used for other things (e.g., version control, developing packages, 
writing Shiny apps) that we will not cover during the workshop.</p>

<p>One of the advantages of using RStudio is that all the information
you need to write code is available in a single window. Additionally, RStudio 
provides many shortcuts, autocompletion, and highlighting for the major file 
types you use while developing in R. RStudio makes typing easier and less
error-prone.</p>

<h2 id="getting-set-up">Getting set up</h2>

<p>It is good practice to keep a set of related data, analyses, and text
self-contained in a single folder called the <strong>working directory</strong>. All of the
scripts within this folder can then use <em>relative paths</em> to files. Relative paths
indicate where inside the project a file is located (as opposed to absolute paths, 
which point to where a file is on a specific computer). Working this way makes it
a lot easier to move your project around on your computer and share it with
others without having to directly modify file paths in the individual scripts.</p>

<p>RStudio provides a helpful set of tools to do this through its “Projects”
interface, which not only creates a working directory for you but also remembers
its location (allowing you to quickly navigate to it). The interface also 
(optionally) preserves custom settings and open files to make it easier to 
resume work after a break.</p>

<h3 id="create-a-new-project">Create a new project</h3>

<ul>
  <li>Under the <code class="language-plaintext highlighter-rouge">File</code> menu, click on <code class="language-plaintext highlighter-rouge">New project</code>, choose <code class="language-plaintext highlighter-rouge">New directory</code>, then
<code class="language-plaintext highlighter-rouge">New project</code></li>
  <li>Enter a name for this new folder (or “directory”) and choose a convenient
location for it. This will be your <strong>working directory</strong> for the rest of the
day (e.g., <code class="language-plaintext highlighter-rouge">~/data-carpentry</code>)</li>
  <li>Click on <code class="language-plaintext highlighter-rouge">Create project</code></li>
  <li>Create a new file where we will type our scripts. Go to File &gt; New File &gt; R
script. Click the save icon on your toolbar and save your script as
“<code class="language-plaintext highlighter-rouge">script.R</code>”.</li>
</ul>

<h3 id="the-rstudio-interface">The RStudio Interface</h3>
<p>Let’s take a quick tour of RStudio.</p>

<p><img src="../fig/R_00_Rstudio_01.png" alt="RStudio_startup" /></p>

<p>RStudio is divided into four “panes”. The placement of these
panes and their content can be customized (see menu, Tools -&gt; Global Options -&gt;
Pane Layout).</p>

<p>The Default Layout is:</p>
<ul>
  <li>Top Left - <strong>Source</strong>: your scripts and documents</li>
  <li>Bottom Left - <strong>Console</strong>: what R would look and be like without RStudio</li>
  <li>Top Right - <strong>Enviornment/History</strong>: look here to see what you have done</li>
  <li>Bottom Right - <strong>Files</strong> and more: see the contents of the project/working directory here, like your Script.R file</li>
</ul>

<h3 id="organizing-your-working-directory">Organizing your working directory</h3>

<p>Using a consistent folder structure across your projects will help keep things
organized and make it easy to find/file things in the future. This
can be especially helpful when you have multiple projects. In general, you might
create directories (folders) for <strong>scripts</strong>, <strong>data</strong>, and <strong>documents</strong>. Here
are some examples of suggested directories:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">data/</code></strong> Use this folder to store your raw data and intermediate datasets. 
For the sake of transparency and <a href="https://en.wikipedia.org/wiki/Provenance">provenance</a>, you
should <em>always</em> keep a copy of your raw data accessible and do as much of
your data cleanup and preprocessing programmatically (i.e., with scripts,
rather than manually) as possible.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">data_output/</code></strong> When you need to modify your raw data,
it might be useful to store the modified versions of the datasets in a different folder.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">documents/</code></strong> Used for outlines, drafts, and other
text.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">fig_output/</code></strong> This folder can store the graphics that are generated
by your scripts.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">scripts/</code></strong> A place to keep your R scripts for
different analyses or plotting.</li>
</ul>

<p>You may want additional directories or subdirectories depending on your project
needs, but these should form the backbone of your working directory.</p>

<p><img src="../fig/working-directory-structure.png" alt="Example of a working directory structure" /></p>

<h3 id="the-working-directory">The working directory</h3>

<p>The working directory is an important concept to understand. It is the place
where R will look for and save files. When you write code for
your project, your scripts should refer to files in relation to the root of your working
directory and only to files within this structure.</p>

<p>Using RStudio projects makes this easy and ensures that your working directory
is set up properly. If you need to check it, you can use <code class="language-plaintext highlighter-rouge">getwd()</code>. If for some
reason your working directory is not what it should be, you can change it in the
RStudio interface by navigating in the file browser to where your working directory
should be, clicking on the blue gear icon “More”, and selecting “Set As Working
Directory”. Alternatively, you can use <code class="language-plaintext highlighter-rouge">setwd("/path/to/working/directory")</code> to
reset your working directory. However, your scripts should not include this line,
because it will fail on someone else’s computer.</p>

<h3 id="downloading-the-data-and-getting-set-up">Downloading the data and getting set up</h3>

<p>For this lesson we will use the following folders in our working directory: <strong><code class="language-plaintext highlighter-rouge">data/</code></strong>, <strong><code class="language-plaintext highlighter-rouge">data_output/</code></strong> and <strong><code class="language-plaintext highlighter-rouge">fig_output/</code></strong>. Let’s write them all in lowercase to be consistent. We can create them using the RStudio interface by clicking on the “New Folder” button in the file pane (bottom right), or directly from R by typing at console:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dir.create</span><span class="p">(</span><span class="s2">"data"</span><span class="p">)</span><span class="w">
</span><span class="n">dir.create</span><span class="p">(</span><span class="s2">"data_output"</span><span class="p">)</span><span class="w">
</span><span class="n">dir.create</span><span class="p">(</span><span class="s2">"fig_output"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Go to the Figshare page for this curriculum and download the dataset called “<code class="language-plaintext highlighter-rouge">SAFI_clean.csv</code>”. The direct download link is: <a href="https://ndownloader.figshare.com/files/11492171">https://ndownloader.figshare.com/files/11492171</a>. Place this downloaded file in the <code class="language-plaintext highlighter-rouge">data/</code> you just created. You can do this directly from R by copying and pasting this in your terminal (your instructor can place this chunk of code in the Etherpad):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">download.file</span><span class="p">(</span><span class="s2">"https://ndownloader.figshare.com/files/11492171"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"data/SAFI_clean.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"wb"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="interacting-with-r">Interacting with R</h2>

<p>The basis of programming is that we write down instructions for the computer to
follow, and then we tell the computer to follow those instructions. We write, or
<em>code</em>, instructions in R because it is a common language that both the computer
and we can understand. We call the instructions <em>commands</em> and we tell the
computer to follow the instructions by <em>executing</em> (also called <em>running</em>) those
commands.</p>

<p>There are two main ways of interacting with R: by using the console or by using
script files (plain text files that contain your code). The console pane (in
RStudio, the bottom left panel) is the place where commands written in the R
language can be typed and executed immediately by the computer. It is also where
the results will be shown for commands that have been executed. You can type
commands directly into the console and press <kbd>Enter</kbd> to execute those commands,
but they will be forgotten when you close the session.</p>

<p>Because we want our code and workflow to be reproducible, it is better to type
the commands we want in the script editor and save the script. This way, there
is a complete record of what we did, and anyone (including our future selves!)
can easily replicate the results on their computer.</p>

<p>RStudio allows you to execute commands directly from the script editor by using
the <kbd>Ctrl</kbd> + <kbd>Enter</kbd> shortcut (on Mac, <kbd>Cmd</kbd> +
<kbd>Return</kbd> will work). The command on the current line in the
script (indicated by the cursor) or all of the commands in
selected text will be sent to the console and executed when you press
<kbd>Ctrl</kbd> + <kbd>Enter</kbd>. If there is information in the console
you do not need anymore, you can clear it with <kbd>Ctrl</kbd> + <kbd>L</kbd>.
You can find other keyboard shortcuts in this
<a href="https://github.com/rstudio/cheatsheets/raw/master/rstudio-ide.pdf">RStudio cheatsheet about the RStudio IDE</a>.</p>

<p>At some point in your analysis, you may want to check the content of a variable
or the structure of an object without necessarily keeping a record of it in
your script. You can type these commands and execute them directly in the
console.  RStudio provides the <kbd>Ctrl</kbd> + <kbd>1</kbd> and
<kbd>Ctrl</kbd> + <kbd>2</kbd> shortcuts allow you to jump between the
script and the console panes.</p>

<p>If R is ready to accept commands, the R console shows a <code class="language-plaintext highlighter-rouge">&gt;</code> prompt. If R
receives a command (by typing, copy-pasting, or sent from the script editor using
<kbd>Ctrl</kbd> + <kbd>Enter</kbd>), R will try to execute it and, when
ready, will show the results and come back with a new <code class="language-plaintext highlighter-rouge">&gt;</code> prompt to wait for new
commands.</p>

<p>If R is still waiting for you to enter more text,
the console will show a <code class="language-plaintext highlighter-rouge">+</code> prompt. It means that you haven’t finished entering
a complete command. This is likely because you have not ‘closed’ a parenthesis or
quotation, i.e. you don’t have the same number of left-parentheses as
right-parentheses or the same number of opening and closing quotation marks.
When this happens, and you thought you finished typing your command, click
inside the console window and press <kbd>Esc</kbd>; this will cancel the
incomplete command and return you to the <code class="language-plaintext highlighter-rouge">&gt;</code> prompt. You can then proofread
the command(s) you entered and correct the error.</p>

<h2 id="installing-additional-packages-using-the-packages-tab">Installing additional packages using the packages tab</h2>

<p>In addition to the core R installation, there are in excess of
10,000 additional packages which can be used to extend the
functionality of R. Many of these have been written by R users and
have been made available in central repositories, like the one
hosted at CRAN, for anyone to download and install into their own R
environment. In the course of this lesson we will be making use of
several of these packages, such as ‘ggplot2’ and ‘dplyr’.</p>

<p>Additional packages can be installed from the ‘packages’ tab.
On the packages tab, click the ‘Install’ icon and start typing the
name of the package you want in the text box. As you type, packages
matching your starting characters will be displayed in a drop-down
list so that you can select them.</p>

<p><img src="../fig/R_00_Rstudio_03.png" alt="Install Packages Window" /></p>

<p>At the bottom of the Install Packages window is a check box to
‘Install’ dependencies. This is ticked by default, which is usually
what you want. Packages can (and do) make use of functionality
built into other packages, so for the functionality contained in
the package you are installing to work properly, there may be other
packages which have to be installed with them. The ‘Install
dependencies’ option makes sure that this happens.</p>

<blockquote class="challenge">
  <h2 id="exercise">Exercise</h2>

  <p>Use the install option from the packages tab to install the ‘tidyverse’ package.</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>
    <p>From the packages tab, click ‘Install’ from the toolbar and type ‘tidyverse’ into the textbox, then click ‘install’.
The ‘tidyverse’ package is really a package of packages, including ‘ggplot2’ and ‘dplyr’, both of which require other packages to run correctly. All of these packages will be installed automatically. 
Depending on what packages have previously been installed in your R environment, the install of ‘tidyverse’ could be very quick or could take several minutes.
As the install proceeds, messages relating to its progress will be written to the console. You will be able to see all of the packages which are actually being installed.</p>
  </blockquote>
</blockquote>

<p>Because the install process accesses the CRAN repository, you
will need an Internet connection to install packages.</p>

<p>It is also possible to install packages from other repositories, as
well as Github or the local file system, but we won’t be looking at these options in this lesson.</p>

<h2 id="installing-additional-packages-using-r-code">Installing additional packages using R code</h2>

<p>If you were watching the console window when you started the
install of ‘tidyverse’, you may have noticed that the line</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"tidyverse"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>was written to the console before the start of the installation messages.</p>

<p>You could also have installed the <strong><code class="language-plaintext highlighter-rouge">tidyverse</code></strong> packages by running this command directly at the R terminal.</p>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use RStudio to write and run R programs.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">install.packages()</code> to install packages (libraries).</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="introduction-to-r" class="maintitle">Introduction to R</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 50 min
      <br />
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What data types are available in R?</p>
</li>
	
	<li><p>What is an object?</p>
</li>
	
	<li><p>How can values be initially assigned to variables of different data types?</p>
</li>
	
	<li><p>What arithmetic and logical operators can be used?</p>
</li>
	
	<li><p>How can subsets be extracted from vectors?</p>
</li>
	
	<li><p>How does R treat missing values?</p>
</li>
	
	<li><p>How can we deal with missing values in R?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Define the following terms as they relate to R: object, assign, call, function, arguments, options.</p>
</li>
	
	<li><p>Assign values to objects in R.</p>
</li>
	
	<li><p>Learn how to name objects.</p>
</li>
	
	<li><p>Use comments to inform script.</p>
</li>
	
	<li><p>Solve simple arithmetic operations in R.</p>
</li>
	
	<li><p>Call functions and use arguments to change their default options.</p>
</li>
	
	<li><p>Inspect the content of vectors and manipulate their content.</p>
</li>
	
	<li><p>Subset and extract values from vectors.</p>
</li>
	
	<li><p>Analyze vectors with missing data.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="creating-objects-in-r">Creating objects in R</h2>

<p>You can get output from R simply by typing math in the console:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 8
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">12</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">7</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1.714286
</code></pre></div></div>

<p>However, to do useful and interesting things, we need to assign <em>values</em> to
<em>objects</em>. To create an object, we need to give it a name followed by the
assignment operator <code class="language-plaintext highlighter-rouge">&lt;-</code>, and the value we want to give it:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">area_hectares</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1.0</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">&lt;-</code> is the assignment operator. It assigns values on the right to objects on
the left. So, after executing <code class="language-plaintext highlighter-rouge">x &lt;- 3</code>, the value of <code class="language-plaintext highlighter-rouge">x</code> is <code class="language-plaintext highlighter-rouge">3</code>. The arrow can
be read as 3 <strong>goes into</strong> <code class="language-plaintext highlighter-rouge">x</code>.  For historical reasons, you can also use <code class="language-plaintext highlighter-rouge">=</code>
for assignments, but not in every context. Because of the
<a href="http://blog.revolutionanalytics.com/2008/12/use-equals-or-arrow-for-assignment.html">slight</a>
<a href="http://r.789695.n4.nabble.com/Is-there-any-difference-between-and-tp878594p878598.html">differences</a>
in syntax, it is good practice to always use <code class="language-plaintext highlighter-rouge">&lt;-</code> for assignments. More 
generally we prefer the <code class="language-plaintext highlighter-rouge">&lt;-</code> syntax over <code class="language-plaintext highlighter-rouge">=</code> because it makes it clear what
direction the assignment is operating (left assignment), and it increases the
read-ability of the code.</p>

<p>In RStudio, typing <kbd>Alt</kbd> + <kbd>-</kbd> (push <kbd>Alt</kbd> at the
same time as the <kbd>-</kbd> key) will write <code class="language-plaintext highlighter-rouge">&lt;- </code> in a single keystroke in a
PC, while typing <kbd>Option</kbd> + <kbd>-</kbd> (push <kbd>Option</kbd> at the
same time as the <kbd>-</kbd> key) does the same in a Mac.</p>

<p>Objects can be given any name such as <code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">current_temperature</code>, or
<code class="language-plaintext highlighter-rouge">subject_id</code>. You want your object names to be explicit and not too long. They
cannot start with a number (<code class="language-plaintext highlighter-rouge">2x</code> is not valid, but <code class="language-plaintext highlighter-rouge">x2</code> is). R is case sensitive
(e.g., <code class="language-plaintext highlighter-rouge">age</code> is different from <code class="language-plaintext highlighter-rouge">Age</code>). There are some names that
cannot be used because they are the names of fundamental functions in R (e.g.,
<code class="language-plaintext highlighter-rouge">if</code>, <code class="language-plaintext highlighter-rouge">else</code>, <code class="language-plaintext highlighter-rouge">for</code>, see
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Reserved.html">here</a>
for a complete list). In general, even if it’s allowed, it’s best to not use
other function names (e.g., <code class="language-plaintext highlighter-rouge">c</code>, <code class="language-plaintext highlighter-rouge">T</code>, <code class="language-plaintext highlighter-rouge">mean</code>, <code class="language-plaintext highlighter-rouge">data</code>, <code class="language-plaintext highlighter-rouge">df</code>, <code class="language-plaintext highlighter-rouge">weights</code>). If in
doubt, check the help to see if the name is already in use. It’s also best to
avoid dots (<code class="language-plaintext highlighter-rouge">.</code>) within an object name as in <code class="language-plaintext highlighter-rouge">my.dataset</code>. There are many
functions in R with dots in their names for historical reasons, but because dots
have a special meaning in R (for methods) and other programming languages, it’s
best to avoid them. It is also recommended to use nouns for object names, and
verbs for function names. It’s important to be consistent in the styling of your
code (where you put spaces, how you name objects, etc.). Using a consistent
coding style makes your code clearer to read for your future self and your
collaborators. In R, three popular style guides are
<a href="https://google.github.io/styleguide/Rguide.xml">Google’s</a>, <a href="http://jef.works/R-style-guide/">Jean
Fan’s</a> and the
<a href="http://style.tidyverse.org/">tidyverse’s</a>. The tidyverse’s is very
comprehensive and may seem overwhelming at first. You can install the
<a href="https://github.com/jimhester/lintr"><strong><code class="language-plaintext highlighter-rouge">lintr</code></strong></a> package to automatically check
for issues in the styling of your code.</p>

<blockquote class="callout">
  <h2 id="objects-vs-variables">Objects vs. variables</h2>

  <p>What are known as <code class="language-plaintext highlighter-rouge">objects</code> in <code class="language-plaintext highlighter-rouge">R</code> are known as <code class="language-plaintext highlighter-rouge">variables</code> in many other
programming languages. Depending on the context, <code class="language-plaintext highlighter-rouge">object</code> and <code class="language-plaintext highlighter-rouge">variable</code> can
have drastically different meanings. However, in this lesson, the two words
are used synonymously. For more information see:
<a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Objects">https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Objects</a></p>
</blockquote>

<p>When assigning a value to an object, R does not print anything. You
can force R to print the value by using parentheses or by typing
the object name:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">area_hectares</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1.0</span><span class="w">    </span><span class="c1"># doesn't print anything</span><span class="w">
</span><span class="p">(</span><span class="n">area_hectares</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1.0</span><span class="p">)</span><span class="w">  </span><span class="c1"># putting parenthesis around the call prints the value of `area_hectares`</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">area_hectares</span><span class="w">         </span><span class="c1"># and so does typing the name of the object</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1
</code></pre></div></div>

<p>Now that R has <code class="language-plaintext highlighter-rouge">area_hectares</code> in memory, we can do arithmetic with it. For
instance, we may want to convert this area into acres (area in acres is 2.47 times the area in hectares):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">2.47</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">area_hectares</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2.47
</code></pre></div></div>

<p>We can also change an object’s value by assigning it a new one:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">area_hectares</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2.5</span><span class="w">
</span><span class="m">2.47</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">area_hectares</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 6.175
</code></pre></div></div>

<p>This means that assigning a value to one object does not change the values of
other objects. For example, let’s store the plot’s area in acres
in a new object, <code class="language-plaintext highlighter-rouge">area_acres</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">area_acres</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2.47</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">area_hectares</span><span class="w">
</span></code></pre></div></div>

<p>and then change <code class="language-plaintext highlighter-rouge">area_hectares</code> to 50.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">area_hectares</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">50</span><span class="w">
</span></code></pre></div></div>

<blockquote class="challenge">
  <h2 id="exercise">Exercise</h2>

  <p>What do you think is the current content of the object <code class="language-plaintext highlighter-rouge">area_acres</code>? 123.5 or
6.175?</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <p>The value of <code class="language-plaintext highlighter-rouge">area_acres</code> is still 6.175 because you have not
re-run the line <code class="language-plaintext highlighter-rouge">area_acres &lt;- 2.47 * area_hectares</code> since
changing the value of <code class="language-plaintext highlighter-rouge">area_hectares</code>.</p>
  </blockquote>
</blockquote>

<h2 id="comments">Comments</h2>

<p>All programming languages allow the programmer to include comments in their code. To do this in R we use the <code class="language-plaintext highlighter-rouge">#</code> character.
Anything to the right of the <code class="language-plaintext highlighter-rouge">#</code> sign and up to the end of the line is treated as a comment and is ignored by R. You can start lines with comments
or include them after any code on the line.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">area_hectares</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1.0</span><span class="w">			</span><span class="c1"># land area in hectares</span><span class="w">
</span><span class="n">area_acres</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">area_hectares</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2.47</span><span class="w">	</span><span class="c1"># convert to acres</span><span class="w">
</span><span class="n">area_acres</span><span class="w">				</span><span class="c1"># print land area in acres.</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2.47
</code></pre></div></div>

<p>RStudio makes it easy to comment or uncomment a paragraph: after selecting the
lines you  want to comment, press at the same time on your keyboard
<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd>. If you only want to comment
out one line, you can put the cursor at any location of that line (i.e. no need
to select the whole line), then press <kbd>Ctrl</kbd> + <kbd>Shift</kbd> +
<kbd>C</kbd>.</p>

<blockquote class="challenge">
  <h2 id="exercise-1">Exercise</h2>

  <p>Create two variables <code class="language-plaintext highlighter-rouge">length</code> and <code class="language-plaintext highlighter-rouge">width</code> and assign them values. It should be noted that, because <code class="language-plaintext highlighter-rouge">length</code> and <code class="language-plaintext highlighter-rouge">width</code> are built-in R functions, R Studio might add “()” after length and width and if you leave the parentheses you will get unexpected results. This is why you might see other programmers abbreviate common words.
Create a third variable <code class="language-plaintext highlighter-rouge">area</code> and give it a value based on the current values of <code class="language-plaintext highlighter-rouge">length</code> and <code class="language-plaintext highlighter-rouge">width</code>.
Show that changing the values of either <code class="language-plaintext highlighter-rouge">length</code> and <code class="language-plaintext highlighter-rouge">width</code> does not affect the value of <code class="language-plaintext highlighter-rouge">area</code>.</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2.5</span><span class="w">
</span><span class="n">width</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">3.2</span><span class="w">
</span><span class="n">area</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w">
</span><span class="n">area</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 8
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># change the values of length and width</span><span class="w">
</span><span class="n">length</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">7.0</span><span class="w">
</span><span class="n">width</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">6.5</span><span class="w">
</span><span class="c1"># the value of area isn't changed</span><span class="w">
</span><span class="n">area</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 8
</code></pre></div>    </div>

  </blockquote>
</blockquote>

<h3 id="functions-and-their-arguments">Functions and their arguments</h3>

<p>Functions are “canned scripts” that automate more complicated sets of commands
including operations assignments, etc. Many functions are predefined, or can be
made available by importing R <em>packages</em> (more on that later). A function
usually gets one or more inputs called <em>arguments</em>. Functions often (but not
always) return a <em>value</em>. A typical example would be the function <code class="language-plaintext highlighter-rouge">sqrt()</code>. The
input (the argument) must be a number, and the return value (in fact, the
output) is the square root of that number. Executing a function (‘running it’)
is called <em>calling</em> the function. An example of a function call is:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>Here, the value of <code class="language-plaintext highlighter-rouge">a</code> is given to the <code class="language-plaintext highlighter-rouge">sqrt()</code> function, the <code class="language-plaintext highlighter-rouge">sqrt()</code> function
calculates the square root, and returns the value which is then assigned to
the object <code class="language-plaintext highlighter-rouge">b</code>. This function is very simple, because it takes just one argument.</p>

<p>The return ‘value’ of a function need not be numerical (like that of <code class="language-plaintext highlighter-rouge">sqrt()</code>),
and it also does not need to be a single item: it can be a set of things, or
even a dataset. We’ll see that when we read data files into R.</p>

<p>Arguments can be anything, not only numbers or filenames, but also other
objects. Exactly what each argument means differs per function, and must be
looked up in the documentation (see below). Some functions take arguments which
may either be specified by the user, or, if left out, take on a <em>default</em> value:
these are called <em>options</em>. Options are typically used to alter the way the
function operates, such as whether it ignores ‘bad values’, or what symbol to
use in a plot.  However, if you want something specific, you can specify a value
of your choice which will be used instead of the default.</p>

<p>Let’s try a function that can take multiple arguments: <code class="language-plaintext highlighter-rouge">round()</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">round</span><span class="p">(</span><span class="m">3.14159</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 3
</code></pre></div></div>

<p>Here, we’ve called <code class="language-plaintext highlighter-rouge">round()</code> with just one argument, <code class="language-plaintext highlighter-rouge">3.14159</code>, and it has
returned the value <code class="language-plaintext highlighter-rouge">3</code>.  That’s because the default is to round to the nearest
whole number. If we want more digits we can see how to do that by getting
information about the <code class="language-plaintext highlighter-rouge">round</code> function.  We can use <code class="language-plaintext highlighter-rouge">args(round)</code> or look at the
help for this function using <code class="language-plaintext highlighter-rouge">?round</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">args</span><span class="p">(</span><span class="n">round</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function (x, digits = 0) 
NULL
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">round</span><span class="w">
</span></code></pre></div></div>

<p>We see that if we want a different number of digits, we can
type <code class="language-plaintext highlighter-rouge">digits=2</code> or however many we want.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">round</span><span class="p">(</span><span class="m">3.14159</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 3.14
</code></pre></div></div>

<p>If you provide the arguments in the exact same order as they are defined you
don’t have to name them:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">round</span><span class="p">(</span><span class="m">3.14159</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 3.14
</code></pre></div></div>

<p>And if you do name the arguments, you can switch their order:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">round</span><span class="p">(</span><span class="n">digits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3.14159</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 3.14
</code></pre></div></div>

<p>It’s good practice to put the non-optional arguments (like the number you’re
rounding) first in your function call, and to specify the names of all optional
arguments.  If you don’t, someone reading your code might have to look up the
definition of a function with unfamiliar arguments to understand what you’re
doing.</p>

<blockquote class="challenge">
  <h2 id="exercise-2">Exercise</h2>

  <p>Type in <code class="language-plaintext highlighter-rouge">?round</code> at the console and then look at the output in the Help pane.
What other functions exist that are similar to <code class="language-plaintext highlighter-rouge">round</code>?
How do you use the <code class="language-plaintext highlighter-rouge">digits</code> parameter in the round function?</p>
</blockquote>

<h2 id="vectors-and-data-types">Vectors and data types</h2>

<p>A vector is the most common and basic data type in R, and is pretty much
the workhorse of R. A vector is composed by a series of values, which can be
either numbers or characters. We can assign a series of values to a vector using
the <code class="language-plaintext highlighter-rouge">c()</code> function. For example we can create a vector of the number of household
members for the households we’ve interviewed and assign
it to a new object <code class="language-plaintext highlighter-rouge">hh_members</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hh_members</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">hh_members</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  3  7 10  6
</code></pre></div></div>

<p>A vector can also contain characters. For example, we can have
a vector of the building material used to construct our
interview respondents’ walls (<code class="language-plaintext highlighter-rouge">respondent_wall_type</code>):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">respondent_wall_type</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"muddaub"</span><span class="p">,</span><span class="w"> </span><span class="s2">"burntbricks"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sunbricks"</span><span class="p">)</span><span class="w">
</span><span class="n">respondent_wall_type</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "muddaub"     "burntbricks" "sunbricks"  
</code></pre></div></div>

<p>The quotes around “muddaub”, etc. are essential here. Without the quotes R
will assume there are objects called <code class="language-plaintext highlighter-rouge">muddaub</code>, <code class="language-plaintext highlighter-rouge">burntbricks</code> and <code class="language-plaintext highlighter-rouge">sunbricks</code>. As these objects
don’t exist in R’s memory, there will be an error message.</p>

<p>There are many functions that allow you to inspect the content of a
vector. <code class="language-plaintext highlighter-rouge">length()</code> tells you how many elements are in a particular vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">hh_members</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 4
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 3
</code></pre></div></div>

<p>An important feature of a vector, is that all of the elements are the same type of data.
The function <code class="language-plaintext highlighter-rouge">class()</code> indicates the class (the type of element) of an object:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">class</span><span class="p">(</span><span class="n">hh_members</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "numeric"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">class</span><span class="p">(</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "character"
</code></pre></div></div>

<p>The function <code class="language-plaintext highlighter-rouge">str()</code> provides an overview of the structure of an object and its
elements. It is a useful function when working with large and complex
objects:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">hh_members</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> num [1:4] 3 7 10 6
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> chr [1:3] "muddaub" "burntbricks" "sunbricks"
</code></pre></div></div>

<p>You can use the <code class="language-plaintext highlighter-rouge">c()</code> function to add other elements to your vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">possessions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"bicycle"</span><span class="p">,</span><span class="w"> </span><span class="s2">"radio"</span><span class="p">,</span><span class="w"> </span><span class="s2">"television"</span><span class="p">)</span><span class="w">
</span><span class="n">possessions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">possessions</span><span class="p">,</span><span class="w"> </span><span class="s2">"mobile_phone"</span><span class="p">)</span><span class="w"> </span><span class="c1"># add to the end of the vector</span><span class="w">
</span><span class="n">possessions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"car"</span><span class="p">,</span><span class="w"> </span><span class="n">possessions</span><span class="p">)</span><span class="w"> </span><span class="c1"># add to the beginning of the vector</span><span class="w">
</span><span class="n">possessions</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "car"          "bicycle"      "radio"        "television"   "mobile_phone"
</code></pre></div></div>

<p>In the first line, we take the original vector <code class="language-plaintext highlighter-rouge">possessions</code>,
add the value <code class="language-plaintext highlighter-rouge">"mobile_phone"</code> to the end of it, and save the result back into
<code class="language-plaintext highlighter-rouge">possessions</code>. Then we add the value <code class="language-plaintext highlighter-rouge">"car"</code> to the beginning, again saving the result
back into <code class="language-plaintext highlighter-rouge">possessions</code>.</p>

<p>We can do this over and over again to grow a vector, or assemble a dataset.
As we program, this may be useful to add results that we are collecting or
calculating.</p>

<p>An <strong>atomic vector</strong> is the simplest R <strong>data type</strong> and is a linear vector of a single type. Above, we saw
2 of the 6 main <strong>atomic vector</strong> types  that R
uses: <code class="language-plaintext highlighter-rouge">"character"</code> and <code class="language-plaintext highlighter-rouge">"numeric"</code> (or <code class="language-plaintext highlighter-rouge">"double"</code>). These are the basic building blocks that
all R objects are built from. The other 4 <strong>atomic vector</strong> types are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">"logical"</code> for <code class="language-plaintext highlighter-rouge">TRUE</code> and <code class="language-plaintext highlighter-rouge">FALSE</code> (the boolean data type)</li>
  <li><code class="language-plaintext highlighter-rouge">"integer"</code> for integer numbers (e.g., <code class="language-plaintext highlighter-rouge">2L</code>, the <code class="language-plaintext highlighter-rouge">L</code> indicates to R that it’s an integer)</li>
  <li><code class="language-plaintext highlighter-rouge">"complex"</code> to represent complex numbers with real and imaginary parts (e.g.,
<code class="language-plaintext highlighter-rouge">1 + 4i</code>) and that’s all we’re going to say about them</li>
  <li><code class="language-plaintext highlighter-rouge">"raw"</code> for bitstreams that we won’t discuss further</li>
</ul>

<p>You can check the type of your vector using the <code class="language-plaintext highlighter-rouge">typeof()</code> function and inputting your vector as the argument.</p>

<p>Vectors are one of the many <strong>data structures</strong> that R uses. Other important
ones are lists (<code class="language-plaintext highlighter-rouge">list</code>), matrices (<code class="language-plaintext highlighter-rouge">matrix</code>), data frames (<code class="language-plaintext highlighter-rouge">data.frame</code>),
factors (<code class="language-plaintext highlighter-rouge">factor</code>) and arrays (<code class="language-plaintext highlighter-rouge">array</code>).</p>

<blockquote class="challenge">
  <h2 id="exercise-3">Exercise</h2>

  <p>We’ve seen that atomic vectors can be of type character, numeric (or double),
  integer, and logical. But what happens if we try to mix these types in a
  single vector?</p>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>

    <p>R implicitly converts them to all be the same type.</p>
  </blockquote>

  <p>What will happen in each of these examples? (hint: use <code class="language-plaintext highlighter-rouge">class()</code>
to check the data type of your objects):</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">num_char</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="s2">"a"</span><span class="p">)</span><span class="w">
 </span><span class="n">num_logical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
 </span><span class="n">char_logical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
 </span><span class="n">tricky</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="s2">"4"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <p>Why do you think it happens?</p>

  <blockquote class="solution">
    <h2 id="solution-3">Solution</h2>

    <p>Vectors can be of only one data type. R tries to
convert (coerce) the content of this vector to find a “common
denominator” that doesn’t lose any information.</p>
  </blockquote>

  <p>How many values in <code class="language-plaintext highlighter-rouge">combined_logical</code> are <code class="language-plaintext highlighter-rouge">"TRUE"</code> (as a character) in the
following example:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_logical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">char_logical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">combined_logical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">num_logical</span><span class="p">,</span><span class="w"> </span><span class="n">char_logical</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>
  <p> </p>

  <blockquote class="solution">
    <h2 id="solution-4">Solution</h2>

    <p>Only one. There is no memory of past data types, and the coercion
happens the
first time the vector is evaluated. Therefore, the <code class="language-plaintext highlighter-rouge">TRUE</code> in
<code class="language-plaintext highlighter-rouge">num_logical</code>
gets converted into a <code class="language-plaintext highlighter-rouge">1</code> before it gets converted into <code class="language-plaintext highlighter-rouge">"1"</code> in
<code class="language-plaintext highlighter-rouge">combined_logical</code>.</p>
  </blockquote>

  <p>You’ve probably noticed that objects of different types get
  converted into a single, shared type within a vector. In R, we
  call converting objects from one class into another class
  <em>coercion</em>. These conversions happen according to a hierarchy,
  whereby some types get preferentially coerced into other
  types. Can you draw a diagram that represents the hierarchy of how
  these data types are coerced?</p>

</blockquote>

<h2 id="subsetting-vectors">Subsetting vectors</h2>

<p>If we want to extract one or several values from a vector, we must provide one
or several indices in square brackets. For instance:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">respondent_wall_type</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"muddaub"</span><span class="p">,</span><span class="w"> </span><span class="s2">"burntbricks"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sunbricks"</span><span class="p">)</span><span class="w">
</span><span class="n">respondent_wall_type</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "burntbricks"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">respondent_wall_type</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "sunbricks"   "burntbricks"
</code></pre></div></div>

<p>We can also repeat the indices to create an object with more elements than the
original one:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">more_respondent_wall_type</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)]</span><span class="w">
</span><span class="n">more_respondent_wall_type</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "muddaub"     "burntbricks" "sunbricks"   "burntbricks" "muddaub"    
[6] "sunbricks"  
</code></pre></div></div>

<p>R indices start at 1. Programming languages like Fortran, MATLAB, Julia, and R
start counting at 1, because that’s what human beings typically do. Languages in
the C family (including C++, Java, Perl, and Python) count from 0 because that’s
simpler for computers to do.</p>

<h3 id="conditional-subsetting">Conditional subsetting</h3>

<p>Another common way of subsetting is by using a logical vector. <code class="language-plaintext highlighter-rouge">TRUE</code> will
select the element with the same index, while <code class="language-plaintext highlighter-rouge">FALSE</code> will not:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hh_members</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">hh_members</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  3 10  6
</code></pre></div></div>

<p>Typically, these logical vectors are not typed by hand, but are the output of
other functions or logical tests. For instance, if you wanted to select only the
values above 5:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hh_members</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="w">    </span><span class="c1"># will return logicals with TRUE for the indices that meet the condition</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] FALSE  TRUE  TRUE  TRUE
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## so we can use this to select only the values above 5</span><span class="w">
</span><span class="n">hh_members</span><span class="p">[</span><span class="n">hh_members</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  7 10  6
</code></pre></div></div>

<p>You can combine multiple tests using <code class="language-plaintext highlighter-rouge">&amp;</code> (both conditions are true, AND) or <code class="language-plaintext highlighter-rouge">|</code>
(at least one of the conditions is true, OR):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hh_members</span><span class="p">[</span><span class="n">hh_members</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hh_members</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">7</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  3 10
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hh_members</span><span class="p">[</span><span class="n">hh_members</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">hh_members</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>numeric(0)
</code></pre></div></div>

<p>Here, <code class="language-plaintext highlighter-rouge">&lt;</code> stands for “less than”, <code class="language-plaintext highlighter-rouge">&gt;</code> for “greater than”, <code class="language-plaintext highlighter-rouge">&gt;=</code> for “greater than
or equal to”, and <code class="language-plaintext highlighter-rouge">==</code> for “equal to”. The double equal sign <code class="language-plaintext highlighter-rouge">==</code> is a test for
numerical equality between the left and right hand sides, and should not be
confused with the single <code class="language-plaintext highlighter-rouge">=</code> sign, which performs variable assignment (similar
to <code class="language-plaintext highlighter-rouge">&lt;-</code>).</p>

<p>A common task is to search for certain strings in a vector.  One could use the
“or” operator <code class="language-plaintext highlighter-rouge">|</code> to test for equality to multiple values, but this can quickly
become tedious.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">possessions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"car"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bicycle"</span><span class="p">,</span><span class="w"> </span><span class="s2">"radio"</span><span class="p">,</span><span class="w"> </span><span class="s2">"television"</span><span class="p">,</span><span class="w"> </span><span class="s2">"mobile_phone"</span><span class="p">)</span><span class="w">
</span><span class="n">possessions</span><span class="p">[</span><span class="n">possessions</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"car"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possessions</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"bicycle"</span><span class="p">]</span><span class="w"> </span><span class="c1"># returns both car and bicycle</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "car"     "bicycle"
</code></pre></div></div>

<p>The function <code class="language-plaintext highlighter-rouge">%in%</code> allows you to test if any of the elements of a search vector
(on the left hand side) are found in the target vector (on the right hand side):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">possessions</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"car"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bicycle"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  TRUE  TRUE FALSE FALSE FALSE
</code></pre></div></div>

<p>Note that the output is the same length as the search vector on the left hand
side, because <code class="language-plaintext highlighter-rouge">%in%</code> checks whether each element of the search vector is found
somewhere in the target vector. Thus, you can use <code class="language-plaintext highlighter-rouge">%in%</code> to select the elements
in the search vector that appear in your target vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">possessions</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"car"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bicycle"</span><span class="p">,</span><span class="w"> </span><span class="s2">"motorcycle"</span><span class="p">,</span><span class="w"> </span><span class="s2">"truck"</span><span class="p">,</span><span class="w"> </span><span class="s2">"boat"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bus"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  TRUE  TRUE FALSE FALSE FALSE
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">possessions</span><span class="p">[</span><span class="n">possessions</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"car"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bicycle"</span><span class="p">,</span><span class="w"> </span><span class="s2">"motorcycle"</span><span class="p">,</span><span class="w"> </span><span class="s2">"truck"</span><span class="p">,</span><span class="w"> </span><span class="s2">"boat"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bus"</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "car"     "bicycle"
</code></pre></div></div>

<h2 id="missing-data">Missing data</h2>

<p>As R was designed to analyze datasets, it includes the concept of missing data
(which is uncommon in other programming languages). Missing data are represented
in vectors as <code class="language-plaintext highlighter-rouge">NA</code>.</p>

<p>When doing operations on numbers, most functions will return <code class="language-plaintext highlighter-rouge">NA</code> if the data
you are working with include missing values. This feature
makes it harder to overlook the cases where you are dealing with missing data.
You can add the argument <code class="language-plaintext highlighter-rouge">na.rm=TRUE</code> to calculate the result while ignoring
the missing values.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rooms</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">mean</span><span class="p">(</span><span class="n">rooms</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] NA
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">max</span><span class="p">(</span><span class="n">rooms</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] NA
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span><span class="p">(</span><span class="n">rooms</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">max</span><span class="p">(</span><span class="n">rooms</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 4
</code></pre></div></div>

<p>If your data include missing values, you may want to become familiar with the
functions <code class="language-plaintext highlighter-rouge">is.na()</code>, <code class="language-plaintext highlighter-rouge">na.omit()</code>, and <code class="language-plaintext highlighter-rouge">complete.cases()</code>. See below for
examples.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Extract those elements which are not missing values.</span><span class="w">
</span><span class="n">rooms</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rooms</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2 1 1 4
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Count the number of missing values.</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rooms</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Returns the object with incomplete cases removed. The returned object is an atomic vector of type `"numeric"` (or `"double"`).</span><span class="w">
</span><span class="n">na.omit</span><span class="p">(</span><span class="n">rooms</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2 1 1 4
attr(,"na.action")
[1] 4
attr(,"class")
[1] "omit"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Extract those elements which are complete cases. The returned object is an atomic vector of type `"numeric"` (or `"double"`).</span><span class="w">
</span><span class="n">rooms</span><span class="p">[</span><span class="n">complete.cases</span><span class="p">(</span><span class="n">rooms</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2 1 1 4
</code></pre></div></div>
<p>Recall that you can use the <code class="language-plaintext highlighter-rouge">typeof()</code> function to find the type of your atomic vector.</p>

<blockquote class="challenge">
  <h2 id="exercise-4">Exercise</h2>

  <ol>
    <li>
      <p>Using this vector of rooms, create a new vector with the NAs removed.</p>

      <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">rooms</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div>      </div>
    </li>
    <li>
      <p>Use the function <code class="language-plaintext highlighter-rouge">median()</code> to calculate the median of the <code class="language-plaintext highlighter-rouge">rooms</code> vector.</p>
    </li>
    <li>
      <p>Use R to figure out how many households in the set use more than 2 rooms for sleeping.</p>
    </li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-5">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rooms</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">rooms_no_na</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rooms</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">rooms</span><span class="p">)]</span><span class="w">
</span><span class="c1"># or</span><span class="w">
</span><span class="n">rooms_no_na</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">na.omit</span><span class="p">(</span><span class="n">rooms</span><span class="p">)</span><span class="w">
</span><span class="c1"># 2.</span><span class="w">
</span><span class="n">median</span><span class="p">(</span><span class="n">rooms</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 3.</span><span class="w">
</span><span class="n">rooms_above_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rooms_no_na</span><span class="p">[</span><span class="n">rooms_no_na</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="nf">length</span><span class="p">(</span><span class="n">rooms_above_2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 4
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<p>Now that we have learned how to write scripts, and the basics of R’s data
structures, we are ready to start working with the SAFI dataset we have been
using in the other lessons, and learn about data frames.</p>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Access individual values by location using <code class="language-plaintext highlighter-rouge">[]</code>.</p>
</li>
    
    <li><p>Access arbitrary sets of data using <code class="language-plaintext highlighter-rouge">[c(...)]</code>.</p>
</li>
    
    <li><p>Use logical operations and logical vectors to access subsets of data.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="starting-with-data" class="maintitle">Starting with Data</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 50 min
      <br />
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What is a data.frame?</p>
</li>
	
	<li><p>How can I read a complete csv file into R?</p>
</li>
	
	<li><p>How can I get basic summary information about my dataset?</p>
</li>
	
	<li><p>How can I change the way R treats strings in my dataset?</p>
</li>
	
	<li><p>Why would I want strings to be treated differently?</p>
</li>
	
	<li><p>How are dates represented in R and how can I change the format?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe what a data frame is.</p>
</li>
	
	<li><p>Load external data from a .csv file into a data frame.</p>
</li>
	
	<li><p>Summarize the contents of a data frame.</p>
</li>
	
	<li><p>Subset and extract values from data frames.</p>
</li>
	
	<li><p>Describe the difference between a factor and a string.</p>
</li>
	
	<li><p>Convert between strings and factors.</p>
</li>
	
	<li><p>Reorder and rename factors.</p>
</li>
	
	<li><p>Change how character strings are handled in a data frame.</p>
</li>
	
	<li><p>Examine and change date formats.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="what-are-data-frames-and-tibbles">What are data frames and tibbles?</h2>

<p>Data frames are the <em>de facto</em> data structure for tabular data in <code class="language-plaintext highlighter-rouge">R</code>, and what 
we use for data processing, statistics, and plotting.</p>

<p>A data frame is the representation of data in the format of a table where the
columns are vectors that all have the same length. Data frames are analogous to
the more familiar spreadsheet in programs such as Excel, with one key difference.
Because columns are vectors,
each column must contain a single type of data (e.g., characters, integers,
factors). For example, here is a figure depicting a data frame comprising a
numeric, a character, and a logical vector.</p>

<p><img src="../fig/data-frame.svg" alt="" /></p>

<p>A data frame can be created by hand, but most commonly they are generated by the
functions <code class="language-plaintext highlighter-rouge">read_csv()</code> or <code class="language-plaintext highlighter-rouge">read_table()</code>; in other words, when importing
spreadsheets from your hard drive (or the web). We will now demonstrate how to 
import tabular data using <code class="language-plaintext highlighter-rouge">read_csv()</code>.</p>

<h2 id="presentation-of-the-safi-data">Presentation of the SAFI Data</h2>

<p>SAFI (Studying African Farmer-Led Irrigation) is a study looking at farming
and irrigation methods in Tanzania and Mozambique. The survey data
was collected through interviews conducted between November 2016 and
June 2017. For this lesson, we will be using a subset of the
available data. For information about the full teaching dataset used
in other lessons in this workshop, see the
<a href="http://www.datacarpentry.org/socialsci-workshop/data/">dataset description</a>.</p>

<p>We will be using a subset of the cleaned version of the dataset that
was produced through cleaning in OpenRefine. Each row holds
information for a single interview respondent, and the columns
represent:</p>

<table>
  <thead>
    <tr>
      <th>column_name</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>key_id</td>
      <td>Added to provide a unique Id for each observation. (The InstanceID field does this as well but it is not as convenient to use)</td>
    </tr>
    <tr>
      <td>village</td>
      <td>Village name</td>
    </tr>
    <tr>
      <td>interview_date</td>
      <td>Date of interview</td>
    </tr>
    <tr>
      <td>no_membrs</td>
      <td>How many members in the household?</td>
    </tr>
    <tr>
      <td>years_liv</td>
      <td>How many years have you been living in this village or neighboring village?</td>
    </tr>
    <tr>
      <td>respondent_wall_type</td>
      <td>What type of walls does their house have (from list)</td>
    </tr>
    <tr>
      <td>rooms</td>
      <td>How many rooms in the main house are used for sleeping?</td>
    </tr>
    <tr>
      <td>memb_assoc</td>
      <td>Are you a member of an irrigation association?</td>
    </tr>
    <tr>
      <td>affect_conflicts</td>
      <td>Have you been affected by conflicts with other irrigators in the area?</td>
    </tr>
    <tr>
      <td>liv_count</td>
      <td>Number of livestock owned.</td>
    </tr>
    <tr>
      <td>items_owned</td>
      <td>Which of the following items are owned by the household? (list)</td>
    </tr>
    <tr>
      <td>no_meals</td>
      <td>How many meals do people in your household normally eat in a day?</td>
    </tr>
    <tr>
      <td>months_lack_food</td>
      <td>Indicate which months, In the last 12 months have you faced a situation when you did not have enough food to feed the household?</td>
    </tr>
    <tr>
      <td>instanceID</td>
      <td>Unique identifier for the form data submission</td>
    </tr>
  </tbody>
</table>

<p>You are going load the data in R’s memory using the function <code class="language-plaintext highlighter-rouge">read_csv()</code> 
from the <strong><code class="language-plaintext highlighter-rouge">readr</code></strong> package, which is part of the <strong><code class="language-plaintext highlighter-rouge">tidyverse</code></strong>; learn 
more about the <strong><code class="language-plaintext highlighter-rouge">tidyverse</code></strong> collection of packages 
<a href="https://www.tidyverse.org/">here</a>.
<strong><code class="language-plaintext highlighter-rouge">readr</code></strong> gets installed as part as the <strong><code class="language-plaintext highlighter-rouge">tidyverse</code></strong> installation. 
When you load  the <strong><code class="language-plaintext highlighter-rouge">tidyverse</code></strong> (<code class="language-plaintext highlighter-rouge">library(tidyverse)</code>), the core packages 
(the packages used in most data analyses) get loaded, including <strong><code class="language-plaintext highlighter-rouge">readr</code></strong>.</p>

<p>So, before we can use the <code class="language-plaintext highlighter-rouge">read_csv()</code> function, we need to load the package. 
Also, if you recall, the missing data is encoded as “NULL” in the dataset. 
We’ll tell it to the function, so R will automatically convert all the “NULL” 
entries in the dataset into <code class="language-plaintext highlighter-rouge">NA</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">interviews</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"data/SAFI_clean.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">na</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"NULL"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>If you were to type in the code above, it is likely that the <code class="language-plaintext highlighter-rouge">read.csv()</code> 
function would appear in the automatically populated list of functions. This 
function is different from the <code class="language-plaintext highlighter-rouge">read_csv()</code> function, as it is included in the 
“base” packages that come pre-installed with R. Overall, <code class="language-plaintext highlighter-rouge">read.csv()</code> behaves 
similar to <code class="language-plaintext highlighter-rouge">read_csv()</code>, with a few notable differences. First, <code class="language-plaintext highlighter-rouge">read.csv()</code> 
coerces column names with spaces and/or special characters to different names 
(e.g. <code class="language-plaintext highlighter-rouge">interview date</code> becomes <code class="language-plaintext highlighter-rouge">interview.date</code>). Second, <code class="language-plaintext highlighter-rouge">read.csv()</code> 
stores data as a <code class="language-plaintext highlighter-rouge">data.frame</code>, where <code class="language-plaintext highlighter-rouge">read_csv()</code> stores data as a <code class="language-plaintext highlighter-rouge">tibble</code>. 
We prefer tibbles because they have nice printing properties among other 
desirable qualities. Read more about tibbles <a href="https://tibble.tidyverse.org/">here</a>.</p>

<p>The second statement in the code above creates a data frame but doesn’t output 
any data because, as you might recall, assignments (<code class="language-plaintext highlighter-rouge">&lt;-</code>) don’t display
anything. (Note, however, that <code class="language-plaintext highlighter-rouge">read_csv</code> may show informational
text about the data frame that is created.) If we want to check that our data
has been loaded, we can see the contents of the data frame by typing its name:
<code class="language-plaintext highlighter-rouge">interviews</code> in the console.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w">
</span><span class="c1">## Try also</span><span class="w">
</span><span class="c1">## View(interviews)</span><span class="w">
</span><span class="c1">## head(interviews)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 131 x 14
   key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
    &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1      1 God     2016-11-17 00:00:00         3         4 muddaub              1
 2      1 God     2016-11-17 00:00:00         7         9 muddaub              1
 3      3 God     2016-11-17 00:00:00        10        15 burntbricks          1
 4      4 God     2016-11-17 00:00:00         7         6 burntbricks          1
 5      5 God     2016-11-17 00:00:00         7        40 burntbricks          1
 6      6 God     2016-11-17 00:00:00         3         3 muddaub              1
 7      7 God     2016-11-17 00:00:00         6        38 muddaub              1
 8      8 Chirod… 2016-11-16 00:00:00        12        70 burntbricks          3
 9      9 Chirod… 2016-11-16 00:00:00         8         6 burntbricks          1
10     10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
# … with 121 more rows, and 7 more variables: memb_assoc &lt;chr&gt;,
#   affect_conflicts &lt;chr&gt;, liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;,
#   months_lack_food &lt;chr&gt;, instanceID &lt;chr&gt;
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="note">Note</h2>

  <p><code class="language-plaintext highlighter-rouge">read_csv()</code> assumes that fields are delimited by commas. However, in several
countries, the comma is used as a decimal separator and the semicolon (;) is
used as a field delimiter. If you want to read in this type of files in R,
you can use the <code class="language-plaintext highlighter-rouge">read_csv2</code> function. It behaves exactly like <code class="language-plaintext highlighter-rouge">read_csv</code> but
uses different parameters for the decimal and the field separators. If you are
working with another format, they can be both specified by the user. Check out
the help for <code class="language-plaintext highlighter-rouge">read_csv()</code> by typing <code class="language-plaintext highlighter-rouge">?read_csv</code> to learn more. There is also
the <code class="language-plaintext highlighter-rouge">read_tsv()</code> for tab-separated data files, and <code class="language-plaintext highlighter-rouge">read_delim()</code> allows you
to specify more details about the structure of your file.</p>
</blockquote>

<p>Note that <code class="language-plaintext highlighter-rouge">read_csv()</code> actually loads the data as a tibble.
A tibble is an extension of <code class="language-plaintext highlighter-rouge">R</code> data frames used by the <strong><code class="language-plaintext highlighter-rouge">tidyverse</code></strong>. When the 
data is read using <code class="language-plaintext highlighter-rouge">read_csv()</code>, it is stored in an object of class <code class="language-plaintext highlighter-rouge">tbl_df</code>, 
<code class="language-plaintext highlighter-rouge">tbl</code>,  and <code class="language-plaintext highlighter-rouge">data.frame</code>. You can see the class of an object with</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">class</span><span class="p">(</span><span class="n">interviews</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" 
</code></pre></div></div>

<p>As a <code class="language-plaintext highlighter-rouge">tibble</code>, the type of data included in each column is listed in an 
abbreviated fashion below the column names. For instance, here <code class="language-plaintext highlighter-rouge">key_ID</code> is a 
column of integers (abbreviated <code class="language-plaintext highlighter-rouge">&lt;int&gt;</code>), <code class="language-plaintext highlighter-rouge">village</code> is a column of characters 
(<code class="language-plaintext highlighter-rouge">&lt;chr&gt;</code>) and the <code class="language-plaintext highlighter-rouge">interview_date</code> is a column in the “date and time” format 
(<code class="language-plaintext highlighter-rouge">&lt;dttm&gt;</code>).</p>

<h2 id="inspecting-data-frames">Inspecting data frames</h2>

<p>When calling a <code class="language-plaintext highlighter-rouge">tbl_df</code> object (like <code class="language-plaintext highlighter-rouge">interviews</code> here), there is already a lot of information about our data frame being displayed such as the number of rows, the number of columns, the names of the columns, and as we just saw the class of data stored in each column. However, there are functions to extract this information from data frames.  Here is a non-exhaustive list of some of these
functions. Let’s try them out!</p>

<p>Size:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">dim(interviews)</code> - returns a vector with the number of rows as the first element,
and the number of columns as the second element (the <strong>dim</strong>ensions of
the object)</li>
  <li><code class="language-plaintext highlighter-rouge">nrow(interviews)</code> - returns the number of rows</li>
  <li><code class="language-plaintext highlighter-rouge">ncol(interviews)</code> - returns the number of columns</li>
</ul>

<p>Content:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">head(interviews)</code> - shows the first 6 rows</li>
  <li><code class="language-plaintext highlighter-rouge">tail(interviews)</code> - shows the last 6 rows</li>
</ul>

<p>Names:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">names(interviews)</code> - returns the column names (synonym of <code class="language-plaintext highlighter-rouge">colnames()</code> for
<code class="language-plaintext highlighter-rouge">data.frame</code> objects)</li>
</ul>

<p>Summary:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">str(interviews)</code> - structure of the object and information about the class,
length and content of each column</li>
  <li><code class="language-plaintext highlighter-rouge">summary(interviews)</code> - summary statistics for each column</li>
</ul>

<p>Note: most of these functions are “generic.” They can be used on other types of
objects besides data frames.</p>

<h2 id="indexing-and-subsetting-data-frames">Indexing and subsetting data frames</h2>

<p>Our <code class="language-plaintext highlighter-rouge">interviews</code> data frame has rows and columns (it has 2 dimensions). 
In practice, we may not need the entire data frame; for instance, we may only
be interested in a subset of the observations (the rows) or a particular set 
of variables (the columns). If we want to
extract some specific data from it, we need to specify the “coordinates” we
want from it. Row numbers come first, followed by column numbers.</p>

<blockquote class="callout">
  <h2 id="tip">Tip</h2>
  <p>Indexing a <code class="language-plaintext highlighter-rouge">tibble</code> with <code class="language-plaintext highlighter-rouge">[</code> or <code class="language-plaintext highlighter-rouge">[[</code> or <code class="language-plaintext highlighter-rouge">$</code> always results in a <code class="language-plaintext highlighter-rouge">tibble</code>.
However, note this is not true in general for data frames, so be careful!
Different ways of specifying these coordinates can lead to results with
different classes. This is covered in the Software Carpentry lesson
<a href="https://swcarpentry.github.io/r-novice-gapminder/">R for Reproducible Scientific Analysis</a>.</p>
</blockquote>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## first element in the first column of the data frame (as a data.frame)</span><span class="w">
</span><span class="n">interviews</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 1 x 1
  key_ID
   &lt;dbl&gt;
1      1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## first element in the 6th column (as a data.frame)</span><span class="w">
</span><span class="n">interviews</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 1 x 1
  respondent_wall_type
  &lt;chr&gt;               
1 muddaub             
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## first column of the data frame (as a vector)</span><span class="w">
</span><span class="n">interviews</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [1]   1   1   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
 [19]  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36
 [37]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  21  54
 [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71 127
 [73] 133 152 153 155 178 177 180 181 182 186 187 195 196 197 198 201 202  72
 [91]  73  76  83  85  89 101 103 102  78  80 104 105 106 109 110 113 118 125
[109] 119 115 108 116 117 144 143 150 159 160 165 166 167 174 175 189 191 192
[127] 126 193 194 199 200
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## first column of the data frame (as a data.frame)</span><span class="w">
</span><span class="n">interviews</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 131 x 1
   key_ID
    &lt;dbl&gt;
 1      1
 2      1
 3      3
 4      4
 5      5
 6      6
 7      7
 8      8
 9      9
10     10
# … with 121 more rows
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## first three elements in the 7th column (as a data.frame)</span><span class="w">
</span><span class="n">interviews</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 1
  rooms
  &lt;dbl&gt;
1     1
2     1
3     1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## the 3rd row of the data frame (as a data.frame)</span><span class="w">
</span><span class="n">interviews</span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 1 x 14
  key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
   &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
1      3 God     2016-11-17 00:00:00        10        15 burntbricks          1
# … with 7 more variables: memb_assoc &lt;chr&gt;, affect_conflicts &lt;chr&gt;,
#   liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;, months_lack_food &lt;chr&gt;,
#   instanceID &lt;chr&gt;
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## equivalent to head_interviews &lt;- head(interviews)</span><span class="w">
</span><span class="n">head_interviews</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">:</code> is a special function that creates numeric vectors of integers in increasing
or decreasing order, test <code class="language-plaintext highlighter-rouge">1:10</code> and <code class="language-plaintext highlighter-rouge">10:1</code> for instance.</p>

<p>You can also exclude certain indices of a data frame using the “<code class="language-plaintext highlighter-rouge">-</code>” sign:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="p">[,</span><span class="w"> </span><span class="m">-1</span><span class="p">]</span><span class="w">          </span><span class="c1"># The whole data frame, except the first column</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 131 x 13
   village interview_date      no_membrs years_liv respondent_wall… rooms
   &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1 God     2016-11-17 00:00:00         3         4 muddaub              1
 2 God     2016-11-17 00:00:00         7         9 muddaub              1
 3 God     2016-11-17 00:00:00        10        15 burntbricks          1
 4 God     2016-11-17 00:00:00         7         6 burntbricks          1
 5 God     2016-11-17 00:00:00         7        40 burntbricks          1
 6 God     2016-11-17 00:00:00         3         3 muddaub              1
 7 God     2016-11-17 00:00:00         6        38 muddaub              1
 8 Chirod… 2016-11-16 00:00:00        12        70 burntbricks          3
 9 Chirod… 2016-11-16 00:00:00         8         6 burntbricks          1
10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
# … with 121 more rows, and 7 more variables: memb_assoc &lt;chr&gt;,
#   affect_conflicts &lt;chr&gt;, liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;,
#   months_lack_food &lt;chr&gt;, instanceID &lt;chr&gt;
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">7</span><span class="o">:</span><span class="m">131</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">   </span><span class="c1"># Equivalent to head(interviews)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 14
  key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
   &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
1      1 God     2016-11-17 00:00:00         3         4 muddaub              1
2      1 God     2016-11-17 00:00:00         7         9 muddaub              1
3      3 God     2016-11-17 00:00:00        10        15 burntbricks          1
4      4 God     2016-11-17 00:00:00         7         6 burntbricks          1
5      5 God     2016-11-17 00:00:00         7        40 burntbricks          1
6      6 God     2016-11-17 00:00:00         3         3 muddaub              1
# … with 7 more variables: memb_assoc &lt;chr&gt;, affect_conflicts &lt;chr&gt;,
#   liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;, months_lack_food &lt;chr&gt;,
#   instanceID &lt;chr&gt;
</code></pre></div></div>

<p>Data frames can be subset by calling indices (as shown previously), but also by calling their column names directly:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="p">[</span><span class="s2">"village"</span><span class="p">]</span><span class="w">       </span><span class="c1"># Result is a data frame</span><span class="w">
</span><span class="n">interviews</span><span class="p">[,</span><span class="w"> </span><span class="s2">"village"</span><span class="p">]</span><span class="w">     </span><span class="c1"># Result is a data frame</span><span class="w">
</span><span class="n">interviews</span><span class="p">[[</span><span class="s2">"village"</span><span class="p">]]</span><span class="w">     </span><span class="c1"># Result is a vector</span><span class="w">
</span><span class="n">interviews</span><span class="o">$</span><span class="n">village</span><span class="w">          </span><span class="c1"># Result is a vector</span><span class="w">
</span></code></pre></div></div>

<p>In RStudio, you can use the autocompletion feature to get the full and correct names of the columns.</p>

<blockquote class="challenge">
  <h2 id="exercise">Exercise</h2>

  <ol>
    <li>
      <p>Create a data frame (<code class="language-plaintext highlighter-rouge">interviews_100</code>) containing only the data in
row 100 of the <code class="language-plaintext highlighter-rouge">interviews</code> dataset.</p>
    </li>
    <li>
      <p>Notice how <code class="language-plaintext highlighter-rouge">nrow()</code> gave you the number of rows in a data frame?</p>

      <ul>
        <li>Use that number to pull out just that last row in the data frame.</li>
        <li>Compare that with what you see as the last row using <code class="language-plaintext highlighter-rouge">tail()</code> to make
sure it’s meeting expectations.</li>
        <li>Pull out that last row using <code class="language-plaintext highlighter-rouge">nrow()</code> instead of the row number.</li>
        <li>Create a new data frame (<code class="language-plaintext highlighter-rouge">interviews_last</code>) from that last row.</li>
      </ul>
    </li>
    <li>
      <p>Using the number of rows in the interviews dataset that you found in 
question 2, extract the row that is in the middle of the dataset. Store
the content of this middle row in an object named <code class="language-plaintext highlighter-rouge">interviews_middle</code>.
(hint: This dataset has an odd number of rows, so finding the middle is a
bit trickier than dividing n_rows by 2. Use the median( ) function and what
you’ve learned about sequences in R to extract the middle row!</p>
    </li>
    <li>
      <p>Combine <code class="language-plaintext highlighter-rouge">nrow()</code> with the <code class="language-plaintext highlighter-rouge">-</code> notation above to reproduce the behavior of
<code class="language-plaintext highlighter-rouge">head(interviews)</code>, keeping just the first through 6th rows of the interviews
dataset.</p>
    </li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## 1.</span><span class="w">
</span><span class="n">interviews_100</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="p">[</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">## 2.</span><span class="w">
</span><span class="c1"># Saving `n_rows` to improve readability and reduce duplication</span><span class="w">
</span><span class="n">n_rows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">interviews</span><span class="p">)</span><span class="w">
</span><span class="n">interviews_last</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="p">[</span><span class="n">n_rows</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">## 3.</span><span class="w">
</span><span class="n">interviews_middle</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="p">[</span><span class="n">median</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n_rows</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">## 4.</span><span class="w">
</span><span class="n">interviews_head</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="m">7</span><span class="o">:</span><span class="n">n_rows</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="factors">Factors</h2>

<p>R has a special data class, called factor, to deal with categorical data that
you may encounter when creating plots or doing statistical analyses. Factors are
very useful and actually contribute to making R particularly well suited to
working with data. So we are going to spend a little time introducing them.</p>

<p>Factors represent categorical data. They are stored as integers associated with
labels and they can be ordered (ordinal) or unordered (nominal). Factors
create a structured  relation between the different levels (values) of a
categorical variable, such as days of the week or responses to a question in
a survey. This can make it easier to see how one element relates to the
other elements in a column. While factors look (and often behave) like 
character vectors, they are actually treated as integer vectors by <code class="language-plaintext highlighter-rouge">R</code>. So 
you need to be very careful when treating them as strings.</p>

<p>Once created, factors can only contain a pre-defined set of values, known as
<em>levels</em>. By default, R always sorts levels in alphabetical order. For
instance, if you have a factor with 2 levels:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">respondent_floor_type</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"earth"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cement"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cement"</span><span class="p">,</span><span class="w"> </span><span class="s2">"earth"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>R will assign <code class="language-plaintext highlighter-rouge">1</code> to the level <code class="language-plaintext highlighter-rouge">"cement"</code> and <code class="language-plaintext highlighter-rouge">2</code> to the level <code class="language-plaintext highlighter-rouge">"earth"</code>
(because <code class="language-plaintext highlighter-rouge">c</code> comes before <code class="language-plaintext highlighter-rouge">e</code>, even though the first element in this vector is
<code class="language-plaintext highlighter-rouge">"earth"</code>). You can see this by using the function <code class="language-plaintext highlighter-rouge">levels()</code> and you can find
the number of levels using <code class="language-plaintext highlighter-rouge">nlevels()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">levels</span><span class="p">(</span><span class="n">respondent_floor_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "cement" "earth" 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nlevels</span><span class="p">(</span><span class="n">respondent_floor_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2
</code></pre></div></div>

<p>Sometimes, the order of the factors does not matter. Other times you might want
to specify the order because it is meaningful (e.g., “low”, “medium”, “high”).
It may improve your visualization, or it may be required by a particular type of
analysis. Here, one way to reorder our levels in the <code class="language-plaintext highlighter-rouge">respondent_floor_type</code> vector would be:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">respondent_floor_type</span><span class="w"> </span><span class="c1"># current order</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] earth  cement cement earth 
Levels: cement earth
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">respondent_floor_type</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">respondent_floor_type</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"earth"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cement"</span><span class="p">))</span><span class="w">
</span><span class="n">respondent_floor_type</span><span class="w"> </span><span class="c1"># after re-ordering</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] earth  cement cement earth 
Levels: earth cement
</code></pre></div></div>

<p>In R’s memory, these factors are represented by integers (1, 2), but are more
informative than integers because factors are self describing: <code class="language-plaintext highlighter-rouge">"cement"</code>,
<code class="language-plaintext highlighter-rouge">"earth"</code> is more descriptive than <code class="language-plaintext highlighter-rouge">1</code>, and <code class="language-plaintext highlighter-rouge">2</code>. Which one is “earth”? You
wouldn’t be able to tell just from the integer data. Factors, on the other hand,
have this information built in. It is particularly helpful when there are many
levels. It also makes renaming levels easier. Let’s say we made a mistake and need to recode “cement” to “brick”.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">levels</span><span class="p">(</span><span class="n">respondent_floor_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "earth"  "cement"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">levels</span><span class="p">(</span><span class="n">respondent_floor_type</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"brick"</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">respondent_floor_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "earth" "brick"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">respondent_floor_type</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] earth brick brick earth
Levels: earth brick
</code></pre></div></div>

<p>So far, your factor is unordered, like a nominal variable. R does not know the 
difference between a nominal and an ordinal variable. You make your factor an
ordered factor by using the <code class="language-plaintext highlighter-rouge">ordered=TRUE</code> option inside your factor function.
Note how the reported levels changed from the unordered factor above to the
ordered version below. Ordered levels use the less than sign <code class="language-plaintext highlighter-rouge">&lt;</code> to denote
level ranking.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">respondent_floor_type_ordered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">respondent_floor_type</span><span class="p">,</span><span class="w"> </span><span class="n">ordered</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">respondent_floor_type_ordered</span><span class="w"> </span><span class="c1"># after setting as ordered factor</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] earth brick brick earth
Levels: earth &lt; brick
</code></pre></div></div>

<h3 id="converting-factors">Converting factors</h3>

<p>If you need to convert a factor to a character vector, you use
<code class="language-plaintext highlighter-rouge">as.character(x)</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">as.character</span><span class="p">(</span><span class="n">respondent_floor_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "earth" "brick" "brick" "earth"
</code></pre></div></div>

<p>Converting factors where the levels appear as numbers (such as concentration
levels, or years) to a numeric vector is a little trickier. The <code class="language-plaintext highlighter-rouge">as.numeric()</code>
function returns the index values of the factor, not its levels, so it will
result in an entirely new (and unwanted in this case) set of numbers.
One method to avoid this is to convert factors to characters, and then to numbers.
Another method is to use the <code class="language-plaintext highlighter-rouge">levels()</code> function. Compare:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">year_fct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1990</span><span class="p">,</span><span class="w"> </span><span class="m">1983</span><span class="p">,</span><span class="w"> </span><span class="m">1977</span><span class="p">,</span><span class="w"> </span><span class="m">1998</span><span class="p">,</span><span class="w"> </span><span class="m">1990</span><span class="p">))</span><span class="w">
</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">year_fct</span><span class="p">)</span><span class="w">                     </span><span class="c1"># Wrong! And there is no warning...</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 3 2 1 4 3
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">year_fct</span><span class="p">))</span><span class="w">       </span><span class="c1"># Works...</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1990 1983 1977 1998 1990
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">as.numeric</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">year_fct</span><span class="p">))[</span><span class="n">year_fct</span><span class="p">]</span><span class="w">   </span><span class="c1"># The recommended way.</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1990 1983 1977 1998 1990
</code></pre></div></div>

<p>Notice that in the recommended <code class="language-plaintext highlighter-rouge">levels()</code> approach, three important steps occur:</p>

<ul>
  <li>We obtain all the factor levels using <code class="language-plaintext highlighter-rouge">levels(year_fct)</code></li>
  <li>We convert these levels to numeric values using <code class="language-plaintext highlighter-rouge">as.numeric(levels(year_fct))</code></li>
  <li>We then access these numeric values using the underlying integers of the
vector <code class="language-plaintext highlighter-rouge">year_fct</code> inside the square brackets</li>
</ul>

<h3 id="renaming-factors">Renaming factors</h3>

<p>When your data is stored as a factor, you can use the <code class="language-plaintext highlighter-rouge">plot()</code> function to get a
quick glance at the number of observations represented by each factor level.
Let’s extract the <code class="language-plaintext highlighter-rouge">memb_assoc</code> column from our data frame, convert it into a
factor, and use it to look at the number of interview respondents who were or
were not members of an irrigation association:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## create a vector from the data frame column "memb_assoc"</span><span class="w">
</span><span class="n">memb_assoc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="o">$</span><span class="n">memb_assoc</span><span class="w">
</span><span class="c1">## convert it into a factor</span><span class="w">
</span><span class="n">memb_assoc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">)</span><span class="w">
</span><span class="c1">## let's see what it looks like</span><span class="w">
</span><span class="n">memb_assoc</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [1] &lt;NA&gt; yes  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; no   yes  no   no   &lt;NA&gt; yes  no   &lt;NA&gt; yes 
 [16] &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; no   &lt;NA&gt; &lt;NA&gt; no   no   no   &lt;NA&gt; no   yes  &lt;NA&gt;
 [31] &lt;NA&gt; yes  no   yes  yes  yes  &lt;NA&gt; yes  &lt;NA&gt; yes  &lt;NA&gt; no   no   &lt;NA&gt; no  
 [46] no   yes  &lt;NA&gt; &lt;NA&gt; yes  &lt;NA&gt; no   yes  no   &lt;NA&gt; yes  no   no   &lt;NA&gt; no  
 [61] yes  &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; no   yes  no   no   no   no   yes  &lt;NA&gt; no   yes  &lt;NA&gt;
 [76] &lt;NA&gt; yes  no   no   yes  no   no   yes  no   yes  no   no   &lt;NA&gt; yes  yes 
 [91] yes  yes  yes  no   no   no   no   yes  no   no   yes  yes  no   &lt;NA&gt; no  
[106] no   &lt;NA&gt; no   no   &lt;NA&gt; no   &lt;NA&gt; &lt;NA&gt; no   no   no   no   yes  no   no  
[121] no   no   no   no   no   no   no   no   no   yes  &lt;NA&gt;
Levels: no yes
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## bar plot of the number of interview respondents who were</span><span class="w">
</span><span class="c1">## members of irrigation association:</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-02-factor-plot-default-order-1.png" title="plot of chunk factor-plot-default-order" alt="plot of chunk factor-plot-default-order" width="612" style="display: block; margin: auto;" /></p>

<p>Looking at the plot compared to the output of the vector, we can see that in
addition to “no”s and “yes”s, there are some respondents for which the
information about whether they were part of an irrigation association hasn’t
been recorded, and encoded as missing data. They do not appear on the plot.
Let’s encode them differently so they can counted and visualized in our plot.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Let's recreate the vector from the data frame column "memb_assoc"</span><span class="w">
</span><span class="n">memb_assoc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="o">$</span><span class="n">memb_assoc</span><span class="w">
</span><span class="c1">## replace the missing data with "undetermined"</span><span class="w">
</span><span class="n">memb_assoc</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"undetermined"</span><span class="w">
</span><span class="c1">## convert it into a factor</span><span class="w">
</span><span class="n">memb_assoc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">)</span><span class="w">
</span><span class="c1">## let's see what it looks like</span><span class="w">
</span><span class="n">memb_assoc</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [1] undetermined yes          undetermined undetermined undetermined
  [6] undetermined no           yes          no           no          
 [11] undetermined yes          no           undetermined yes         
 [16] undetermined undetermined undetermined undetermined undetermined
 [21] no           undetermined undetermined no           no          
 [26] no           undetermined no           yes          undetermined
 [31] undetermined yes          no           yes          yes         
 [36] yes          undetermined yes          undetermined yes         
 [41] undetermined no           no           undetermined no          
 [46] no           yes          undetermined undetermined yes         
 [51] undetermined no           yes          no           undetermined
 [56] yes          no           no           undetermined no          
 [61] yes          undetermined undetermined undetermined no          
 [66] yes          no           no           no           no          
 [71] yes          undetermined no           yes          undetermined
 [76] undetermined yes          no           no           yes         
 [81] no           no           yes          no           yes         
 [86] no           no           undetermined yes          yes         
 [91] yes          yes          yes          no           no          
 [96] no           no           yes          no           no          
[101] yes          yes          no           undetermined no          
[106] no           undetermined no           no           undetermined
[111] no           undetermined undetermined no           no          
[116] no           no           yes          no           no          
[121] no           no           no           no           no          
[126] no           no           no           no           yes         
[131] undetermined
Levels: no undetermined yes
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## bar plot of the number of interview respondents who were</span><span class="w">
</span><span class="c1">## members of irrigation association:</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-02-factor-plot-reorder-1.png" title="plot of chunk factor-plot-reorder" alt="plot of chunk factor-plot-reorder" width="612" style="display: block; margin: auto;" /></p>

<blockquote class="challenge">
  <h2 id="exercise-1">Exercise</h2>

  <ul>
    <li>
      <p>Rename the levels of the factor to have the first letter in uppercase:
“No”,”Undetermined”, and “Yes”.</p>
    </li>
    <li>
      <p>Now that we have renamed the factor level to “Undetermined”, can you
recreate the barplot such that “Undetermined” is last (after “Yes”)?</p>
    </li>
  </ul>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">levels</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"No"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Undetermined"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Yes"</span><span class="p">)</span><span class="w">
</span><span class="n">memb_assoc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"No"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Yes"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Undetermined"</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-02-factor-plot-exercise-1.png" title="plot of chunk factor-plot-exercise" alt="plot of chunk factor-plot-exercise" width="612" style="display: block; margin: auto;" /></p>
  </blockquote>
</blockquote>

<h2 id="formatting-dates">Formatting Dates</h2>

<p>One of the most common issues that new (and experienced!) R users have is
converting date and time information into a variable that is appropriate and
usable during analyses. As a reminder from earlier in this lesson, the best
practice for dealing with date data is to ensure that each component of your
date is stored as a separate variable. In our dataset, we have a
column <code class="language-plaintext highlighter-rouge">interview_date</code> which contains information about the
year, month, and day that the interview was conducted. Let’s
convert those dates into three separate columns.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">interviews</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>We are going to use the package <strong><code class="language-plaintext highlighter-rouge">lubridate</code></strong>, which is included in the
<strong><code class="language-plaintext highlighter-rouge">tidyverse</code></strong> installation but not loaded by default, so we have to load 
it explicitly with <code class="language-plaintext highlighter-rouge">library(lubridate)</code>.</p>

<p>Start by loading the required package:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The lubridate function <code class="language-plaintext highlighter-rouge">ymd()</code> takes a vector representing year, month, and day, and converts it to a
<code class="language-plaintext highlighter-rouge">Date</code> vector. <code class="language-plaintext highlighter-rouge">Date</code> is a class of data recognized by R as being a date and can
be manipulated as such. The argument that the function requires is flexible,
but, as a best practice, is a character vector formatted as “YYYY-MM-DD”.</p>

<p>Let’s extract our <code class="language-plaintext highlighter-rouge">interview_date</code> column and inspect the structure:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="o">$</span><span class="n">interview_date</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> POSIXct[1:131], format: "2016-11-17" "2016-11-17" "2016-11-17" "2016-11-17" "2016-11-17" ...
</code></pre></div></div>

<p>When we imported the data in R, <code class="language-plaintext highlighter-rouge">read_csv()</code> recognized that this column contained date information. We can now use the <code class="language-plaintext highlighter-rouge">day()</code>, <code class="language-plaintext highlighter-rouge">month()</code> and  <code class="language-plaintext highlighter-rouge">year()</code> functions to extract this information from the date, and create new columns in our data frame to store it:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="o">$</span><span class="n">day</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">day</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span><span class="w">
</span><span class="n">interviews</span><span class="o">$</span><span class="n">month</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">month</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span><span class="w">
</span><span class="n">interviews</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span><span class="w">
</span><span class="n">interviews</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 131 x 17
   key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
    &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1      1 God     2016-11-17 00:00:00         3         4 muddaub              1
 2      1 God     2016-11-17 00:00:00         7         9 muddaub              1
 3      3 God     2016-11-17 00:00:00        10        15 burntbricks          1
 4      4 God     2016-11-17 00:00:00         7         6 burntbricks          1
 5      5 God     2016-11-17 00:00:00         7        40 burntbricks          1
 6      6 God     2016-11-17 00:00:00         3         3 muddaub              1
 7      7 God     2016-11-17 00:00:00         6        38 muddaub              1
 8      8 Chirod… 2016-11-16 00:00:00        12        70 burntbricks          3
 9      9 Chirod… 2016-11-16 00:00:00         8         6 burntbricks          1
10     10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
# … with 121 more rows, and 10 more variables: memb_assoc &lt;chr&gt;,
#   affect_conflicts &lt;chr&gt;, liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;,
#   months_lack_food &lt;chr&gt;, instanceID &lt;chr&gt;, day &lt;int&gt;, month &lt;dbl&gt;,
#   year &lt;dbl&gt;
</code></pre></div></div>

<p>Notice the three new columns at the end of our data frame.</p>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use read_csv to read tabular data in R.</p>
</li>
    
    <li><p>Use factors to represent categorical data in R.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="data-wrangling-with-dplyr-and-tidyr" class="maintitle">Data Wrangling with dplyr and tidyr</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 50 min
      <br />
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I select specific rows and/or columns from a dataframe?</p>
</li>
	
	<li><p>How can I combine multiple commands into a single command?</p>
</li>
	
	<li><p>How can create new columns or remove existing columns from a dataframe?</p>
</li>
	
	<li><p>How can I reformat a dataframe to meet my needs?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe the purpose of an R package and the <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> and <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> packages.</p>
</li>
	
	<li><p>Select certain columns in a dataframe with the <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> function <code class="language-plaintext highlighter-rouge">select</code>.</p>
</li>
	
	<li><p>Select certain rows in a dataframe according to filtering conditions with the <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> function <code class="language-plaintext highlighter-rouge">filter</code>.</p>
</li>
	
	<li><p>Link the output of one <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> function to the input of another function with the ‘pipe’ operator <code class="language-plaintext highlighter-rouge">%&gt;%</code>.</p>
</li>
	
	<li><p>Add new columns to a dataframe that are functions of existing columns with <code class="language-plaintext highlighter-rouge">mutate</code>.</p>
</li>
	
	<li><p>Use the split-apply-combine concept for data analysis.</p>
</li>
	
	<li><p>Use <code class="language-plaintext highlighter-rouge">summarize</code>, <code class="language-plaintext highlighter-rouge">group_by</code>, and <code class="language-plaintext highlighter-rouge">count</code> to split a dataframe into groups of observations, apply a summary statistics for each group, and then combine the results.</p>
</li>
	
	<li><p>Describe the concept of a wide and a long table format and for which purpose those formats are useful.</p>
</li>
	
	<li><p>Describe the roles of variable names and their associated values when a table is reshaped.</p>
</li>
	
	<li><p>Reshape a dataframe from long to wide format and back with the <code class="language-plaintext highlighter-rouge">pivot_wider</code> and <code class="language-plaintext highlighter-rouge">pivot_longer</code> commands from the <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> package.</p>
</li>
	
	<li><p>Export a dataframe to a csv file.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p><strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> is a package for making tabular data wrangling easier by using a
limited set of functions that can be combined to extract and summarize insights
from your data. It pairs nicely with <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> which enables you to swiftly
convert between different data formats (long vs. wide) for plotting and analysis.</p>

<p>Similarly to <strong><code class="language-plaintext highlighter-rouge">readr</code></strong>, <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> and <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> are also part of the
tidyverse. These packages were loaded in R’s memory when we called 
<code class="language-plaintext highlighter-rouge">library(tidyverse)</code> earlier.</p>

<blockquote class="callout">
  <h2 id="note">Note</h2>

  <p>The packages in the tidyverse, namely <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong>, <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> and <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> 
accept both the British (e.g. <em>summarise</em>) and American (e.g. <em>summarize</em>) spelling 
variants of different function and option names. For this lesson, we utilize
the American spellings of different functions; however, feel free to use
the regional variant for where you are teaching.</p>
</blockquote>

<h2 id="what-is-an-r-package">What is an R package?</h2>

<p>The package <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> provides easy tools for the most common data
wrangling tasks. It is built to work directly with dataframes, with many
common tasks optimized by being written in a compiled language (C++) (not all R
packages are written in R!).</p>

<p>The package <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> addresses the common problem of wanting to reshape your
data for plotting and use by different R functions. Sometimes we want data sets
where we have one row per measurement. Sometimes we want a dataframe where each
measurement type has its own column, and rows are instead more aggregated
groups. Moving back and forth between these formats is nontrivial, and
<strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> gives you tools for this and more sophisticated data wrangling.</p>

<p>But there are also packages available for a wide range of tasks including
building plots (<strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong>, which we’ll see later), downloading data from the
NCBI database, or performing statistical analysis on your data set. Many
packages such as these are housed on, and downloadable from, the 
<strong>C</strong>omprehensive <strong>R</strong> <strong>A</strong>rchive <strong>N</strong>etwork (CRAN) using <code class="language-plaintext highlighter-rouge">install.packages</code>.
This function makes the package accessible by your R installation with the
command <code class="language-plaintext highlighter-rouge">library()</code>, as you did with <code class="language-plaintext highlighter-rouge">tidyverse</code> earlier.</p>

<p>To easily access the documentation for a package within R or RStudio, use
<code class="language-plaintext highlighter-rouge">help(package = "package_name")</code>.</p>

<p>To learn more about <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> and <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> after the workshop, you may want
to check out this <a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">handy data transformation with <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> cheatsheet</a>
and this <a href="https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf">one about <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong></a>.</p>

<h2 id="learning-dplyr-and-tidyr">Learning <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> and <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong></h2>

<p>To make sure, everyone will use the same dataset for this lesson, we’ll read
again the SAFI dataset that we downloaded earlier.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## load the tidyverse</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">

</span><span class="n">interviews</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"data/SAFI_clean.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">na</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"NULL"</span><span class="p">)</span><span class="w">

</span><span class="c1">## inspect the data</span><span class="w">
</span><span class="n">interviews</span><span class="w">

</span><span class="c1">## preview the data</span><span class="w">
</span><span class="c1"># View(interviews)</span><span class="w">
</span></code></pre></div></div>

<p>We’re going to learn some of the most common <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> functions:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">select()</code>: subset columns</li>
  <li><code class="language-plaintext highlighter-rouge">filter()</code>: subset rows on conditions</li>
  <li><code class="language-plaintext highlighter-rouge">mutate()</code>: create new columns by using information from other columns</li>
  <li><code class="language-plaintext highlighter-rouge">group_by()</code> and <code class="language-plaintext highlighter-rouge">summarize()</code>: create summary statistics on grouped data</li>
  <li><code class="language-plaintext highlighter-rouge">arrange()</code>: sort results</li>
  <li><code class="language-plaintext highlighter-rouge">count()</code>: count discrete values</li>
</ul>

<h2 id="selecting-columns-and-filtering-rows">Selecting columns and filtering rows</h2>

<p>To select columns of a dataframe, use <code class="language-plaintext highlighter-rouge">select()</code>. The first argument to this
function is the dataframe (<code class="language-plaintext highlighter-rouge">interviews</code>), and the subsequent arguments are the
columns to keep, separated by commas. Alternatively, if you are selecting 
columns adjacent to each other, you can use a <code class="language-plaintext highlighter-rouge">:</code> to select a range of columns, 
read as “select columns from <em>__ to __</em>.”</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># to select columns throughout the dataframe</span><span class="w">
</span><span class="n">select</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">months_lack_food</span><span class="p">)</span><span class="w">
</span><span class="c1"># to select a series of connected columns</span><span class="w">
</span><span class="n">select</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="o">:</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>To choose rows based on a specific criteria, we can use the <code class="language-plaintext highlighter-rouge">filter()</code> function. 
The arguments after the dataframe are the condition(s) we want for our final 
dataframe to adhere to (e.g. village name is Chirodzo). We can chain a series of 
conditions together using commas between each condition.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># one condition</span><span class="w">
</span><span class="n">filter</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 39 x 14
   key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
    &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1      8 Chirod… 2016-11-16 00:00:00        12        70 burntbricks          3
 2      9 Chirod… 2016-11-16 00:00:00         8         6 burntbricks          1
 3     10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
 4     34 Chirod… 2016-11-17 00:00:00         8        18 burntbricks          3
 5     35 Chirod… 2016-11-17 00:00:00         5        45 muddaub              1
 6     36 Chirod… 2016-11-17 00:00:00         6        23 sunbricks            1
 7     37 Chirod… 2016-11-17 00:00:00         3         8 burntbricks          1
 8     43 Chirod… 2016-11-17 00:00:00         7        29 muddaub              1
 9     44 Chirod… 2016-11-17 00:00:00         2         6 muddaub              1
10     45 Chirod… 2016-11-17 00:00:00         9         7 muddaub              1
# … with 29 more rows, and 7 more variables: memb_assoc &lt;chr&gt;,
#   affect_conflicts &lt;chr&gt;, liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;,
#   months_lack_food &lt;chr&gt;, instanceID &lt;chr&gt;
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># multiple conditions</span><span class="w">
</span><span class="n">filter</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">,</span><span class="w"> </span><span class="n">rooms</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">no_meals</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 10 x 14
   key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
    &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1     10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
 2     49 Chirod… 2016-11-16 00:00:00         6        26 burntbricks          2
 3     52 Chirod… 2016-11-16 00:00:00        11        15 burntbricks          3
 4     56 Chirod… 2016-11-16 00:00:00        12        23 burntbricks          2
 5     65 Chirod… 2016-11-16 00:00:00         8        20 burntbricks          3
 6     66 Chirod… 2016-11-16 00:00:00        10        37 burntbricks          3
 7     67 Chirod… 2016-11-16 00:00:00         5        31 burntbricks          2
 8     68 Chirod… 2016-11-16 00:00:00         8        52 burntbricks          3
 9    199 Chirod… 2017-06-04 00:00:00         7        17 burntbricks          2
10    200 Chirod… 2017-06-04 00:00:00         8        20 burntbricks          2
# … with 7 more variables: memb_assoc &lt;chr&gt;, affect_conflicts &lt;chr&gt;,
#   liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;, months_lack_food &lt;chr&gt;,
#   instanceID &lt;chr&gt;
</code></pre></div></div>

<h2 id="pipes">Pipes</h2>

<p>What if you want to select and filter at the same time? There are three
ways to do this: use intermediate steps, nested functions, or pipes.</p>

<p>With intermediate steps, you create a temporary dataframe and use
that as input to the next function, like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">)</span><span class="w">
</span><span class="n">interviews_god</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">interviews2</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="o">:</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>This is readable, but can clutter up your workspace with lots of objects that
you have to name individually. With multiple steps, that can be hard to keep
track of.</p>

<p>You can also nest functions (i.e. one function inside of another), like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_god</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">interviews</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">),</span><span class="w"> 
                         </span><span class="n">village</span><span class="o">:</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>This is handy, but can be difficult to read if too many functions are nested, as
R evaluates the expression from the inside out (in this case, filtering, then
selecting).</p>

<p>The last option, <em>pipes</em>, are a recent addition to R. Pipes let you take the
output of one function and send it directly to the next, which is useful when
you need to do many things to the same dataset. Pipes in R look like <code class="language-plaintext highlighter-rouge">%&gt;%</code> and
are made available via the <strong><code class="language-plaintext highlighter-rouge">magrittr</code></strong> package, installed automatically with
<strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong>. If you use RStudio, you can type the pipe with <kbd>Ctrl</kbd></p>
<ul>
  <li><kbd>Shift</kbd> + <kbd>M</kbd> if you have a PC or <kbd>Cmd</kbd> +
<kbd>Shift</kbd> + <kbd>M</kbd> if you have a Mac.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">village</span><span class="o">:</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 39 x 5
   village  interview_date      no_membrs years_liv respondent_wall_type
   &lt;chr&gt;    &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               
 1 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
 2 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
 3 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
 4 Chirodzo 2016-11-17 00:00:00         8        18 burntbricks         
 5 Chirodzo 2016-11-17 00:00:00         5        45 muddaub             
 6 Chirodzo 2016-11-17 00:00:00         6        23 sunbricks           
 7 Chirodzo 2016-11-17 00:00:00         3         8 burntbricks         
 8 Chirodzo 2016-11-17 00:00:00         7        29 muddaub             
 9 Chirodzo 2016-11-17 00:00:00         2         6 muddaub             
10 Chirodzo 2016-11-17 00:00:00         9         7 muddaub             
# … with 29 more rows
</code></pre></div></div>

<p>In the above code, we use the pipe to send the <code class="language-plaintext highlighter-rouge">interviews</code> dataset first
through <code class="language-plaintext highlighter-rouge">filter()</code> to keep rows where <code class="language-plaintext highlighter-rouge">village</code> is “Chirodzo”, then through
<code class="language-plaintext highlighter-rouge">select()</code> to keep only the <code class="language-plaintext highlighter-rouge">no_membrs</code> and <code class="language-plaintext highlighter-rouge">years_liv</code> columns. Since <code class="language-plaintext highlighter-rouge">%&gt;%</code>
takes the object on its left and passes it as the first argument to the function
on its right, we don’t need to explicitly include the dataframe as an argument
to the <code class="language-plaintext highlighter-rouge">filter()</code> and <code class="language-plaintext highlighter-rouge">select()</code> functions any more.</p>

<p>Some may find it helpful to read the pipe like the word “then”. For instance,
in the above example, we take the dataframe <code class="language-plaintext highlighter-rouge">interviews</code>, <em>then</em> we <code class="language-plaintext highlighter-rouge">filter</code>
for rows with <code class="language-plaintext highlighter-rouge">village == "Chirodzo"</code>, <em>then</em> we <code class="language-plaintext highlighter-rouge">select</code> columns <code class="language-plaintext highlighter-rouge">no_membrs</code> and
<code class="language-plaintext highlighter-rouge">years_liv</code>. The <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> functions by themselves are somewhat simple,
but by combining them into linear workflows with the pipe, we can accomplish
more complex data wrangling operations.</p>

<p>If we want to create a new object with this smaller version of the data, we
can assign it a new name:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_god</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">village</span><span class="o">:</span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w">

</span><span class="n">interviews_god</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 39 x 5
   village  interview_date      no_membrs years_liv respondent_wall_type
   &lt;chr&gt;    &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               
 1 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
 2 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
 3 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
 4 Chirodzo 2016-11-17 00:00:00         8        18 burntbricks         
 5 Chirodzo 2016-11-17 00:00:00         5        45 muddaub             
 6 Chirodzo 2016-11-17 00:00:00         6        23 sunbricks           
 7 Chirodzo 2016-11-17 00:00:00         3         8 burntbricks         
 8 Chirodzo 2016-11-17 00:00:00         7        29 muddaub             
 9 Chirodzo 2016-11-17 00:00:00         2         6 muddaub             
10 Chirodzo 2016-11-17 00:00:00         9         7 muddaub             
# … with 29 more rows
</code></pre></div></div>

<p>Note that the final dataframe (<code class="language-plaintext highlighter-rouge">interviews_god</code>) is the leftmost part of this
expression.</p>

<blockquote class="challenge">
  <h2 id="exercise">Exercise</h2>

  <p>Using pipes, subset the <code class="language-plaintext highlighter-rouge">interviews</code> data to include interviews
where respondents were members of an irrigation association
(<code class="language-plaintext highlighter-rouge">memb_assoc</code>) and retain only the columns <code class="language-plaintext highlighter-rouge">affect_conflicts</code>,
<code class="language-plaintext highlighter-rouge">liv_count</code>, and <code class="language-plaintext highlighter-rouge">no_meals</code>.</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">memb_assoc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"yes"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">affect_conflicts</span><span class="p">,</span><span class="w"> </span><span class="n">liv_count</span><span class="p">,</span><span class="w"> </span><span class="n">no_meals</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 33 x 3
   affect_conflicts liv_count no_meals
   &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;
 1 once                     3        2
 2 never                    2        2
 3 never                    2        3
 4 once                     3        2
 5 frequently               1        3
 6 more_once                5        2
 7 more_once                3        2
 8 more_once                2        3
 9 once                     3        3
10 never                    3        3
# … with 23 more rows
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h3 id="mutate">Mutate</h3>

<p>Frequently you’ll want to create new columns based on the values in existing
columns, for example to do unit conversions, or to find the ratio of values in
two columns. For this we’ll use <code class="language-plaintext highlighter-rouge">mutate()</code>.</p>

<p>We might be interested in the ratio of number of household members
to rooms used for sleeping (i.e. avg number of people per room):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">people_per_room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">rooms</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 131 x 15
   key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
    &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1      1 God     2016-11-17 00:00:00         3         4 muddaub              1
 2      1 God     2016-11-17 00:00:00         7         9 muddaub              1
 3      3 God     2016-11-17 00:00:00        10        15 burntbricks          1
 4      4 God     2016-11-17 00:00:00         7         6 burntbricks          1
 5      5 God     2016-11-17 00:00:00         7        40 burntbricks          1
 6      6 God     2016-11-17 00:00:00         3         3 muddaub              1
 7      7 God     2016-11-17 00:00:00         6        38 muddaub              1
 8      8 Chirod… 2016-11-16 00:00:00        12        70 burntbricks          3
 9      9 Chirod… 2016-11-16 00:00:00         8         6 burntbricks          1
10     10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
# … with 121 more rows, and 8 more variables: memb_assoc &lt;chr&gt;,
#   affect_conflicts &lt;chr&gt;, liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;,
#   months_lack_food &lt;chr&gt;, instanceID &lt;chr&gt;, people_per_room &lt;dbl&gt;
</code></pre></div></div>

<p>We may be interested in investigating whether being a member of an
irrigation association had any effect on the ratio of household members
to rooms. To look at this relationship, we will first remove
data from our dataset where the respondent didn’t answer the
question of whether they were a member of an irrigation association.
These cases are recorded as “NULL” in the dataset.</p>

<p>To remove these cases, we could insert a <code class="language-plaintext highlighter-rouge">filter()</code> in the chain:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">people_per_room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">rooms</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 92 x 15
   key_ID village interview_date      no_membrs years_liv respondent_wall… rooms
    &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1      1 God     2016-11-17 00:00:00         7         9 muddaub              1
 2      7 God     2016-11-17 00:00:00         6        38 muddaub              1
 3      8 Chirod… 2016-11-16 00:00:00        12        70 burntbricks          3
 4      9 Chirod… 2016-11-16 00:00:00         8         6 burntbricks          1
 5     10 Chirod… 2016-12-16 00:00:00        12        23 burntbricks          5
 6     12 God     2016-11-21 00:00:00         7        20 burntbricks          3
 7     13 God     2016-11-21 00:00:00         6         8 burntbricks          1
 8     15 God     2016-11-21 00:00:00         5        30 sunbricks            2
 9     21 God     2016-11-21 00:00:00         8        20 burntbricks          1
10     24 Ruaca   2016-11-21 00:00:00         6         4 burntbricks          2
# … with 82 more rows, and 8 more variables: memb_assoc &lt;chr&gt;,
#   affect_conflicts &lt;chr&gt;, liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;,
#   months_lack_food &lt;chr&gt;, instanceID &lt;chr&gt;, people_per_room &lt;dbl&gt;
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">!</code> symbol negates the result of the <code class="language-plaintext highlighter-rouge">is.na()</code> function. Thus, if <code class="language-plaintext highlighter-rouge">is.na()</code>
returns a value of <code class="language-plaintext highlighter-rouge">TRUE</code> (because the <code class="language-plaintext highlighter-rouge">memb_assoc</code> is missing), the <code class="language-plaintext highlighter-rouge">!</code> symbol 
negates this and says we only want values of <code class="language-plaintext highlighter-rouge">FALSE</code>, where <code class="language-plaintext highlighter-rouge">memb_assoc</code> <strong>is 
not</strong> missing.</p>

<blockquote class="challenge">
  <h2 id="exercise-1">Exercise</h2>

  <p>Create a new dataframe from the <code class="language-plaintext highlighter-rouge">interviews</code> data that meets the following
 criteria: contains only the <code class="language-plaintext highlighter-rouge">village</code> column and a new column called
 <code class="language-plaintext highlighter-rouge">total_meals</code> containing a value that is equal to the total number of meals
 served in the household per day on average (<code class="language-plaintext highlighter-rouge">no_membrs</code> times <code class="language-plaintext highlighter-rouge">no_meals</code>).
 Only the rows where <code class="language-plaintext highlighter-rouge">total_meals</code> is greater than 20 should be shown in the
 final dataframe.</p>

  <p><strong>Hint</strong>: think about how the commands should be ordered to produce this data
 frame!</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_total_meals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">total_meals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">no_meals</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">total_meals</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">total_meals</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h3 id="split-apply-combine-data-analysis-and-the-summarize-function">Split-apply-combine data analysis and the summarize() function</h3>

<p>Many data analysis tasks can be approached using the <em>split-apply-combine</em>
paradigm: split the data into groups, apply some analysis to each group, and
then combine the results. <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> makes this very easy through the use of
the <code class="language-plaintext highlighter-rouge">group_by()</code> function.</p>

<h4 id="the-summarize-function">The <code class="language-plaintext highlighter-rouge">summarize()</code> function</h4>

<p><code class="language-plaintext highlighter-rouge">group_by()</code> is often used together with <code class="language-plaintext highlighter-rouge">summarize()</code>, which collapses each
group into a single-row summary of that group.  <code class="language-plaintext highlighter-rouge">group_by()</code> takes as arguments
the column names that contain the <strong>categorical</strong> variables for which you want
to calculate the summary statistics. So to compute the average household size by
village:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` ungrouping output (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  village  mean_no_membrs
  &lt;chr&gt;             &lt;dbl&gt;
1 Chirodzo           7.08
2 God                6.86
3 Ruaca              7.57
</code></pre></div></div>

<p>You may also have noticed that the output from these calls doesn’t run off the
screen anymore. It’s one of the advantages of <code class="language-plaintext highlighter-rouge">tbl_df</code> over dataframe.</p>

<p>You can also group by multiple columns:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 9 x 3
# Groups:   village [3]
  village  memb_assoc mean_no_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
1 Chirodzo no                   8.06
2 Chirodzo yes                  7.82
3 Chirodzo &lt;NA&gt;                 5.08
4 God      no                   7.13
5 God      yes                  8   
6 God      &lt;NA&gt;                 6   
7 Ruaca    no                   7.18
8 Ruaca    yes                  9.5 
9 Ruaca    &lt;NA&gt;                 6.22
</code></pre></div></div>

<p>Note that the output is a grouped tibble. To obtain an ungrouped tibble, use the
<code class="language-plaintext highlighter-rouge">ungroup</code> function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 9 x 3
  village  memb_assoc mean_no_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
1 Chirodzo no                   8.06
2 Chirodzo yes                  7.82
3 Chirodzo &lt;NA&gt;                 5.08
4 God      no                   7.13
5 God      yes                  8   
6 God      &lt;NA&gt;                 6   
7 Ruaca    no                   7.18
8 Ruaca    yes                  9.5 
9 Ruaca    &lt;NA&gt;                 6.22
</code></pre></div></div>

<p>When grouping both by <code class="language-plaintext highlighter-rouge">village</code> and <code class="language-plaintext highlighter-rouge">membr_assoc</code>, we see rows in our table for
respondents who did not specify whether they were a member of an irrigation
association. We can exclude those data from our table using a filter step.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 3
# Groups:   village [3]
  village  memb_assoc mean_no_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
1 Chirodzo no                   8.06
2 Chirodzo yes                  7.82
3 God      no                   7.13
4 God      yes                  8   
5 Ruaca    no                   7.18
6 Ruaca    yes                  9.5 
</code></pre></div></div>

<p>Once the data are grouped, you can also summarize multiple variables at the same
time (and not necessarily on the same variable). For instance, we could add a
column indicating the minimum household size for each village for each group
(members of an irrigation association vs not):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
              </span><span class="n">min_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 4
# Groups:   village [3]
  village  memb_assoc mean_no_membrs min_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;
1 Chirodzo no                   8.06          4
2 Chirodzo yes                  7.82          2
3 God      no                   7.13          3
4 God      yes                  8             5
5 Ruaca    no                   7.18          2
6 Ruaca    yes                  9.5           5
</code></pre></div></div>

<p>It is sometimes useful to rearrange the result of a query to inspect the values.
For instance, we can sort on <code class="language-plaintext highlighter-rouge">min_membrs</code> to put the group with the smallest
household first:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
              </span><span class="n">min_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">arrange</span><span class="p">(</span><span class="n">min_membrs</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 4
# Groups:   village [3]
  village  memb_assoc mean_no_membrs min_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;
1 Chirodzo yes                  7.82          2
2 Ruaca    no                   7.18          2
3 God      no                   7.13          3
4 Chirodzo no                   8.06          4
5 God      yes                  8             5
6 Ruaca    yes                  9.5           5
</code></pre></div></div>

<p>To sort in descending order, we need to add the <code class="language-plaintext highlighter-rouge">desc()</code> function. If we want to
sort the results by decreasing order of minimum household size:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
              </span><span class="n">min_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">min_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'village' (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 4
# Groups:   village [3]
  village  memb_assoc mean_no_membrs min_membrs
  &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;
1 God      yes                  8             5
2 Ruaca    yes                  9.5           5
3 Chirodzo no                   8.06          4
4 God      no                   7.13          3
5 Chirodzo yes                  7.82          2
6 Ruaca    no                   7.18          2
</code></pre></div></div>

<h4 id="counting">Counting</h4>

<p>When working with data, we often want to know the number of observations found
for each factor or combination of factors. For this task, <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> provides
<code class="language-plaintext highlighter-rouge">count()</code>. For example, if we wanted to count the number of rows of data for
each village, we would do:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  village      n
  &lt;chr&gt;    &lt;int&gt;
1 Chirodzo    39
2 God         43
3 Ruaca       49
</code></pre></div></div>

<p>For convenience, <code class="language-plaintext highlighter-rouge">count()</code> provides the <code class="language-plaintext highlighter-rouge">sort</code> argument to get results in
decreasing order:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  village      n
  &lt;chr&gt;    &lt;int&gt;
1 Ruaca       49
2 God         43
3 Chirodzo    39
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="exercise-2">Exercise</h2>

  <p>How many households in the survey have an average of
two meals per day? Three meals per day? Are there any other numbers
of meals represented?</p>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">count</span><span class="p">(</span><span class="n">no_meals</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 2 x 2
  no_meals     n
     &lt;dbl&gt; &lt;int&gt;
1        2    52
2        3    79
</code></pre></div>    </div>
  </blockquote>

  <p>Use <code class="language-plaintext highlighter-rouge">group_by()</code> and <code class="language-plaintext highlighter-rouge">summarize()</code> to find the mean, min, and max
number of household members for each village. Also add the number of
observations (hint: see <code class="language-plaintext highlighter-rouge">?n</code>).</p>

  <blockquote class="solution">
    <h2 id="solution-3">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="w">
      </span><span class="n">mean_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
      </span><span class="n">min_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
      </span><span class="n">max_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">),</span><span class="w">
      </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">()</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` ungrouping output (override with `.groups` argument)
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 5
  village  mean_no_membrs min_no_membrs max_no_membrs     n
  &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt; &lt;int&gt;
1 Chirodzo           7.08             2            12    39
2 God                6.86             3            15    43
3 Ruaca              7.57             2            19    49
</code></pre></div>    </div>
  </blockquote>

  <p>What was the largest household interviewed in each month?</p>

  <blockquote class="solution">
    <h2 id="solution-4">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># if not already included, add month, year, and day columns</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w"> </span><span class="c1"># load lubridate if not already loaded</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'lubridate'
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">month</span><span class="p">(</span><span class="n">interview_date</span><span class="p">),</span><span class="w">
           </span><span class="n">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">day</span><span class="p">(</span><span class="n">interview_date</span><span class="p">),</span><span class="w">
           </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">interview_date</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">max_no_membrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">no_membrs</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` regrouping output by 'year' (override with `.groups` argument)
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 5 x 3
# Groups:   year [2]
   year month max_no_membrs
  &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
1  2016    11            19
2  2016    12            12
3  2017     4            17
4  2017     5            15
5  2017     6            15
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="reshaping-with-pivot_wider-and-pivot_longer">Reshaping with pivot_wider() and pivot_longer()</h2>

<p>There are essentially three rules that define a “tidy” dataset:</p>

<ol>
  <li>Each variable has its own column</li>
  <li>Each observation has its own row</li>
  <li>Each value must have its own cell</li>
</ol>

<p>In this section we will explore how these rules are linked to the different 
data formats researchers are often interested in: “wide” and “long”. This
tutorial will help you efficiently transform your data shape regardless of
original format. First we will explore qualities of the <code class="language-plaintext highlighter-rouge">interviews</code> data and
how they relate to these different types of data formats.</p>

<h3 id="long-and-wide-data-formats">Long and wide data formats</h3>

<p>In the <code class="language-plaintext highlighter-rouge">interviews</code> data, each row contains the values of variables associated
with each record collected (each interview in the villages), where it is stated 
that the the <code class="language-plaintext highlighter-rouge">key_ID</code> was “added to provide a unique Id for each observation” 
and the <code class="language-plaintext highlighter-rouge">instance_ID</code> “does this as well but it is not as convenient to use.”</p>

<p>However, with some inspection, we notice that there are more than one row in the
dataset with the same <code class="language-plaintext highlighter-rouge">key_ID</code> (as seen below). However, the <code class="language-plaintext highlighter-rouge">instanceID</code>s
associated with these duplicate <code class="language-plaintext highlighter-rouge">key_ID</code>s are not the same. Thus, we should
think of <code class="language-plaintext highlighter-rouge">instanceID</code> as the unique identifier for observations!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">key_ID</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">interview_date</span><span class="p">,</span><span class="w"> </span><span class="n">instanceID</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 131 x 4
   key_ID village  interview_date      instanceID                               
    &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;                                    
 1      1 God      2016-11-17 00:00:00 uuid:ec241f2c-0609-46ed-b5e8-fe575f6cefef
 2      1 God      2016-11-17 00:00:00 uuid:099de9c9-3e5e-427b-8452-26250e840d6e
 3      3 God      2016-11-17 00:00:00 uuid:193d7daf-9582-409b-bf09-027dd36f9007
 4      4 God      2016-11-17 00:00:00 uuid:148d1105-778a-4755-aa71-281eadd4a973
 5      5 God      2016-11-17 00:00:00 uuid:2c867811-9696-4966-9866-f35c3e97d02d
 6      6 God      2016-11-17 00:00:00 uuid:daa56c91-c8e3-44c3-a663-af6a49a2ca70
 7      7 God      2016-11-17 00:00:00 uuid:ae20a58d-56f4-43d7-bafa-e7963d850844
 8      8 Chirodzo 2016-11-16 00:00:00 uuid:d6cee930-7be1-4fd9-88c0-82a08f90fb5a
 9      9 Chirodzo 2016-11-16 00:00:00 uuid:846103d2-b1db-4055-b502-9cd510bb7b37
10     10 Chirodzo 2016-12-16 00:00:00 uuid:8f4e49bc-da81-4356-ae34-e0d794a23721
# … with 121 more rows
</code></pre></div></div>

<p>As seen in the code below, for each interview date in each village no 
<code class="language-plaintext highlighter-rouge">instanceID</code>s are the same. Thus, this format is what is called a “long” data
format, where each observation occupies only one row in the dataframe.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">key_ID</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">interview_date</span><span class="p">,</span><span class="w"> </span><span class="n">instanceID</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">sample_n</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 10 x 4
   key_ID village  interview_date      instanceID                               
    &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;                                    
 1     58 Chirodzo 2016-11-16 00:00:00 uuid:a7a3451f-cd0d-4027-82d9-8dcd1234fcca
 2     35 Chirodzo 2016-11-17 00:00:00 uuid:ff7496e7-984a-47d3-a8a1-13618b5683ce
 3     70 Chirodzo 2016-11-16 00:00:00 uuid:1feb0108-4599-4bf9-8a07-1f5e66a50a0a
 4     44 Chirodzo 2016-11-17 00:00:00 uuid:f9fadf44-d040-4fca-86c1-2835f79c4952
 5     50 Chirodzo 2016-11-16 00:00:00 uuid:4267c33c-53a7-46d9-8bd6-b96f58a4f92c
 6     51 Chirodzo 2016-11-16 00:00:00 uuid:18ac8e77-bdaf-47ab-85a2-e4c947c9d3ce
 7     55 Chirodzo 2016-11-16 00:00:00 uuid:883c0433-9891-4121-bc63-744f082c1fa0
 8     37 Chirodzo 2016-11-17 00:00:00 uuid:408c6c93-d723-45ef-8dee-1b1bd3fe20cd
 9     64 Chirodzo 2016-11-16 00:00:00 uuid:28cfd718-bf62-4d90-8100-55fafbe45d06
10     52 Chirodzo 2016-11-16 00:00:00 uuid:6db55cb4-a853-4000-9555-757b7fae2bcf
</code></pre></div></div>

<p>We notice that the layout or format of the <code class="language-plaintext highlighter-rouge">interviews</code> data is in a format that
adheres to rules 1-3, where</p>

<ul>
  <li>each column is a variable</li>
  <li>each row is an observation</li>
  <li>each value has its own cell</li>
</ul>

<p>This is called a “long” data format. But, we notice that each column represents 
a different variable. In the “longest” data format there would only be three 
columns, one for the id variable, one for the observed variable, and one for the 
observed value (of that variable). This data format is quite unsightly
and difficult to work with, so you will rarely see it in use.</p>

<p>Alternatively, in a “wide” data format we see modifications to rule 1, where 
each column no longer represents a single variable. Instead, columns can
represent different levels/values of a variable. For instance, in some data you
encounter the researchers may have chosen for every survey date to be a
different column.</p>

<p>These may sound like dramatically different data layouts, but there are some 
tools that make transitions between these layouts much simpler than you might 
think! The gif below shows how these two formats relate to each other, and 
gives you an idea of how we can use R to shift from one format to the other.</p>

<p><img src="../fig/tidyr-pivot_wider_longer.gif" alt="" />
Long and wide dataframe layouts mainly affect readability. You may find that
visually you may prefer the “wide” format, since you can see more of the data on
the screen. However, all of the R functions we have used thus far expect for
your data to be in a “long” data format. This is because the long format is more
machine readable and is closer to the formatting of databases.</p>

<h3 id="questions-which-warrant-different-data-formats">Questions which warrant different data formats</h3>

<p>In interviews, each row contains the values of variables associated with each
record (the unit), values such as the village of the respondent, the number
of household members, or the type of wall their house had. This format allows 
for us to make comparisons across individual surveys, but what if we wanted to
look at differences in households grouped by different types of housing
construction materials?</p>

<p>To facilitate this comparison we would need to create a new table where each row
(the unit) was comprised of values of variables associated with housing material
(e.g. the <code class="language-plaintext highlighter-rouge">respondent_wall_type</code>). In practical terms this means the values of
the wall construction materials in <code class="language-plaintext highlighter-rouge">respondent_wall_type</code> (e.g. muddaub, 
burntbricks, cement, sunbricks) would become the names of column variables and
the cells would contain values of <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code>, for whether that house had
a wall made of that material.</p>

<p>Once we we’ve created this new table, we can explore the relationship within and
between villages. The key point here is that we are still following a tidy data
structure, but we have <strong>reshaped</strong> the data according to the observations of
interest.</p>

<p>Alternatively, if the interview dates were spread across multiple columns, and 
we were interested in visualizing, within each village, how irrigation
conflicts have changed over time. This would require for the interview date to 
be included in a single column rather than spread across multiple columns. Thus, 
we would need to transform the column names into values of a variable.</p>

<p>We can do both these of transformations with two <code class="language-plaintext highlighter-rouge">tidyr</code> functions,
<code class="language-plaintext highlighter-rouge">pivot_wider()</code> and <code class="language-plaintext highlighter-rouge">pivot_longer()</code>.</p>

<h3 id="pivoting-wider">Pivoting wider</h3>

<p><code class="language-plaintext highlighter-rouge">pivot_wider()</code> takes three principal arguments:</p>

<ol>
  <li>the data</li>
  <li>the <em>names_from</em> column variable whose values will become new column names.</li>
  <li>the <em>values_from</em> column variable whose values will fill the new column
variables.</li>
</ol>

<p>Further arguments include <code class="language-plaintext highlighter-rouge">values_fill</code> which, if set, fills in missing values
with the value provided.</p>

<p>Let’s use <code class="language-plaintext highlighter-rouge">pivot_wider()</code> to transform interviews to create new columns for each
type of wall construction material. We will make use of the pipe operator as
have done before. Because both the <code class="language-plaintext highlighter-rouge">names_from</code> and <code class="language-plaintext highlighter-rouge">values_from</code> parameters
must come from column values, we will create a dummy column (we’ll name it
<code class="language-plaintext highlighter-rouge">wall_type_logical</code>) to hold the value <code class="language-plaintext highlighter-rouge">TRUE</code>, which we will then place into the
appropriate column that corresponds to the wall construction material for that
respondent. When using <code class="language-plaintext highlighter-rouge">mutate()</code> if you give a single value, it will be used
for all observations in the dataset.</p>

<p>For each row in our newly pivoted table, only one of the newly created wall type
columns will have a value of <code class="language-plaintext highlighter-rouge">TRUE</code>, since each house can only be made of one 
wall type. The default value that <code class="language-plaintext highlighter-rouge">pivot_wider</code> uses to fill the other wall
types is <code class="language-plaintext highlighter-rouge">NA</code>.</p>

<p><img src="../fig/pivot_long_to_wide.png" alt="" /></p>

<p>If instead of the default value being <code class="language-plaintext highlighter-rouge">NA</code>, we wanted these values to be <code class="language-plaintext highlighter-rouge">FALSE</code>, 
we can insert a default value into the <code class="language-plaintext highlighter-rouge">values_fill</code> argument. By including 
<code class="language-plaintext highlighter-rouge">values_fill = list(wall_type_logical = FALSE)</code> inside <code class="language-plaintext highlighter-rouge">pivot_wider()</code>, we can 
fill the remainder of the wall type columns for that row with the value <code class="language-plaintext highlighter-rouge">FALSE</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">wall_type_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">,</span><span class="w"> 
                </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wall_type_logical</span><span class="p">,</span><span class="w"> 
                </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">wall_type_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>View the <code class="language-plaintext highlighter-rouge">interviews_wide</code> dataframe and notice that there is no longer a
column titled <code class="language-plaintext highlighter-rouge">respondent_wall_type</code>. This is because there is a default
parameter in <code class="language-plaintext highlighter-rouge">pivot_wider()</code> that drops the original column. The values that
were in that column have now become columns named <code class="language-plaintext highlighter-rouge">muddaub</code>, <code class="language-plaintext highlighter-rouge">burntbricks</code>,
<code class="language-plaintext highlighter-rouge">sunbricks</code>, and <code class="language-plaintext highlighter-rouge">cement</code>. You can use <code class="language-plaintext highlighter-rouge">dim(interviews)</code> and 
<code class="language-plaintext highlighter-rouge">dim(interviews_wide)</code> to see how the number of columns has changed between 
the two datasets.</p>

<h3 id="pivoting-longer">Pivoting longer</h3>

<p>The opposing situation could occur if we had been provided with data in the form
of <code class="language-plaintext highlighter-rouge">interviews_wide</code>, where the building materials are column names, but we
wish to treat them as values of a <code class="language-plaintext highlighter-rouge">respondent_wall_type</code> variable instead.</p>

<p>In this situation we are gathering these columns turning them into a pair
of new variables. One variable includes the column names as values, and the
other variable contains the values in each cell previously associated with the
column names. We will do this in two steps to make this process a bit clearer.</p>

<p><code class="language-plaintext highlighter-rouge">pivot_longer()</code> takes four principal arguments:</p>

<ol>
  <li>the data</li>
  <li><em>cols</em> are the names of the columns we use to fill the a new values variable
(or to drop).</li>
  <li>the <em>names_to</em> column variable we wish to create from the <em>cols</em> provided.</li>
  <li>the <em>values_to</em> column variable we wish to create and fill with values
associated with the <em>cols</em> provided.</li>
</ol>

<p>To recreate our original dataframe, we will use the following:</p>

<ol>
  <li>the data - <code class="language-plaintext highlighter-rouge">interviews_wide</code></li>
  <li>a list of <em>cols</em> (columns) that are to be reshaped; these can be specified 
using a  <code class="language-plaintext highlighter-rouge">:</code> if the columns to be reshaped are in one area of the dataframe, 
or with a vector (<code class="language-plaintext highlighter-rouge">c()</code>) command if the columns are spread throughout the
dataframe.</li>
  <li>the <em>names_to</em> column will be a character string of the name the column 
these columns will be collapsed into (“respondent_wall_type”).</li>
  <li>the <em>values_to</em> column will be a character string of the name of the 
column the values of the collapsed columns will be inserted into 
(“wall_type_logical”). This column will be populated with values of 
<code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code>.</li>
</ol>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews_wide</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">pivot_longer</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">burntbricks</span><span class="o">:</span><span class="n">sunbricks</span><span class="p">,</span><span class="w">
                 </span><span class="n">names_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"respondent_wall_type"</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">values_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"wall_type_logical"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/pivot_wide_to_long.png" alt="" /></p>

<p>This creates a dataframe with 262 rows (4 rows per
interview respondent). The four rows for each respondent differ only in the
value of the “respondent_wall_type” and “wall_type_logical” columns. View the
data to see what this looks like.</p>

<p>Only one row for each interview respondent is informative–we know that if the
house walls are made of “sunbrick” they aren’t made of any other the other
materials. Therefore, it would make sense to filter our dataset to only keep
values where <code class="language-plaintext highlighter-rouge">wall_type_logical</code> is <code class="language-plaintext highlighter-rouge">TRUE</code>. Because <code class="language-plaintext highlighter-rouge">wall_type_logical</code> is
already either <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code>, when passing the column name to <code class="language-plaintext highlighter-rouge">filter()</code>,
it will automatically already only keep rows where this column has the value
<code class="language-plaintext highlighter-rouge">TRUE</code>. We can then remove the <code class="language-plaintext highlighter-rouge">wall_type_logical</code> column.</p>

<p>We do all of these steps together in the next chunk of code:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews_wide</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">pivot_longer</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">burntbricks</span><span class="p">,</span><span class="w"> </span><span class="n">cement</span><span class="p">,</span><span class="w"> </span><span class="n">muddaub</span><span class="p">,</span><span class="w"> </span><span class="n">sunbricks</span><span class="p">),</span><span class="w">
                 </span><span class="n">names_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"respondent_wall_type"</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">values_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"wall_type_logical"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">wall_type_logical</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">wall_type_logical</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>View both <code class="language-plaintext highlighter-rouge">interviews_long</code> and <code class="language-plaintext highlighter-rouge">interviews_wide</code> and compare their structure.</p>

<h2 id="applying-pivot_wider-to-clean-our-data">Applying <code class="language-plaintext highlighter-rouge">pivot_wider()</code> to clean our data</h2>

<p>Now that we’ve learned about <code class="language-plaintext highlighter-rouge">pivot_longer()</code> and <code class="language-plaintext highlighter-rouge">pivot_wider()</code> we’re going to
put these functions to use to fix a problem with the way that our data is
structured. In the spreadsheets lesson, we learned that it’s best practice to
have only a single piece of information in each cell of your spreadsheet. In
this dataset, we have several columns which contain multiple pieces of
information. For example, the <code class="language-plaintext highlighter-rouge">items_owned</code> column contains information about
whether our respondents owned a fridge, a television, etc. To make this data
easier to analyze, we will split this column and create a new column for each
item. Each cell in that column will either be <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code> and will
indicate whether that interview respondent owned that item (similar to what 
we did previously with <code class="language-plaintext highlighter-rouge">wall_type</code>).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_items_owned</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">separate_rows</span><span class="p">(</span><span class="n">items_owned</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">replace_na</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"no_listed_items"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned</span><span class="p">,</span><span class="w"> 
                </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned_logical</span><span class="p">,</span><span class="w"> 
                </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">

</span><span class="n">nrow</span><span class="p">(</span><span class="n">interviews_items_owned</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 131
</code></pre></div></div>

<p>There are a couple of new concepts in this code chunk, so let’s walk through it
line by line. First we create a new object (<code class="language-plaintext highlighter-rouge">interviews_items_owned</code>) based on
the <code class="language-plaintext highlighter-rouge">interviews</code> dataframe.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_items_owned</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span></code></pre></div></div>

<p>Then we use the new function <code class="language-plaintext highlighter-rouge">separate_rows()</code> from the <strong><code class="language-plaintext highlighter-rouge">tidyr</code></strong> package to
separate the values of <code class="language-plaintext highlighter-rouge">items_owned</code> based on the presence of semi-colons (<code class="language-plaintext highlighter-rouge">;</code>).
The values of this variable were multiple items separated by semi-colons, so 
this action creates a row for each item listed in a household’s possession. 
Thus, we end up with a long format version of the dataset, with multiple rows
for each respondent. For example, if a respondent has a television and a solar
panel, that respondent will now have two rows, one with “television” and the
other with “solar panel” in the <code class="language-plaintext highlighter-rouge">items_owned</code> column.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">separate_rows</span><span class="p">(</span><span class="n">items_owned</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span></code></pre></div></div>

<p>You may notice that one of the columns is called <code class="language-plaintext highlighter-rouge">´NA´</code>. This is because some 
of the respondents did not own any of the items that was in the interviewer’s
list. We can use the <code class="language-plaintext highlighter-rouge">replace_na()</code> function to change these <code class="language-plaintext highlighter-rouge">NA</code> values to 
something more meaningful. The <code class="language-plaintext highlighter-rouge">replace_na()</code> function expects for you to give 
it a <code class="language-plaintext highlighter-rouge">list()</code> of columns that you would like to replace the <code class="language-plaintext highlighter-rouge">NA</code> values in, 
and the value that you would like to replace the <code class="language-plaintext highlighter-rouge">NA</code>s. This ends up looking 
like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">replace_na</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"no_listed_items"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span></code></pre></div></div>

<p>Next, we create a new variable named <code class="language-plaintext highlighter-rouge">items_owned_logical</code>, which has one value
(<code class="language-plaintext highlighter-rouge">TRUE</code>) for every row. This makes since, since each item in every row was owned
by that household. We are constructing this variable so that when spread the 
<code class="language-plaintext highlighter-rouge">items_owned</code> across multiple columns, we can fill the values of those columns 
with logical values describing whether the household did (<code class="language-plaintext highlighter-rouge">TRUE</code>) or didn’t 
(<code class="language-plaintext highlighter-rouge">FALSE</code>) own that particular item.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mutate</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span></code></pre></div></div>

<p>Lastly, we use <code class="language-plaintext highlighter-rouge">pivot_wider()</code> to switch from long format to wide format. This
creates a new column for each of the unique values in the <code class="language-plaintext highlighter-rouge">items_owned</code> column,
and fills those columns with the values of <code class="language-plaintext highlighter-rouge">items_owned_logical</code>. We also
declare that for items that are missing, we want to fill those cells with the 
value of <code class="language-plaintext highlighter-rouge">FALSE</code> instead of <code class="language-plaintext highlighter-rouge">NA</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned</span><span class="p">,</span><span class="w">
            </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned_logical</span><span class="p">,</span><span class="w">
            </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>View the <code class="language-plaintext highlighter-rouge">interviews_items_owned</code> dataframe. It should have 
131 rows (the same number of rows you had originally), but
extra columns for each item. How many columns were added?</p>

<p>This format of the data allows us to do interesting things, like make a table
showing the number of respondents in each village who owned a particular item:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_items_owned</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">bicycle</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">bicycle</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 3
# Groups:   village [3]
  village  bicycle     n
  &lt;chr&gt;    &lt;lgl&gt;   &lt;int&gt;
1 Chirodzo TRUE       17
2 God      TRUE       23
3 Ruaca    TRUE       20
</code></pre></div></div>

<p>Or below we calculate the average number of items from the list owned by
respondents in each village. This code uses the <code class="language-plaintext highlighter-rouge">rowSums()</code> function to count
the number of <code class="language-plaintext highlighter-rouge">TRUE</code> values in the <code class="language-plaintext highlighter-rouge">bicycle</code> to <code class="language-plaintext highlighter-rouge">car</code> columns for each row,
hence its name. We then group the data by villages and caluculate the mean
number of items, so each average is grouped by village.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_items_owned</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">number_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">bicycle</span><span class="o">:</span><span class="n">car</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">number_items</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` ungrouping output (override with `.groups` argument)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  village  mean_items
  &lt;chr&gt;         &lt;dbl&gt;
1 Chirodzo       4.62
2 God            4.07
3 Ruaca          5.63
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="exercise-3">Exercise</h2>

  <ol>
    <li>Create a new dataframe (named <code class="language-plaintext highlighter-rouge">interviews_months_lack_food</code>) that has one
column for each month and records <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code> for whether each interview
respondent was lacking food in that month.</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-5">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_months_lack_food</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">separate_rows</span><span class="p">(</span><span class="n">months_lack_food</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">months_lack_food_logical</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">months_lack_food</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">months_lack_food_logical</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">months_lack_food_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>

  <ol>
    <li>How many months (on average) were respondents without food if
they did belong to an irrigation association? What about if they didn’t?</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-6">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_months_lack_food</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">number_months</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">Jan</span><span class="o">:</span><span class="n">May</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_months</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">number_months</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` ungrouping output (override with `.groups` argument)
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  memb_assoc mean_months
  &lt;chr&gt;            &lt;dbl&gt;
1 no                2   
2 yes               2.30
3 &lt;NA&gt;              2.82
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="exporting-data">Exporting data</h2>

<p>Now that you have learned how to use <strong><code class="language-plaintext highlighter-rouge">dplyr</code></strong> to extract information from
or summarize your raw data, you may want to export these new data sets to share
them with your collaborators or for archival.</p>

<p>Similar to the <code class="language-plaintext highlighter-rouge">read_csv()</code> function used for reading CSV files into R, there is
a <code class="language-plaintext highlighter-rouge">write_csv()</code> function that generates CSV files from dataframes.</p>

<p>Before using <code class="language-plaintext highlighter-rouge">write_csv()</code>, we are going to create a new folder, <code class="language-plaintext highlighter-rouge">data_output</code>,
in our working directory that will store this generated dataset. We don’t want
to write generated datasets in the same directory as our raw data. It’s good
practice to keep them separate. The <code class="language-plaintext highlighter-rouge">data</code> folder should only contain the raw,
unaltered data, and should be left alone to make sure we don’t delete or modify
it. In contrast, our script will generate the contents of the <code class="language-plaintext highlighter-rouge">data_output</code>
directory, so even if the files it contains are deleted, we can always
re-generate them.</p>

<p>In preparation for our next lesson on plotting, we are going to create a version
of the dataset where each of the columns includes only one data value. To do
this, we will use <code class="language-plaintext highlighter-rouge">pivot_wider</code> to expand the <code class="language-plaintext highlighter-rouge">months_lack_food</code> and
<code class="language-plaintext highlighter-rouge">items_owned</code> columns. We will also create a couple of summary columns.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## pivot wider by items_owned</span><span class="w">
  </span><span class="n">separate_rows</span><span class="p">(</span><span class="n">items_owned</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## if there were no items listed, changing NA to no_listed_items</span><span class="w">
  </span><span class="n">replace_na</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"no_listed_items"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned_logical</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## pivot wider by months_lack_food</span><span class="w">
  </span><span class="n">separate_rows</span><span class="p">(</span><span class="n">months_lack_food</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">months_lack_food_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">months_lack_food</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">months_lack_food_logical</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">months_lack_food_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## add some summary columns</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">number_months_lack_food</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">Jan</span><span class="o">:</span><span class="n">May</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">number_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">bicycle</span><span class="o">:</span><span class="n">car</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Now we can save this dataframe to our <code class="language-plaintext highlighter-rouge">data_output</code> directory.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write_csv</span><span class="p">(</span><span class="n">interviews_plotting</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data_output/interviews_plotting.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext warning highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning: The `path` argument of `write_csv()` is deprecated as of readr 1.4.0.
Please use the `file` argument instead.
This warning is displayed once every 8 hours.
Call `lifecycle::last_warnings()` to see where this warning was generated.
</code></pre></div></div>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use the <code class="language-plaintext highlighter-rouge">dplyr</code> package to manipulate dataframes.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">select()</code> to choose variables from a dataframe.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">filter()</code> to choose data based on values.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">group_by()</code> and <code class="language-plaintext highlighter-rouge">summarize()</code> to work with subsets of data.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">mutate()</code> to create new variables.</p>
</li>
    
    <li><p>Use the <code class="language-plaintext highlighter-rouge">tidyr</code> package to change the layout of dataframes.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">pivot_wider()</code> to go from long to wide format.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">pivot_longer()</code> to go from wide to long format.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="data-visualisation-with-ggplot2" class="maintitle">Data Visualisation with ggplot2</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 80 min
      <br />
      <strong>Exercises:</strong> 35 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What are the components of a ggplot?</p>
</li>
	
	<li><p>How do I create scatterplots, boxplots, and barplots?</p>
</li>
	
	<li><p>How can I change the aesthetics (ex. colour, transparency) of my plot?</p>
</li>
	
	<li><p>How can I create multiple plots at once?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Produce scatter plots, boxplots, and time series plots using ggplot.</p>
</li>
	
	<li><p>Set universal plot settings.</p>
</li>
	
	<li><p>Describe what faceting is and apply faceting in ggplot.</p>
</li>
	
	<li><p>Modify the aesthetics of an existing ggplot plot (including axis labels and colour).</p>
</li>
	
	<li><p>Build complex and customized plots from data in a data frame.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>We start by loading the required package. <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> is also included in the
<strong><code class="language-plaintext highlighter-rouge">tidyverse</code></strong> package.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>If not still in the workspace, load the data we saved in the previous lesson.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"data_output/interviews_plotting.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  .default = col_logical(),
  key_ID = col_double(),
  village = col_character(),
  interview_date = col_datetime(format = ""),
  no_membrs = col_double(),
  years_liv = col_double(),
  respondent_wall_type = col_character(),
  rooms = col_double(),
  memb_assoc = col_character(),
  affect_conflicts = col_character(),
  liv_count = col_double(),
  no_meals = col_double(),
  instanceID = col_character(),
  number_months_lack_food = col_double(),
  number_items = col_double()
)
ℹ Use `spec()` for the full column specifications.
</code></pre></div></div>

<p>If you were unable to complete the previous lesson or did not save the data,
then you can create it now.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## pivot wider by items_owned</span><span class="w">
  </span><span class="n">separate_rows</span><span class="p">(</span><span class="n">items_owned</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## if there were no items listed, changing NA to no_listed_items</span><span class="w">
  </span><span class="n">replace_na</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"no_listed_items"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_owned_logical</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## pivot wider by months_lack_food</span><span class="w">
  </span><span class="n">separate_rows</span><span class="p">(</span><span class="n">months_lack_food</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">months_lack_food_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">months_lack_food</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">months_lack_food_logical</span><span class="p">,</span><span class="w"> 
              </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">months_lack_food_logical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1">## add some summary columns</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">number_months_lack_food</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">Jan</span><span class="o">:</span><span class="n">May</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">number_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">bicycle</span><span class="o">:</span><span class="n">car</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in eval(lhs, parent, parent): object 'interviews' not found
</code></pre></div></div>

<h2 id="plotting-with-ggplot2">Plotting with <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong></h2>

<p><strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> is a plotting package that makes it simple to create complex plots
from data stored in a data frame. It provides a programmatic interface for
specifying what variables to plot, how they are displayed, and general visual
properties. Therefore, we only need minimal changes if the underlying data
change or if we decide to change from a bar plot to a scatterplot. This helps in
creating publication quality plots with minimal amounts of adjustments and
tweaking.</p>

<p><strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> functions work best with data in the ‘long’ format, i.e., a column for every
dimension, and a row for every observation. Well-structured data will save you
lots of time when making figures with <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong></p>

<p>ggplot graphics are built step by step by adding new elements. Adding layers in
this fashion allows for extensive flexibility and customization of plots.</p>

<p>To build a ggplot, we will use the following basic template that can be used for different types of plots:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;DATA&gt; %&gt;%
    ggplot(aes(&lt;MAPPINGS&gt;)) +
    &lt;GEOM_FUNCTION&gt;()
</code></pre></div></div>
<p>Remember from the last lesson that the pipe operator <code class="language-plaintext highlighter-rouge">%&gt;%</code> places the result of the previous line(s) into the first argument of the function. <strong><code class="language-plaintext highlighter-rouge">ggplot</code></strong> is a function that expects a data frame to be the first argument. This allows for us to change from specifying the <code class="language-plaintext highlighter-rouge">data =</code> argument within the <code class="language-plaintext highlighter-rouge">ggplot</code> function and instead pipe the data into the function.</p>

<ul>
  <li>use the <code class="language-plaintext highlighter-rouge">ggplot()</code> function and bind the plot to a specific data frame.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>define a mapping (using the aesthetic (<code class="language-plaintext highlighter-rouge">aes</code>) function), by selecting the variables to be plotted and specifying how to present them in the graph, e.g. as x/y positions or characteristics such as size, shape, color, etc.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_items</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>
    <p>add ‘geoms’ – graphical representations of the data in the plot (points,
lines, bars). <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> offers many different geoms; we will use some
common ones today, including:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">geom_point()</code> for scatter plots, dot plots, etc.</li>
      <li><code class="language-plaintext highlighter-rouge">geom_boxplot()</code> for, well, boxplots!</li>
      <li><code class="language-plaintext highlighter-rouge">geom_line()</code> for trend lines, time series, etc.</li>
    </ul>
  </li>
</ul>

<p>To add a geom to the plot use the <code class="language-plaintext highlighter-rouge">+</code> operator. Because we have two continuous variables, let’s use <code class="language-plaintext highlighter-rouge">geom_point()</code> first:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_items</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-first-ggplot-1.png" title="plot of chunk first-ggplot" alt="plot of chunk first-ggplot" width="612" style="display: block; margin: auto;" /></p>

<p>The <code class="language-plaintext highlighter-rouge">+</code> in the <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> package is particularly useful because it allows
you to modify existing <code class="language-plaintext highlighter-rouge">ggplot</code> objects. This means you can easily set up plot
templates and conveniently explore different types of plots, so the above plot
can also be generated with code like this, similar to the “intermediate steps” 
approach in the previous lesson:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Assign plot to a variable</span><span class="w">
</span><span class="n">interviews_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_items</span><span class="p">))</span><span class="w">

</span><span class="c1"># Draw the plot as a dot plot</span><span class="w">
</span><span class="n">interviews_plot</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <h2 id="notes">Notes</h2>

  <ul>
    <li>Anything you put in the <code class="language-plaintext highlighter-rouge">ggplot()</code> function can be seen by any geom layers
that you add (i.e., these are universal plot settings). This includes the x-
and y-axis mapping you set up in <code class="language-plaintext highlighter-rouge">aes()</code>.</li>
    <li>You can also specify mappings for a given geom independently of the mapping
defined globally in the <code class="language-plaintext highlighter-rouge">ggplot()</code> function.</li>
    <li>The <code class="language-plaintext highlighter-rouge">+</code> sign used to add new layers must be placed at the end of the line
containing the <em>previous</em> layer. If, instead, the <code class="language-plaintext highlighter-rouge">+</code> sign is added at the
beginning of the line containing the new layer, <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> will not add
the new layer and will return an error message.</li>
  </ul>
</blockquote>

<div class="language-r callout highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## This is the correct syntax for adding layers</span><span class="w">
</span><span class="n">interviews_plot</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1">## This will not add the new layer and will return an error message</span><span class="w">
</span><span class="n">interviews_plot</span><span class="w">
</span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<h2 id="building-your-plots-iteratively">Building your plots iteratively</h2>

<p>Building plots with <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> is typically an iterative process. We start by
defining the dataset we’ll use, lay out the axes, and choose a geom:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_items</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-create-ggplot-object-1.png" title="plot of chunk create-ggplot-object" alt="plot of chunk create-ggplot-object" width="612" style="display: block; margin: auto;" /></p>

<p>Then, we start modifying this plot to extract more information from it. For
instance, when inspecting the plot we notice that points only appear at the 
intersection of whole numbers of <code class="language-plaintext highlighter-rouge">no_membrs</code> and <code class="language-plaintext highlighter-rouge">number_items</code>. Also, from a 
rough estimate, it looks like there are far fewer dots on the plot than there 
rows in our dataframe. This should lead us to believe that there may be multiple
observations plotted on top of each other (e.g. three observations where 
<code class="language-plaintext highlighter-rouge">no_membrs</code> is 3 and <code class="language-plaintext highlighter-rouge">number_items</code> is 1).</p>

<p>There are two main ways to alleviate overplotting issues:</p>
<ol>
  <li>changing the transparency of the points</li>
  <li>jittering the location of the points</li>
</ol>

<p>Let’s first explore option 1, changing the transparency of the points. What we 
mean when we say “transparency” we mean the opacity of point, or your ability to 
see through the point. We can control the transparency of the points with the 
<code class="language-plaintext highlighter-rouge">alpha</code> argument to <code class="language-plaintext highlighter-rouge">geom_point</code>. Values of <code class="language-plaintext highlighter-rouge">alpha</code> range from 0 to 1, with
lower values corresponding to more transparent colors (an <code class="language-plaintext highlighter-rouge">alpha</code> of 1 is the 
default value).</p>

<p>Here, we change the <code class="language-plaintext highlighter-rouge">alpha</code> to 0.5, in an attempt to help fix the overplotting. 
While the overplotting isn’t solved, adding transparency begins to address this
problem, as the points where there are overlapping observations are darker (as 
opposed to lighter gray):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_items</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-adding-transparency-1.png" title="plot of chunk adding-transparency" alt="plot of chunk adding-transparency" width="612" style="display: block; margin: auto;" /></p>

<p>That only helped a little bit with the overplotting problem, so let’s try option
two. We can jitter the points on the plot, so that we can see each point in the
locations where there are overlapping points. Jittering introduces a little bit
of randomness into the position of our points. You can think of this process as 
taking the overplotted graph and giving it a tiny shake. The points will move a 
little bit side-to-side and up-and-down, but their position from the original 
plot won’t dramatically change.</p>

<p>We can jitter our points using the <code class="language-plaintext highlighter-rouge">geom_jitter()</code> function instead of the
<code class="language-plaintext highlighter-rouge">geom_point()</code>  function, as seen below:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_items</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_jitter</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-adding-jitter-1.png" title="plot of chunk adding-jitter" alt="plot of chunk adding-jitter" width="612" style="display: block; margin: auto;" />
The <code class="language-plaintext highlighter-rouge">geom_jitter()</code> function allows for us to specify the amount of random
motion in the jitter, using the <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code> arguments. When we don’t 
specify values for <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code>, <code class="language-plaintext highlighter-rouge">geom_jitter()</code> defaults to 40% of the
resolution of the data (the smallest change that can be measured). Hence, if we 
would like <em>less</em> spread in our jitter than was default, we should pick values 
between 0.1 and 0.4. Experiment with the values to see how your plot changes.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_items</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
                </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w">
                </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-adding-width-height-1.png" title="plot of chunk adding-width-height" alt="plot of chunk adding-width-height" width="612" style="display: block; margin: auto;" /></p>

<p>For our final change, we can also add colours for all the points by specifying 
a <code class="language-plaintext highlighter-rouge">color</code> argument inside the <code class="language-plaintext highlighter-rouge">geom_jitter()</code> function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_items</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
                </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
                </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w">
                </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-adding-colors-1.png" title="plot of chunk adding-colors" alt="plot of chunk adding-colors" width="612" style="display: block; margin: auto;" /></p>

<p>To colour each species in the plot differently, you could use a vector as an input 
to the argument <strong><code class="language-plaintext highlighter-rouge">color</code></strong>.  However, because we are now mapping features of the
data to a colour, instead of setting one colour for all points, the colour of the 
points now needs to be set inside a call to the <strong><code class="language-plaintext highlighter-rouge">aes</code></strong> function. When we map 
a variable in our data to the colour of the points, <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> will provide a
different colour corresponding to the different values of the variable. We will 
continue to specify the value of <strong><code class="language-plaintext highlighter-rouge">alpha</code></strong>, <strong><code class="language-plaintext highlighter-rouge">width</code></strong>, and <strong><code class="language-plaintext highlighter-rouge">height</code></strong>
outside of the <strong><code class="language-plaintext highlighter-rouge">aes</code></strong> function because we are using the same value for 
every point. Here is an example where we color points by the <strong><code class="language-plaintext highlighter-rouge">village</code></strong> 
of the observation:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_items</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-color-by-species-1.png" title="plot of chunk color-by-species" alt="plot of chunk color-by-species" width="612" style="display: block; margin: auto;" /></p>

<p>There appears to be a positive trend between number of household
members and number of items owned (from the list provided). Additionally, 
this trend does not appear to be different by village.</p>

<blockquote>
  <h2 id="notes-1">Notes</h2>

  <p>As you will learn, there are multiple ways to plot the a relationship
between variables. Another way to plot data with overlapping points is 
to use the <code class="language-plaintext highlighter-rouge">geom_count</code> plotting function. The <code class="language-plaintext highlighter-rouge">geom_count()</code>  function 
makes the size of each point representative of the number of data items 
of that type and the legend gives point sizes associated to particular 
numbers of items.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_membrs</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_items</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_count</span><span class="p">()</span><span class="w">
</span></code></pre></div>  </div>

  <p><img src="../fig/rmd-04-color-by-species-notes-1.png" title="plot of chunk color-by-species-notes" alt="plot of chunk color-by-species-notes" width="612" style="display: block; margin: auto;" /></p>
</blockquote>

<blockquote class="callout challenge">
  <h2 id="exercise">Exercise</h2>

  <p>Use what you just learned to create a scatter plot of <code class="language-plaintext highlighter-rouge">rooms</code> by <code class="language-plaintext highlighter-rouge">village</code>
with the <code class="language-plaintext highlighter-rouge">respondent_wall_type</code> showing in different colours. Does this 
seem like a good way to display the relationship between these variables? 
What other kinds of plots might you use to show this type of data?</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rooms</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">),</span><span class="w">
		    </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
		    </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w">
		    </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-04-scatter-challenge-1.png" title="plot of chunk scatter-challenge" alt="plot of chunk scatter-challenge" width="612" style="display: block; margin: auto;" /></p>

    <p>This is not a great way to show this type of data because it is difficult to
distinguish between villages. What other plot types could help you visualize
this relationship better?</p>
  </blockquote>
</blockquote>

<h2 id="boxplot">Boxplot</h2>

<p>We can use boxplots to visualize the distribution of rooms for each
wall type:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rooms</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-boxplot-1.png" title="plot of chunk boxplot" alt="plot of chunk boxplot" width="612" style="display: block; margin: auto;" /></p>

<p>By adding points to a boxplot, we can have a better idea of the number of
measurements and of their distribution:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rooms</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_boxplot</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
    		</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tomato"</span><span class="p">,</span><span class="w">
    		</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w">
    		</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: &lt;text&gt;:8:0: unexpected end of input
6:                 width = 0.2,
7:                 height = 0.2) +
  ^
</code></pre></div></div>

<p>We can see that muddaub houses and sunbrick houses tend to be smaller than
burntbrick houses.</p>

<p>Notice how the  boxplot layer is behind the jitter layer? What do you need to
change in the code to put the boxplot in behind the points such that it’s not 
hidden?</p>

<blockquote class="challenge">
  <h2 id="exercise-1">Exercise</h2>

  <p>Boxplots are useful summaries, but hide the <em>shape</em> of the distribution. For
example, if the distribution is bimodal, we would not see it in a
boxplot. An alternative to the boxplot is the violin plot, where the shape
(of the density of points) is drawn.</p>

  <ul>
    <li>Replace the box plot with a violin plot; see <code class="language-plaintext highlighter-rouge">geom_violin()</code>.</li>
  </ul>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rooms</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_violin</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tomato"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-04-violin-plot-1.png" title="plot of chunk violin-plot" alt="plot of chunk violin-plot" width="612" style="display: block; margin: auto;" /></p>
  </blockquote>

  <p>So far, we’ve looked at the distribution of room number within wall type. Try
making a new plot to explore the distribution of another variable within wall
type.</p>

  <ul>
    <li>Create a boxplot for <code class="language-plaintext highlighter-rouge">liv_count</code> for each wall type. Overlay the boxplot
layer on a jitter layer to show actual measurements.</li>
  </ul>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">liv_count</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_boxplot</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-04-boxplot-exercise-1.png" title="plot of chunk boxplot-exercise" alt="plot of chunk boxplot-exercise" width="612" style="display: block; margin: auto;" /></p>
  </blockquote>

  <ul>
    <li>Add colour to the data points on your boxplot according to whether the
respondent is a member of an irrigation association (<code class="language-plaintext highlighter-rouge">memb_assoc</code>).</li>
  </ul>

  <blockquote class="solution">
    <h2 id="solution-3">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">liv_count</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_boxplot</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-04-boxplot-exercise-factor-1.png" title="plot of chunk boxplot-exercise-factor" alt="plot of chunk boxplot-exercise-factor" width="612" style="display: block; margin: auto;" /></p>
  </blockquote>
</blockquote>

<h2 id="barplots">Barplots</h2>

<p>Barplots are also useful for visualizing categorical data. By default,
<code class="language-plaintext highlighter-rouge">geom_bar</code> accepts a variable for x, and plots the number of instances each
value of x (in this case, wall type) appears in the dataset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-barplot-1-1.png" title="plot of chunk barplot-1" alt="plot of chunk barplot-1" width="612" style="display: block; margin: auto;" /></p>

<p>We can use the <code class="language-plaintext highlighter-rouge">fill</code> aesthetic for the <code class="language-plaintext highlighter-rouge">geom_bar()</code> geom to colour bars by
the portion of each count that is from each village.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-barplot-stack-1.png" title="plot of chunk barplot-stack" alt="plot of chunk barplot-stack" width="612" style="display: block; margin: auto;" /></p>

<p>This creates a stacked bar chart. These are generally more difficult to read
than side-by-side bars. We can separate the portions of the stacked bar that
correspond to each village and put them side-by-side by using the <code class="language-plaintext highlighter-rouge">position</code>
argument for <code class="language-plaintext highlighter-rouge">geom_bar()</code> and setting it to “dodge”.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-barplot-dodge-1.png" title="plot of chunk barplot-dodge" alt="plot of chunk barplot-dodge" width="612" style="display: block; margin: auto;" /></p>

<p>This is a nicer graphic, but we’re more likely to be interested in the
proportion of each housing type in each village than in the actual count of
number of houses of each type (because we might have sampled different numbers
of households in each village). To compare proportions, we will first create a
new data frame (<code class="language-plaintext highlighter-rouge">percent_wall_type</code>) with a new column named “percent”
representing the percent of each house type in each village. We will remove
houses with cement walls, as there was only one in the dataset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_wall_type</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">respondent_wall_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"cement"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>Now we can use this new data frame to create our plot showing the
percentage of each house type in each village.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_wall_type</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-barplot-wall-type-1.png" title="plot of chunk barplot-wall-type" alt="plot of chunk barplot-wall-type" width="612" style="display: block; margin: auto;" /></p>

<blockquote class="challenge">
  <h2 id="exercise-2">Exercise</h2>

  <p>Create a bar plot showing the proportion of respondents in each
village who are or are not part of an irrigation association
(<code class="language-plaintext highlighter-rouge">memb_assoc</code>). Include only respondents who answered that question
in the calculations and plot. Which village had the lowest proportion of
respondents in an irrigation association?</p>

  <blockquote class="solution">
    <h2 id="solution-4">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_memb_assoc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w">

</span><span class="n">percent_memb_assoc</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">memb_assoc</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-04-barplot-memb-assoc-1.png" title="plot of chunk barplot-memb-assoc" alt="plot of chunk barplot-memb-assoc" width="612" style="display: block; margin: auto;" /></p>

    <p>Ruaca had the lowest proportion of members in an irrigation association.</p>
  </blockquote>
</blockquote>

<h2 id="adding-labels-and-titles">Adding Labels and Titles</h2>

<p>By default, the axes labels on a plot are determined by the name of the variable
being plotted. However, <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> offers lots of customization options,
like specifying the axes labels, and adding a title to the plot with
relatively few lines of code. We will add more informative x and y axis
labels to our plot of proportion of house type by village and also add
a title.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_wall_type</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Proportion of wall type by village"</span><span class="p">,</span><span class="w">
         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Village"</span><span class="p">,</span><span class="w">
         </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-barplot-wall-types-labeled-1.png" title="plot of chunk barplot-wall-types-labeled" alt="plot of chunk barplot-wall-types-labeled" width="612" style="display: block; margin: auto;" /></p>

<h2 id="faceting">Faceting</h2>

<p>Rather than creating a single plot with side-by-side bars for each
village, we may want to create multiple plot, where each plot shows the
data for a single village. This would be especially useful if we had
a large number of villages that we had sampled, as a large number of
side-by-side bars will become more difficult to read.</p>

<p><strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> has a special technique called <em>faceting</em> that allows the 
user to split one plot into multiple plots based on a factor included 
in the dataset. We will use it to split our barplot of housing type 
proportion by village so that each village has it’s own panel in a 
multi-panel plot:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_wall_type</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Proportion of wall type by village"</span><span class="p">,</span><span class="w">
         </span><span class="n">x</span><span class="o">=</span><span class="s2">"Wall Type"</span><span class="p">,</span><span class="w">
         </span><span class="n">y</span><span class="o">=</span><span class="s2">"Percent"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">village</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-barplot-faceting-1.png" title="plot of chunk barplot-faceting" alt="plot of chunk barplot-faceting" width="612" style="display: block; margin: auto;" /></p>

<p>Click the “Zoom” button in your RStudio plots pane to view a larger
version of this plot.</p>

<p>Usually plots with white background look more readable when printed.  We can set
the background to white using the function <code class="language-plaintext highlighter-rouge">theme_bw()</code>. Additionally, you can remove
the grid:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_wall_type</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">respondent_wall_type</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Proportion of wall type by village"</span><span class="p">,</span><span class="w">
         </span><span class="n">x</span><span class="o">=</span><span class="s2">"Wall Type"</span><span class="p">,</span><span class="w">
         </span><span class="n">y</span><span class="o">=</span><span class="s2">"Percent"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-barplot-theme-bw-1.png" title="plot of chunk barplot-theme-bw" alt="plot of chunk barplot-theme-bw" width="612" style="display: block; margin: auto;" /></p>

<p>What if we wanted to see the proportion of respondents in each village
who owned a particular item? We can calculate the percent of people
in each village who own each item and then create a faceted series of
bar plots where each plot is a particular item. First we need to
calculate the percentage of people in each village who own each item:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_items</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interviews_plotting</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">pivot_longer</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bicycle</span><span class="o">:</span><span class="n">no_listed_items</span><span class="p">,</span><span class="w"> </span><span class="n">names_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"items"</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">values_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"items_owned_logical"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">items_owned_logical</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">village</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="c1">## add a column with the number of people in each village</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">people_in_village</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Chirodzo"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">39</span><span class="p">,</span><span class="w">
                                         </span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"God"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">43</span><span class="p">,</span><span class="w">
                                         </span><span class="n">village</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Ruaca"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">49</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">people_in_village</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>To calculate this percentage data frame, we needed to use the <code class="language-plaintext highlighter-rouge">case_when()</code>
parameter within <code class="language-plaintext highlighter-rouge">mutate()</code>. In our earlier examples, we knew that each house
was one and only one of the types specified. However, people can (and do) own
more than one item, so we can’t use the sum of the count column to give us the
denominator in our percentage calculation. Instead, we need to specify the
number of respondents in each village. Using this data frame, we can now create
a multi-paneled bar plot.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_items</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-percent-items-barplot-1.png" title="plot of chunk percent-items-barplot" alt="plot of chunk percent-items-barplot" width="612" style="display: block; margin: auto;" /></p>

<h2 id="ggplot2-themes"><strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> themes</h2>

<p>In addition to <code class="language-plaintext highlighter-rouge">theme_bw()</code>, which changes the plot background to white,
<strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> comes with several other themes which can be useful to quickly
change the look of your visualization. The complete list of themes is available
at <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">https://ggplot2.tidyverse.org/reference/ggtheme.html</a>. <code class="language-plaintext highlighter-rouge">theme_minimal()</code> and
<code class="language-plaintext highlighter-rouge">theme_light()</code> are popular, and <code class="language-plaintext highlighter-rouge">theme_void()</code> can be useful as a starting
point to create a new hand-crafted theme.</p>

<p>The
<a href="https://jrnold.github.io/ggthemes/reference/index.html">ggthemes</a>
package provides a wide variety of options (including an Excel 2003 theme). The
<a href="https://exts.ggplot2.tidyverse.org/"><strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> extensions website</a> provides a list
of packages that extend the capabilities of <strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong>, including additional
themes.</p>

<blockquote class="challenge">
  <h2 id="exercise-3">Exercise</h2>

  <p>Experiment with at least two different themes. Build the previous plot
using each of those themes. Which do you like best?</p>
</blockquote>

<h2 id="customization">Customization</h2>

<p>Take a look at the <a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf"><strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> cheat
sheet</a>,
and think of ways you could improve the plot.</p>

<p>Now, let’s change names of axes to something more informative than ‘village’ and
‘percent’ and add a title to the figure:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_items</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of respondents in each village who owned each item"</span><span class="p">,</span><span class="w">
         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Village"</span><span class="p">,</span><span class="w">
         </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of Respondents"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-ggplot-customization-1.png" title="plot of chunk ggplot-customization" alt="plot of chunk ggplot-customization" width="612" style="display: block; margin: auto;" /></p>

<p>The axes have more informative names, but their readability can be improved by
increasing the font size:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_items</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of respondents in each village who owned each item"</span><span class="p">,</span><span class="w">
         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Village"</span><span class="p">,</span><span class="w">
         </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of Respondents"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-ggplot-customization-font-size-1.png" title="plot of chunk ggplot-customization-font-size" alt="plot of chunk ggplot-customization-font-size" width="612" style="display: block; margin: auto;" /></p>

<p>Note that it is also possible to change the fonts of your plots. If you are on
Windows, you may have to install the <a href="https://github.com/wch/extrafont"><strong><code class="language-plaintext highlighter-rouge">extrafont</code></strong>
package</a>, and follow the instructions included
in the README for this package.</p>

<p>After our manipulations, you may notice that the values on the x-axis are still
not properly readable. Let’s change the orientation of the labels and adjust
them vertically and horizontally so they don’t overlap. You can use a 90-degree
angle, or experiment to find the appropriate angle for diagonally oriented
labels. With a larger font, the title also runs off. We can add “\n” in the string
for the title to insert a new line:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">percent_items</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of respondents in each village \n who owned each item"</span><span class="p">,</span><span class="w">
         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Village"</span><span class="p">,</span><span class="w">
         </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of Respondents"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey20"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w">
                                     </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w">
          </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey20"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w">
          </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-ggplot-customization-label-orientation-1.png" title="plot of chunk ggplot-customization-label-orientation" alt="plot of chunk ggplot-customization-label-orientation" width="612" style="display: block; margin: auto;" /></p>

<p>If you like the changes you created better than the default theme, you can save
them as an object to be able to easily apply them to other plots you may create.
We can also add <code class="language-plaintext highlighter-rouge">plot.title = element_text(hjust = 0.5)</code> to centre the title:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grey_theme</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey20"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w">
                                               </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
                                               </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w">
                    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey20"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w">
                    </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">),</span><span class="w">
                    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">))</span><span class="w">


</span><span class="n">percent_items</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of respondents in each village \n who owned each item"</span><span class="p">,</span><span class="w">
         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Village"</span><span class="p">,</span><span class="w">
         </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of Respondents"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">grey_theme</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-ggplot-custom-themes-1.png" title="plot of chunk ggplot-custom-themes" alt="plot of chunk ggplot-custom-themes" width="612" style="display: block; margin: auto;" /></p>

<blockquote class="challenge">
  <h2 id="exercise-4">Exercise</h2>

  <p>With all of this information in hand, please take another five minutes to
either improve one of the plots generated in this exercise or create a
beautiful graph of your own. Use the RStudio <a href="https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf"><strong><code class="language-plaintext highlighter-rouge">ggplot2</code></strong> cheat sheet</a>
for inspiration. Here are some ideas:</p>

  <ul>
    <li>See if you can make the bars white with black outline.</li>
    <li>Try using a different colour palette (see
<a href="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/">http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/</a>).</li>
  </ul>
</blockquote>

<p>After creating your plot, you can save it to a file in your favourite format. The Export tab in the <strong>Plot</strong> pane in RStudio will save your plots at low resolution, which will not be accepted by many journals and will not scale well for posters.</p>

<p>Instead, use the <code class="language-plaintext highlighter-rouge">ggsave()</code> function, which allows you easily change the dimension and resolution of your plot by adjusting the appropriate arguments (<code class="language-plaintext highlighter-rouge">width</code>, <code class="language-plaintext highlighter-rouge">height</code> and <code class="language-plaintext highlighter-rouge">dpi</code>).</p>

<p>Make sure you have the <code class="language-plaintext highlighter-rouge">fig_output/</code> folder in your working directory.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">my_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">percent_items</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">village</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of respondents in each village \n who owned each item"</span><span class="p">,</span><span class="w">
         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Village"</span><span class="p">,</span><span class="w">
         </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent of Respondents"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey20"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w">
                                     </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w">
          </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey20"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w">
          </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">),</span><span class="w">
          </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">))</span><span class="w">

</span><span class="n">ggsave</span><span class="p">(</span><span class="s2">"fig_output/name_of_file.png"</span><span class="p">,</span><span class="w"> </span><span class="n">my_plot</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Note: The parameters <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code> also determine the font size in the saved plot.</p>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p><code class="language-plaintext highlighter-rouge">ggplot2</code> is a flexible and useful tool for creating plots in R.</p>
</li>
    
    <li><p>The data set and coordinate system can be defined using the <code class="language-plaintext highlighter-rouge">ggplot</code> function.</p>
</li>
    
    <li><p>Additional layers, including geoms, are added using the <code class="language-plaintext highlighter-rouge">+</code> operator.</p>
</li>
    
    <li><p>Boxplots are useful for visualizing the distribution of a continuous variable.</p>
</li>
    
    <li><p>Barplots are useful for visualizing categorical data.</p>
</li>
    
    <li><p>Faceting allows you to generate multiple plots based on a categorical variable.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="processing-json-data" class="maintitle">Processing JSON data</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 30 min
      <br />
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What is JSON format?</p>
</li>
	
	<li><p>How can I convert JSON to an R dataframe?</p>
</li>
	
	<li><p>How can I convert an array of JSON record into a table?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe the JSON data format</p>
</li>
	
	<li><p>Understand where JSON is typically used</p>
</li>
	
	<li><p>Appreciate some advantages of using JSON over tabular data</p>
</li>
	
	<li><p>Appreciate some disadvantages of processing JSON documents</p>
</li>
	
	<li><p>Use the jsonLite package to read a JSON file</p>
</li>
	
	<li><p>Display formatted JSON as dataframe</p>
</li>
	
	<li><p>Select and display nested dataframe fields from a JSON document</p>
</li>
	
	<li><p>Write tabular data from selected elements from a JSON document to a csv file</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="the-json-data-format">The JSON data format</h2>

<p>The JSON data format was designed as a way of allowing different machines or processes within machines to communicate with each other by sending messages constructed in a well defined format. JSON is now the preferred data format used by APIs (Application Programming Interfaces).</p>

<p>The JSON format although somewhat verbose is not only Human readable but it can also be mapped very easily to an R dataframe.</p>

<p>We are going to read a file of data formatted as JSON, convert it into a dataframe in R then selectively create a csv file from the extracted data.</p>

<p>The JSON file we are going to use is the <a href="../data/SAFI.json">SAFI.json</a> file. This is the output file from an electronic survey system called ODK. The JSON represents the answers to a series of survey questions. The questions themselves have been replaced with unique Keys, the values are the answers.</p>

<p>Because detailed surveys are by nature nested structures making it possible to record different levels of detail or selectively ask a set of specific questions based on the answer given a previous question, the structure of the answers for the survey can not only be complex and convoluted, it could easily be different from one survey respondent’s set of answers to another.</p>

<h3 id="advantages-of-json">Advantages of JSON</h3>

<ul>
  <li>Very popular data format for APIs (e.g. results from an Internet search)</li>
  <li>Human readable</li>
  <li>Each record (or document as they are called) is self contained. The equivalent of the column name and column values are in every record.</li>
  <li>Documents do not all have to have the same structure within the same file</li>
  <li>Document structures can be complex and nested</li>
</ul>

<h3 id="disadvantages-of-json">Disadvantages of JSON</h3>

<ul>
  <li>It is more verbose than the equivalent data in csv format</li>
  <li>Can be more difficult to process and display than csv formatted data</li>
</ul>

<h2 id="use-the-json-package-to-read-a-json-file">Use the JSON package to read a JSON file</h2>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">jsonlite</span><span class="p">)</span><span class="w">

</span><span class="n">json_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_json</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">'data/SAFI.json'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We can see that a new object called json_data has appeared in our Environment. It is described as a Large list (131 elements). In this current form, our data is messy. You can have a glimpse of it with the <code class="language-plaintext highlighter-rouge">head()</code> or <code class="language-plaintext highlighter-rouge">View()</code> functions. It will look not much more structured than if you were to open the JSON file with a text editor.</p>

<p>This is because, by default, the <code class="language-plaintext highlighter-rouge">read_json()</code> function’s parameter <code class="language-plaintext highlighter-rouge">simplifyVector</code>, which specifies whether or not to simplify vectors is set to FALSE. This means that the default setting does not simplify nested lists into vectors and data frames. However, we can set this to TRUE, and our data will be read directly as a dataframe:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">json_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_json</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">'data/SAFI.json'</span><span class="p">,</span><span class="w"> </span><span class="n">simplifyVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now we can see we have this json data in a dataframe format. Have a glimpse of it with the <code class="language-plaintext highlighter-rouge">head()</code> function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  C06_rooms B19_grand_liv A08_ward E01_water_use B18_sp_parents_liv
1         1            no    ward2            no                yes
2         1           yes    ward2           yes                yes
3         1            no    ward2            no                 no
4         1            no    ward2            no                 no
5         1           yes    ward2            no                 no
6         1            no    ward2            no                 no
  B16_years_liv E_yes_group_count                                   F_liv
1             4              &lt;NA&gt;                              1, poultry
2             9                 3              4, 3, 4, oxen, cows, goats
3            15              &lt;NA&gt;                                    NULL
4             6              &lt;NA&gt;                        3, 4, oxen, cows
5            40              &lt;NA&gt; 1, 4, 2, 13, oxen, cows, goats, poultry
6             3              &lt;NA&gt;                                    NULL
  _note2                                instanceID B20_sp_grand_liv
1     NA uuid:ec241f2c-0609-46ed-b5e8-fe575f6cefef              yes
2     NA uuid:099de9c9-3e5e-427b-8452-26250e840d6e              yes
3     NA uuid:193d7daf-9582-409b-bf09-027dd36f9007               no
4     NA uuid:148d1105-778a-4755-aa71-281eadd4a973               no
5     NA uuid:2c867811-9696-4966-9866-f35c3e97d02d               no
6     NA uuid:daa56c91-c8e3-44c3-a663-af6a49a2ca70               no
  F10_liv_owned_other _note1 F12_poultry D_plots_count
1                  NA     NA         yes             2
2                  NA     NA         yes             3
3                  NA     NA         yes             1
4                  NA     NA         yes             3
5                  NA     NA         yes             2
6                  NA     NA          no             1
  C02_respondent_wall_type_other C02_respondent_wall_type
1                             NA                  muddaub
2                             NA                  muddaub
3                             NA              burntbricks
4                             NA              burntbricks
5                             NA              burntbricks
6                             NA                  muddaub
  C05_buildings_in_compound _remitters E18_months_no_water
1                         1       NULL                NULL
2                         1       NULL           Aug, Sept
3                         1       NULL                NULL
4                         1       NULL                NULL
5                         1       NULL                NULL
6                         1       NULL                NULL
                                      F07_use_income G01_no_meals
1                                               &lt;NA&gt;            2
2 AlimentaÃ§Ã£o e pagamento de educaÃ§Ã£o dos filhos            2
3                                               &lt;NA&gt;            2
4                                               &lt;NA&gt;            2
5                                               &lt;NA&gt;            2
6                                               &lt;NA&gt;            2
  E17_no_enough_water F04_need_money                  A05_end C04_window_type
1                &lt;NA&gt;           &lt;NA&gt; 2017-04-02T17:29:08.000Z              no
2                 yes             no 2017-04-02T17:26:19.000Z              no
3                &lt;NA&gt;           &lt;NA&gt; 2017-04-02T17:26:53.000Z             yes
4                &lt;NA&gt;           &lt;NA&gt; 2017-04-02T17:27:16.000Z              no
5                &lt;NA&gt;           &lt;NA&gt; 2017-04-02T17:27:35.000Z              no
6                &lt;NA&gt;           &lt;NA&gt; 2017-04-02T17:28:02.000Z              no
  E21_other_meth D_no_plots F05_money_source A07_district
1           &lt;NA&gt;          2             NULL    district1
2             no          3             NULL    district1
3           &lt;NA&gt;          1             NULL    district1
4           &lt;NA&gt;          3             NULL    district1
5           &lt;NA&gt;          2             NULL    district1
6           &lt;NA&gt;          1             NULL    district1
  C03_respondent_floor_type
1                     earth
2                     earth
3                    cement
4                     earth
5                     earth
6                     earth
                                                                                                                                                                                                                                           E_yes_group
1                                                                                                                                                                                                                                                 NULL
2 NA, furrows, furrows, tomatoes, vegetable, du_head, du_head, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, middle, middle, NA, 1000, 1000, NA, month, month, no, yes, yes, NA, rented, rented, NA, canal_gravity, canal_gravity, NA, canal, canal, 1, 2, 3
3                                                                                                                                                                                                                                                 NULL
4                                                                                                                                                                                                                                                 NULL
5                                                                                                                                                                                                                                                 NULL
6                                                                                                                                                                                                                                                 NULL
  A01_interview_date B11_remittance_money                A04_start
1         2016-11-17                   no 2017-03-23T09:49:57.000Z
2         2016-11-17                   no 2017-04-02T09:48:16.000Z
3         2016-11-17                   no 2017-04-02T14:35:26.000Z
4         2016-11-17                   no 2017-04-02T14:55:18.000Z
5         2016-11-17                   no 2017-04-02T15:10:35.000Z
6         2016-11-17                   no 2017-04-02T15:27:25.000Z
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           D_plots
1                                                                                                                                                                                                                                                              maize, maize, 1, 2, 0.5, 0.5, hactare, hactare, 1, 1, NA, NA, NA, head_spouse_free, May, 0.5, bags, NA, NA, NA, hand_hoe, NA, NA, no, NA, NA, NA, NA, no, no, NA, NA, 4, no, NA, NA, NA, owned, none, NA, maize, 1, 1, du_head, head_spouse_free, May, 0.5, bags, NA, 360, NA, hand_hoe, 1, NA, no, NA, NA, NA, NA, yes, no, NA, NA, 3, no, main_road, NA, NA, owned, none, NA, maize, 1, 1, NA, NA
2 maize, tomatoes, vegetable, 3, 2, 3, 1, 1.5, 1, hactare, hactare, hactare, 1, 1, 1, NA, NA, NA, NA, head_spouse_free, June, 1, bags, NA, NA, NA, ox, NA, NA, no, NA, NA, NA, NA, no, no, NA, NA, 80, no, NA, NA, NA, owned, none, NA, maize, 1, 1, du_head, head_spouse_free, Aug, 1.5, crates, NA, 400, NA, hand_hoe, 180, NA, no, NA, NA, NA, NA, yes, yes, 1800, NA, 180, no, On_contract, NA, NA, owned, paid_fertilizer, 1, tomatoes, 1, 1, spouse, head_spouse_free, Aug, 1, bags, NA, 800, own_choice, hand_hoe, 12, NA, yes, NA, NA, NA, 1200, yes, yes, 120, NA, 12, no, urban_market, NA, NA, owned, paid_fertilizer, 1.8, vegetable, 1, 1, NA, NA, NA
3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         maize, 1, 1, hactare, 1, NA, NA, du, Apr, 1, bags, NA, NA, NA, hand_hoe, NA, NA, no, NA, NA, NA, NA, no, no, NA, NA, 3, no, NA, NA, NA, owned, none, NA, maize, 1, 1, NA
4                                                                                                                                                 maize, maize, sorghum, 1, 2, 3, 1, 1, 1, hactare, hactare, hactare, 1, 1, 1, NA, NA, NA, NA, du, June, 1, bags, NA, NA, NA, ox, NA, NA, no, NA, NA, NA, NA, no, no, NA, NA, 4, no, NA, NA, NA, owned, none, NA, maize, 1, 1, NA, du, June, 1, bags, NA, NA, NA, ox, NA, NA, no, NA, NA, NA, NA, no, no, NA, NA, 2, no, NA, NA, NA, owned, none, NA, maize, 1, 1, NA, du, Aug, 1, bags, NA, NA, NA, ox, NA, NA, no, NA, NA, NA, NA, no, no, NA, NA, 5, no, NA, NA, NA, owned, none, NA, sorghum, 1, 1, NA, NA, NA
5                                                                                                                                                                                                                                                                                                     maize, maize, 1, 2, 1.5, 0.5, hactare, hactare, 1, 1, NA, NA, NA, du, June, 0.5, bags, NA, NA, NA, hand_hoe, NA, NA, no, NA, NA, NA, NA, no, no, NA, NA, 4, no, NA, NA, NA, owned, none, NA, maize, 1, 1, NA, du, June, 0.5, bags, NA, NA, NA, hand_hoe, NA, NA, no, NA, NA, NA, NA, no, no, NA, NA, 3, no, NA, NA, NA, owned, none, NA, maize, 1, 1, NA, NA
6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          maize, 1, 1.5, hactare, 1, NA, NA, du, June, 1.5, bags, NA, NA, NA, ox, NA, NA, no, NA, NA, NA, NA, no, no, NA, NA, 5, no, NA, NA, NA, owned, none, NA, maize, 1, 1, NA
                                                                                                                                                                                                      F_items
1 Iniciou um negÃ³cio, Comorou radio, Comprou uma Biscleta, 2011, 2012, 2012, Renda proveniente da produÃ§Ã£o agrÃ­cola, Renda proveniente da produÃ§Ã£o agrÃ­cola, Renda proveniente da produÃ§Ã£o agrÃ­cola
2                                                                       Compra da Machamba, Comprou TalhÃ£o, 2016, 2016, Renda proveniente da produÃ§Ã£o agrÃ­cola, Renda proveniente da produÃ§Ã£o agrÃ­cola
3                                                                                                          EducaÃ§Ã£o dos filhos, ConstruÃ§Ã£o de habitaÃ§Ã£o, 2016, 2007, Trabalho sazonal, Trabalho sazonal
4                                                                                                                                      Radio, O sistema solar, 2016, 2016, Trabalho sazonal, Trabalho sazonal
5                                                                                                                                                                                                        NULL
6                                                                                                                                                                                                        NULL
  F_liv_count              F10_liv_owned B_no_membrs F13_du_look_aftr_cows
1           1                    poultry           3                    no
2           3          oxen, cows, goats           7                    no
3           1                       none          10                    no
4           2                 oxen, cows           7                    no
5           4 oxen, cows, goats, poultry           7                    no
6           1                       none           3                    no
  E26_affect_conflicts
1                 &lt;NA&gt;
2                 once
3                 &lt;NA&gt;
4                 &lt;NA&gt;
5                 &lt;NA&gt;
6                 &lt;NA&gt;
                                                                      F14_items_owned
1                                             bicycle, television, solar_panel, table
2 cow_cart, bicycle, radio, cow_plough, solar_panel, solar_torch, table, mobile_phone
3                                                                         solar_torch
4                               bicycle, radio, cow_plough, solar_panel, mobile_phone
5                                          motorcyle, radio, cow_plough, mobile_phone
6                                                                                NULL
  F06_crops_contr B17_parents_liv         G02_months_lack_food A11_years_farm
1            &lt;NA&gt;              no                          Jan             11
2       more_half             yes     Jan, Sept, Oct, Nov, Dec              2
3            &lt;NA&gt;              no Jan, Feb, Mar, Oct, Nov, Dec             40
4            &lt;NA&gt;              no          Sept, Oct, Nov, Dec              6
5            &lt;NA&gt;             yes          Aug, Sept, Oct, Nov             18
6            &lt;NA&gt;              no               Aug, Sept, Oct              3
  F09_du_labour E_no_group_count E22_res_change E24_resp_assoc A03_quest_no
1            no                2           NULL           &lt;NA&gt;           01
2            no             &lt;NA&gt;           NULL             no           01
3           yes                1           NULL           &lt;NA&gt;           03
4           yes                3           NULL           &lt;NA&gt;           04
5            no                2           NULL           &lt;NA&gt;           05
6           yes                1           NULL           &lt;NA&gt;            6
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             _members
1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  sec_3, pri_7, na, 27, 19, 1, male, female, male, unmarried, unmarried, single, head, Spouse, Child, Always, Always, Always, small_scale_farm, small_scale_farm, na, NA, NA, NA, 1, 2, 3, small_scale_farm, housework, small_scale_farm, na, NA, NA, NA, NA, NA, NA
2                                                                                                                                                                                                                                                                                                                      sec_1, none, pri_1, pri_5, na, none, na, 22, 47, 7, 11, 6, 4, 2, female, male, male, male, male, female, female, unmarried, unmarried, single, single, na, na, na, Spouse, head, Child, Child, Child, Child, Child, Always, Always, Always, Always, Always, Always, Always, small_scale_farm, small_scale_farm, na, na, na, na, na, NA, NA, NA, NA, NA, NA, NA, 1, 2, 3, 4, 5, 6, 7, housework, small_scale_farm, small_scale_farm, na, na, na, na, na, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA
3 none, pri_5, pri_1, na, na, pri_7, pri_4, sec_1, na, na, 70, 30, 17, 1, 20, 18, 9, 14, 4, 5, female, female, male, male, male, male, female, female, female, female, widow/er, single, single, single, single, single, unmarried, single, single, single, head, Grandchild, Grandchild, Grandchild, Child, Child, Child, Grandchild, Grandchild, Grandchild, Always, Always, Always, Always, Always, Always, Always, Always, Always, Always, small_scale_farm, small_scale_farm, na, na, small_scale_farm, small_scale_farm, na, na, na, na, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, housework, small_scale_farm, housework, small_scale_farm, na, na, housework, small_scale_farm, small_scale_farm, na, na, na, na, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA
4                                                                                                                                                                                                                                                                         none, pri_1, pri_3, pri_2, na, na, na, 50, 28, 20, 8, 3, 2, 1, female, male, female, female, female, male, female, widow/er, unmarried, unmarried, single, single, single, single, parent, head, Spouse, Child, Child, Child, Child, Always, Always, Always, Always, Always, Always, Always, small_scale_farm, small_scale_farm, small_scale_farm, na, na, na, na, NA, NA, NA, NA, NA, NA, NA, 1, 2, 3, 4, 5, 6, 7, small_scale_farm, small_scale_farm, housework, small_scale_farm, na, na, na, na, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA
5                                                                                                                                                                                                                                                            none, sec_3, pri_6, pri_4, pri_3, na, na, 57, 28, 24, 10, 9, 5, 2, female, male, female, female, female, male, male, widow/er, married, unmarried, single, single, single, single, head, Child, other, Grandchild, Grandchild, Grandchild, Grandchild, Always, Always, Always, Always, Always, Always, Always, small_scale_farm, small_business, housework, na, na, na, na, NA, NA, NA, NA, NA, NA, NA, 1, 2, 3, 4, 5, 6, 7, housework, small_scale_farm, housework, small_business, housework, na, na, na, na, NA, NA, Nora, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA
6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    pri_1, none, pri_3, 33, 6, 9, female, male, male, single, single, single, head, Child, Child, Always, Always, Always, small_scale_farm, na, na, NA, NA, NA, 1, 2, 3, housework, small_scale_farm, na, na, NA, NA, NA, NA, NA, NA
  A06_province gps:Accuracy E20_exper_other A09_village
1    province1           14            &lt;NA&gt;    village2
2    province1           19             yes    village2
3    province1           13            &lt;NA&gt;    village2
4    province1            5            &lt;NA&gt;    village2
5    province1           10            &lt;NA&gt;    village2
6    province1           12            &lt;NA&gt;    village2
  C01_respondent_roof_type gps:Altitude gps:Longitude E23_memb_assoc
1                    grass          698      33.48346           &lt;NA&gt;
2                    grass          690      33.48342            yes
3            mabatisloping          674      33.48345           &lt;NA&gt;
4            mabatisloping          679      33.48342           &lt;NA&gt;
5                    grass          689      33.48343           &lt;NA&gt;
6                    grass          692      33.48339           &lt;NA&gt;
  E19_period_use E25_fees_water C07_other_buildings
1             NA           &lt;NA&gt;                  no
2              2             no                  no
3             NA           &lt;NA&gt;                  no
4             NA           &lt;NA&gt;                  no
5             NA           &lt;NA&gt;                  no
6             NA           &lt;NA&gt;                  no
                                                                                                                                             observation
1                                                                                                                                                   None
2                             Estes primeiros inquÃ©ritos nao tinhamos GPS introduzias is dados o tablet depois de preenchimento e tirava as cordenadas.
3                                                                Ponto GeogrÃ¡fico \nLatitude: 18Â°54'4527324S\nLongetude: 33Â°6'373207E\nAltitude: 704m
4         Esta o 2nd lanÃ§amento de questionario. As cordenadas geogrÃ¡ficas foram lanÃ§ados no prÃ³prio dia no tablet e nÃ£o foram registados no papel.
5                            Esta Ã©  a 2a vez que o mesmo questionÃ¡rio esta sendo carregado no ODK, por isso que nÃ£o traz as cordenadas geogrÃ¡ficas.
6 NÃ£o existe cordenadas geogrÃ¡ficas visto que lanÃ§ou se no tablet depois de ter terminado a entrevista, e os inquiridores nao traziam ainda os GPS's.
  _note A12_agr_assoc
1    NA            no
2    NA           yes
3    NA            no
4    NA            no
5    NA            no
6    NA            no
                                           G03_no_food_mitigation
1              na, rely_less_food, reduce_meals, day_night_hungry
2 na, reduce_meals, restrict_adults, borrow_food, seek_government
3                                na, restrict_adults, lab_ex_food
4                  na, reduce_meals, restrict_adults, lab_ex_food
5                                          na, go_forest, migrate
6                       borrow_food, lab_ex_food, seek_government
  F05_money_source_other gps:Latitude
1                     NA    -19.11226
2                     NA    -19.11248
3                     NA    -19.11211
4                     NA    -19.11223
5                     NA    -19.11222
6                     NA    -19.11220
                                                                                     E_no_group
1                                  no_need, no_need, maize, maize, NA, NA, no, no, NA, NA, 1, 2
2                                                                                          NULL
3                                                                land_far, maize, NA, no, NA, 1
4 no_need, no_need, no_need, maize, maize, sorghum, NA, NA, NA, no, no, no, NA, NA, NA, 1, 2, 3
5                                land_far, land_far, maize, maize, NA, NA, no, no, NA, NA, 1, 2
6                                                                land_far, maize, NA, no, NA, 1
  F14_items_owned_other F08_emply_lab _members_count
1                    NA            no              3
2                    NA           yes              7
3                    NA            no             10
4                    NA            no              7
5                    NA            no              7
6                    NA            no              3
</code></pre></div></div>

<p>Looking good, but you might notice that actually we have a variable, <em>F_liv</em> that is a list of dataframes! It is very important to know what you are expecting from your data to be able to look for things like this. For example, if you are getting your JSON from an API, have a look at the API documentation, so you know what to look for.</p>

<p>So what can we do about this column of dataframes? Well first things first, we can example each one. For  example to access the dataframe in the first row, we can use the  bracket (<code class="language-plaintext highlighter-rouge">[</code>) subsetting. Here we use single bracket, but you could also use double bracket (<code class="language-plaintext highlighter-rouge">[[</code>). The <code class="language-plaintext highlighter-rouge">[[</code> form allows only a single element to be selected using integer or character indices, whereas <code class="language-plaintext highlighter-rouge">[</code> allows indexing by vectors.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">json_data</span><span class="o">$</span><span class="n">F_liv</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[[1]]
  F11_no_owned F_curr_liv
1            1    poultry
</code></pre></div></div>

<p>We can also choose to view the nested dataframes at all the rows of our main dataframe where a particular condition is met (for example where the value for the variable <em>C06_rooms</em> is equal to 4):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">json_data</span><span class="o">$</span><span class="n">F_liv</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">json_data</span><span class="o">$</span><span class="n">C06_rooms</span><span class="o">==</span><span class="m">4</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[[1]]
  F11_no_owned F_curr_liv
1            3       oxen
2            2       cows
3            5      goats

[[2]]
  F11_no_owned F_curr_liv
1            4       oxen
2            5       cows
3            3      goats

[[3]]
data frame with 0 columns and 0 rows

[[4]]
  F11_no_owned F_curr_liv
1            4       oxen
2            4       cows
3            4      goats
4            1      sheep

[[5]]
  F11_no_owned F_curr_liv
1            2       cows
</code></pre></div></div>

<h2 id="write-the-json-file-to-csv">Write the JSON file to csv</h2>

<p>If we try to write our json_data dataframe to a csv as we would usuall in a regular dataframe, we will get an error that tells us we have an “unimplemented type ‘list’ in ‘EncodeElement’”. This is because of the columns in our dataframes which are lists, or nested dataframes. You can try yourself:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write.csv</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SAFI_from_JSON.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>To write out as a csv, we will need to “flatten” these columns. One thing you can do to achieve this is to turn all of the columns of your dataframe to “character” types.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">flattened_json_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="n">as.character</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now you can write this to a csv file:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write.csv</span><span class="p">(</span><span class="n">flattened_json_data</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data_output/SAFI_from_JSON.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Note: this means that when you read this csv back into R, the column of the nested dataframes will now be read in as a character vector. Converting it back to list to extract elements might be complicated, so it is probably better to keep storing these data in a JSON format if you will have to do this.</p>

<p>You can also write out the individual nested dataframes to a csv. For example:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write.csv</span><span class="p">(</span><span class="n">json_data</span><span class="o">$</span><span class="n">F_liv</span><span class="p">[[</span><span class="m">1</span><span class="p">]],</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data_output/F_liv_row1.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>JSON is a popular data format for transferring data used by a great many Web based APIs</p>
</li>
    
    <li><p>The complex structure of a JSON document means that it cannot easily be ‘flattened’ into tabular data</p>
</li>
    
    <li><p>We can use R code to extract values of interest and place them in a csv file</p>
</li>
    
  </ul>
</blockquote>

<hr />


</article>

      
      






<footer>
  <div class="row">
    <div class="col-md-6 license" id="license-info" align="left">
	
	Licensed under <a href="">CC-BY 4.0</a> 2018–2020
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="">CC-BY 4.0</a> 2016–2018
	by <a href="http://datacarpentry.org">Data Carpentry</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit//aio.md" data-checker-ignore>Edit on GitHub</a>
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:team@carpentries.org">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
